<?xml version = "1.0" encoding = "utf-8"?>
<html>
  <head>
    <meta charset="utf-8"></meta>
    <title>mbeddr User Guide</title>
    <style type="text/css">html{
font-family : sans-serif;
line-height : 120%;
}
a{
text-decoration : none;
}
.tableContainer{
}
.table{
}
.tablecaption{
}
table.inline{
}
table{
border-collapse : collapse;
}
td,th{
border : 1px solid grey;
padding : 0.5ex;
}
.tableOfContents{
}
.tocChapter{
margin-left : 2em;
}
.tocSection{
margin-left : 1em;
}
.section{
}
.codeblockContainer{
border : 2px solid grey;
padding : .5em;
overflow : auto;
margin : 1em 0;
}
.codeblock{
display : inline-block;
margin : 0;
}
.codeblock br{
display : none;
}
.originalNode::before{
content : "⬈";
display : inline-block;
padding-left : .1em;
}
.cref::after{
content : "⬈";
padding-left : .1em;
}
.greyBox{
background-color : lightgrey;
padding : 0.5em;
}
.imagecontainer{
margin : 1em 0;
}
.imagecontainer.border{
border : 2px solid grey;
padding : .5em;
}
img{
max-width : 100%;
}
.border .caption{
margin-bottom : 0;
padding-bottom : 0;
}
.imagecaption{
}
.caption{
font-size : 80%;
}
.bold{
}
.code{
}
.emph{
}
.keyPress{
-moz-border-radius : .5em;
-webkit-border-radius : .5em;
border-radius : .5em;
-moz-box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
-webkit-box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
background : rgb(240, 240, 240);
color : rgb(40, 40, 40);
display : inline;
display : inline-block;
padding : 0em .2em;
font-size : 80%;
}
.key{
display : inline;
display : inline-block;
min-width : 1em;
padding : .2em .3em;
margin : .2em;
font : normal .85em/1 "Lucida Grande", Lucida, Arial, sans-serif;
text-align : center;
text-decoration : none;
-moz-border-radius : .3em;
-webkit-border-radius : .3em;
border-radius : .3em;
border : none;
cursor : default;
-moz-user-select : none;
-webkit-user-select : none;
user-select : none;
}
.key{
background : rgb(80,80,80);
background : -moz-linear-gradient(top, rgb(60, 60, 60), rgb(80, 80, 80));
background : -webkit-gradient(linear, left top, left bottom, from(rgb(60, 60, 60)), to(rgb(80, 80, 80)));
color : rgb(250,250,250);
text-shadow : -1px -1px 0 rgb(70, 70, 70);
-moz-box-shadow : inset 0 0 1px rgb(150, 150, 150), inset 0 -.05em .4em rgb(80, 80, 80), 0 .1em 0 rgb(30, 30, 30), 0 .1em .1em rgba(0, 0, 0, .3);
-webkit-box-shadow : inset 0 0 1px rgb(150, 150, 150), inset 0 -.05em .4em rgb(80, 80, 80), 0 .1em 0 rgb(30, 30, 30), 0 .1em .1em rgba(0, 0, 0, .3);
box-shadow : inset 0 0 1px rgb(150, 150, 150), inset 0 -.05em .4em rgb(80, 80, 80), 0 .1em 0 rgb(30, 30, 30), 0 .1em .1em rgba(0, 0, 0, .3);
}
.math{
background-color : light-blue;
}
.menu{
background-color : green;
}
.menuClick{
-moz-box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
-webkit-box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
box-shadow : inset 0 1px 3px rgba(0, 0, 0, .7);
background : rgb(240, 240, 240);
color : rgb(40, 40, 40);
display : inline;
display : inline-block;
padding : 0em 0.2em;
font-size : 80%;
}
.menuItem{
display : inline;
display : inline-block;
min-width : 1em;
padding : .2em .3em;
margin : 0 .2em;
min-height : 1.2em;
font : normal .85em/1 "Lucida Grande", Lucida, Arial, sans-serif;
text-align : center;
text-decoration : none;
cursor : default;
-moz-user-select : none;
-webkit-user-select : none;
user-select : none;
background : rgb(0,0,240);
background : -moz-linear-gradient(top, rgb(0, 0, 220), rgb(0, 0, 240));
background : -webkit-gradient(linear, left top, left bottom, from(rgb(0, 0, 220)), to(rgb(0, 0, 240)));
color : rgb(250,250,250);
text-shadow : -1px -1px 0 rgb(70, 70, 70);
}
.url{
text-decoration : underline;
}
.attachment{
}
.footnoteOrigin{
}
.footnoteText{
border-top : 1px solid lightgrey;
padding-top : 4px;
font-size : 80%;
}
.footnoteText+.footnoteText{
border-top : 0;
}
.imgRef{
}
.sectRef{
}
.todo{
background-color : yellow;
}
.cref{
}
</style>
  </head>
  <body>
  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WZX646"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WZX646');</script>
<!-- End Google Tag Manager -->
    <div>
      <h1 id="sid988357225306385802" class="section"> mbeddr User Guide</h1>
      <p class="body">
        This is the mbeddr user guide. It targets users of mbeddr, not people who extend the mbeddr languages. We strive to cover all relevant mbeddr functionalities, but as things change, some parts may not always be up-to-date. Please report problems, ommissions or bugs to our mailing list at <a href="mailto:mbeddr-discuss@googlegroups.com" class="url">mailto:mbeddr-discuss@googlegroups.com</a>. When you report a problem, please make sure you include a Node Info for the problem (see <span class="sectRef">Section <a href="#sid1195021413141455458">Utilitites</a></span> for details on what a Node Info is).
      </p>
      <p class="body">This user guide is written with the MPS documentation language. On the plus side, this affords us very close integration with source code and models -- these things are always up to date. On the downside, we still have some issues in the Latex generator, the generated Latex file, and especially the embedded figures, don&apos;t yet look very beautiful. Please bear with us. It will improve.</p>
      <p class="body">
        You can use mbeddr&apos;s full text search utility provided by mbeddr: see <span class="sectRef">Section <a href="#sid1418902825862766569">Searching Models</a></span>.
      </p>
      <p class="body">
        Finally, we want to emphasize that, in addition to this user guide, there is a lot of additional information. This includes various videos (at <a href="http://mbeddr.com/" class="url">http://mbeddr.com/</a> and at <a href="http://mbeddr.com/screencasts.html" class="url">http://mbeddr.com/screencasts.html</a>) as well as a number of articles and papers at <a href="http://mbeddr.com/learn.html" class="url">http://mbeddr.com/learn.html</a>. 
      </p>
    </div>
    <div>
      <h1 id="toc" class="tableOfContents">Table of Contents</h1>
      <div class="tocChapter">
        <strong><a href="#sid1481709176727861669">1 mbeddr Concepts</a></strong>
        <div class="tocSection">
          <a href="#sid1481709176725420676">1.1 JetBrains MPS</a>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176725865222">1.2 mbeddr</a>
          <div class="tocSection">
            <a href="#sid1481709176726611755">1.2.1 mbeddr Architecture</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176727857232">1.3 gcc, make and gdb</a>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176727416605">1.4 CBMC</a>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176727855915">1.5 PlantUML and Graphviz</a>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176727858543">1.6 Java</a>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid4711768717894034959">2 Installation and Setup</a></strong>
        <div class="tocSection">
          <a href="#sid6403595147461065871">2.1 Gcc, Make and Gdb</a>
        </div>
        <div class="tocSection">
          <a href="#sid2564556814933926657">2.2 Graphviz</a>
        </div>
        <div class="tocSection">
          <a href="#sid2564556814935137124">2.3 Verification Tools</a>
        </div>
        <div class="tocSection">
          <a href="#sid1560676800018096836">2.4 mbeddr</a>
          <div class="tocSection">
            <a href="#sid1560676800018098615">2.4.1 mbeddr IDE</a>
          </div>
          <div class="tocSection">
            <a href="#sid1560676800018098638">2.4.2 mbeddr Plugin Distribution</a>
          </div>
          <div class="tocSection">
            <a href="#sid1560676800018098647">2.4.3 mbeddr Source Installation</a>
            <div class="tocSection">
              <a href="#sid1415849632045903128">2.4.3.1 Introduction</a>
            </div>
            <div class="tocSection">
              <a href="#sid1415849632045903752">2.4.3.2 Source Distribution Python Installer</a>
            </div>
            <div class="tocSection">
              <a href="#sid1415849632045904218">2.4.3.3 Manual Source Installation</a>
            </div>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid6403595147461065892">2.5 JetBrains MPS and Java</a>
        </div>
        <div class="tocSection">
          <a href="#sid4711768717894380508">2.6 Adding Tools to the System Path</a>
        </div>
        <div class="tocSection">
          <a href="#sid2045083395016240670">2.7 Required Tools and Versions</a>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid1481709176728354858">3 Fundamentals</a></strong>
        <div class="tocSection">
          <a href="#sid1481709176728444538">3.1 The MPS UI</a>
          <div class="tocSection">
            <a href="#sid1481709176728447354">3.1.1 Overall Structure</a>
          </div>
          <div class="tocSection">
            <a href="#sid1481709176728447485">3.1.2 Tools</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176728451319">3.2 Project Structure</a>
          <div class="tocSection">
            <a href="#sid1481709176729756665">3.2.1 Nodes, Roots and Concepts</a>
          </div>
          <div class="tocSection">
            <a href="#sid1481709176729756652">3.2.2 Project, Solutions, Models, Folders, Roots</a>
          </div>
          <div class="tocSection">
            <a href="#sid1481709176729814334">3.2.3 Using Languages and Devkits</a>
          </div>
          <div class="tocSection">
            <a href="#sid1481709176729756657">3.2.4 Paths and Libraries</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176727862949">3.3 The Editor</a>
          <div class="tocSection">
            <a href="#sid2101724341004008313">3.3.1 Usability</a>
          </div>
          <div class="tocSection">
            <a href="#sid2101724341004008376">3.3.2 Projection Modes</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid7992580511417017508">3.4 Keyboard Shortcuts</a>
        </div>
        <div class="tocSection">
          <a href="#sid1481709176729755835">3.5 Version Control</a>
          <div class="tocSection">
            <a href="#sid2101724341004030799">3.5.1 Introduction</a>
          </div>
          <div class="tocSection">
            <a href="#sid2101724341004032066">3.5.2 Supported Version Control Systems</a>
          </div>
          <div class="tocSection">
            <a href="#sid2101724341004068759">3.5.3 Setting Up Version Control for a Project</a>
          </div>
          <div class="tocSection">
            <a href="#sid2101724341004068813">3.5.4 Tools and Views</a>
          </div>
          <div class="tocSection">
            <a href="#sid2101724341004032080">3.5.5 Common Version Control Operations</a>
            <div class="tocSection">
              <a href="#sid2101724341004032088">3.5.5.1 Update/Pull</a>
            </div>
            <div class="tocSection">
              <a href="#sid2101724341004032093">3.5.5.2 Commit/Push</a>
            </div>
            <div class="tocSection">
              <a href="#sid2101724341004032097">3.5.5.3 Conflicts/Merging</a>
            </div>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid1195021413141455458">3.6 Utilitites</a>
          <div class="tocSection">
            <a href="#sid1418902825862766330">3.6.1 Interop with Text</a>
          </div>
          <div class="tocSection">
            <a href="#sid1418902825862766569">3.6.2 Searching Models</a>
          </div>
          <div class="tocSection">
            <a href="#sid1418902825862775310">3.6.3 Opening Terminals</a>
          </div>
          <div class="tocSection">
            <a href="#sid4424988308481613119">3.6.4 Find Usages</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid7992580511418100707">3.7 Cheat Sheet</a>
        </div>
        <div class="tocSection">
          <a href="#sid7992580511417536229">3.8 Useful MPS Settings</a>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid2101724341003970562">4 mbeddr C vs. C99</a></strong>
        <div class="tocSection">
          <a href="#sid2723638869557430314">4.1 mbeddr&apos;s Module System</a>
        </div>
        <div class="tocSection">
          <a href="#sid993292703731045282">4.2 Data Types</a>
          <div class="tocSection">
            <a href="#sid993292703731048905">4.2.1 Boolean</a>
          </div>
          <div class="tocSection">
            <a href="#sid3592268205546236794">4.2.2 User defined types</a>
          </div>
          <div class="tocSection">
            <a href="#sid3592268205546292455">4.2.3 Integers</a>
          </div>
          <div class="tocSection">
            <a href="#sid3592268205547053903">4.2.4 Type Size Configuration</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3592268205546300997">4.3 Array Syntax</a>
        </div>
        <div class="tocSection">
          <a href="#sid993292703731052551">4.4 Various Additions</a>
        </div>
        <div class="tocSection">
          <a href="#sid2723638869557433101">4.5 Unit Tests</a>
        </div>
        <div class="tocSection">
          <a href="#sid85256576563787228">4.6 Function Pointers</a>
          <div class="tocSection">
            <a href="#sid5110473669961000551">4.6.1 Function Types</a>
          </div>
          <div class="tocSection">
            <a href="#sid2723638869562319525">4.6.2 Function References</a>
          </div>
          <div class="tocSection">
            <a href="#sid5110473669969280346">4.6.3 Lambdas</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid85256576539952864">4.7 Commenting</a>
          <div class="tocSection">
            <a href="#sid85256576539952878">4.7.1 Statement Comments</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576543084047">4.7.2 Element Documentations</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576543364439">4.7.3 Margin Comments</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576543581662">4.7.4 Commenting Out Code</a>
          </div>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid1481709176728354858">5 Generated Code</a></strong>
        <div class="tocSection">
          <a href="#sid3082376456307359987">5.1 Efficiency</a>
        </div>
        <div class="tocSection">
          <a href="#sid3082376456307360126">5.2 Readability</a>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid2101724341003970566">6 C Tooling</a></strong>
        <div class="tocSection">
          <a href="#sid85256576565990694">6.1 Building Binaries in the IDE</a>
          <div class="tocSection">
            <a href="#sid6002249030800732328">6.1.1 Build Configurations</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576565991532">6.1.2 Model Checking</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576565991124">6.1.3 Building in the IDE</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid8694947709985848141">6.2 Building Binaries from the Command-Line</a>
          <div class="tocSection">
            <a href="#sid8694947709985848151">6.2.1 Example Application</a>
          </div>
          <div class="tocSection">
            <a href="#sid8694947709985848201">6.2.2 Writing Build Scripts</a>
          </div>
          <div class="tocSection">
            <a href="#sid8694947709985848289">6.2.3 Building from Command-Line</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid7863625513831639756">6.3 Running Applications from MPS/mbeddr</a>
          <div class="tocSection">
            <a href="#sid4376803293071865921">6.3.1 Creating a Launch Configurations</a>
          </div>
          <div class="tocSection">
            <a href="#sid4376803293071868990">6.3.2 Contents of the Launch Configuration </a>
          </div>
          <div class="tocSection">
            <a href="#sid4376803293071917230">6.3.3 Console output</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051956754942">6.4 Debugging</a>
          <div class="tocSection">
            <a href="#sid7863625513831639597">6.4.1 Introduction</a>
          </div>
          <div class="tocSection">
            <a href="#sid7863625513831979563">6.4.2 Starting a Debug Session</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid85256576565955264">6.5 Hello, World</a>
          <div class="tocSection">
            <a href="#sid5607395629656564110">6.5.1 A new Project</a>
          </div>
          <div class="tocSection">
            <a href="#sid5607395629656570364">6.5.2 New Model</a>
          </div>
          <div class="tocSection">
            <a href="#sid5607395629656589152">6.5.3 Writing the Code</a>
          </div>
          <div class="tocSection">
            <a href="#sid5607395629657104236">6.5.4 Build and Run</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051956758831">6.6 Accessing Libraries</a>
          <div class="tocSection">
            <a href="#sid7979854108176613196">6.6.1 Manual Header Import</a>
          </div>
          <div class="tocSection">
            <a href="#sid7979854108176683431">6.6.2 Automatic Header Import</a>
          </div>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid2101724341003970577">7 C Extensions</a></strong>
        <div class="tocSection">
          <a href="#sid3861573051957167219">7.1 Static Evaluation</a>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957168005">7.2 Units</a>
          <div class="tocSection">
            <a href="#sid5000085652829234023">7.2.1 Physical Units Basics</a>
          </div>
          <div class="tocSection">
            <a href="#sid5000085652830089862">7.2.2 Unit Conversions</a>
          </div>
          <div class="tocSection">
            <a href="#sid5000085652830090559">7.2.3 Generic Units</a>
          </div>
          <div class="tocSection">
            <a href="#sid5000085652829236414">7.2.4 Stripping and Reintroducing Units</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957173387">7.3 State Machines</a>
          <div class="tocSection">
            <a href="#sid3458996998997039536">7.3.1 Implementing a State machine</a>
          </div>
          <div class="tocSection">
            <a href="#sid3458996998997358129">7.3.2 Interacting with Other Code -- Outbound</a>
          </div>
          <div class="tocSection">
            <a href="#sid3458996998997410421">7.3.3 Interaction with Other Code -- Inbound</a>
          </div>
          <div class="tocSection">
            <a href="#sid3458996998997836692">7.3.4 Hierarchical State Machines</a>
          </div>
          <div class="tocSection">
            <a href="#sid1891280913627286661">7.3.5 Tabular Notation</a>
          </div>
          <div class="tocSection">
            <a href="#sid3458996998997887919">7.3.6 State Machine Diagrams</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957169274">7.4 Components</a>
          <div class="tocSection">
            <a href="#sid4199862776472278007">7.4.1 An Interface with Contracts</a>
          </div>
          <div class="tocSection">
            <a href="#sid4199862776472592797">7.4.2 A first Component</a>
          </div>
          <div class="tocSection">
            <a href="#sid2179458690433981422">7.4.3 Verifying Contracts Statically</a>
          </div>
          <div class="tocSection">
            <a href="#sid4199862776475048963">7.4.4 Collaborating and Stateful Components</a>
          </div>
          <div class="tocSection">
            <a href="#sid4098353292122310610">7.4.5 Mocks</a>
          </div>
          <div class="tocSection">
            <a href="#sid4098353292122311090">7.4.6 Sender/Receiver Interfaces</a>
          </div>
          <div class="tocSection">
            <a href="#sid6669194810542205988">7.4.7 Composite Components</a>
          </div>
          <div class="tocSection">
            <a href="#sid6669194810542205892">7.4.8 Interface Types</a>
          </div>
          <div class="tocSection">
            <a href="#sid4098353292122311572">7.4.9 Visualizing Components</a>
          </div>
          <div class="tocSection">
            <a href="#sid4098353292122312056">7.4.10 Contract Verification</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957167614">7.5 Decision Tables</a>
          <div class="tocSection">
            <a href="#sid7979854108176472498">7.5.1 Verifying the Decision Table</a>
          </div>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid2101724341003970560">8 Process Support</a></strong>
        <div class="tocSection">
          <a href="#sid1195021413140175530">8.1 Requirements</a>
          <div class="tocSection">
            <a href="#sid1195021413140175561">8.1.1 Overview</a>
          </div>
          <div class="tocSection">
            <a href="#sid1195021413140757038">8.1.2 Requirements Basics</a>
          </div>
          <div class="tocSection">
            <a href="#sid1195021413141367739">8.1.3 Visualizations and Tree Views</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid2805811593275579771">8.2 Tracing</a>
          <div class="tocSection">
            <a href="#sid2805811593282828678">8.2.1 Attaching and Removing Traces</a>
          </div>
          <div class="tocSection">
            <a href="#sid2805811593282828696">8.2.2 Reverse Tracing</a>
          </div>
          <div class="tocSection">
            <a href="#sid2805811593282828781">8.2.3 Trace Report Assessment</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3231021218602645814">8.3 Assessments</a>
        </div>
        <div class="tocSection">
          <a href="#sid3231021218602638869">8.4 Documentation Language</a>
          <div class="tocSection">
            <a href="#sid5479545238865063690">8.4.1 Basic Ideas</a>
          </div>
          <div class="tocSection">
            <a href="#sid5479545238865064144">8.4.2 Target Platforms</a>
          </div>
          <div class="tocSection">
            <a href="#sid5479545238865064852">8.4.3 Core Concepts</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid4424988308481661440">8.5 Code Review</a>
          <div class="tocSection">
            <a href="#sid85256576547059006">8.5.1 Overview</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576547949366">8.5.2 Projection Modes</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576547059000">8.5.3 Review States</a>
          </div>
          <div class="tocSection">
            <a href="#sid85256576547059029">8.5.4 Assessments</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957186872">8.6 Product Line Variability</a>
          <div class="tocSection">
            <a href="#sid5479545238858014169">8.6.1 Specifying Variability</a>
          </div>
          <div class="tocSection">
            <a href="#sid536680812410069782">8.6.2 Runtime Variability</a>
          </div>
          <div class="tocSection">
            <a href="#sid536680812410436781">8.6.3 Static Variability</a>
          </div>
        </div>
      </div>
      <div class="tocChapter">
        <strong><a href="#sid1481709176728354858">9 Analyses</a></strong>
        <div class="tocSection">
          <a href="#sid3861573051957203922">9.1 Introduction to Analyses</a>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957204841">9.2 Analyzing variability</a>
          <div class="tocSection">
            <a href="#sid9020927825193691735">9.2.1 FM-Analyzer</a>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825193691765">9.2.2 CM-Analyzer</a>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825193705480">9.2.3 Modules-Analyzer</a>
          </div>
          <div class="tocSection">
            <a href="#sid5724023611138131897">9.2.4 Modules and Solutions Variability Analyzer</a>
          </div>
        </div>
        <div class="tocSection">
          <a href="#sid3861573051957205464">9.3 Formal Verification with CBMC</a>
          <div class="tocSection">
            <a href="#sid9020927825193817139">9.3.1 Verification primer</a>
            <div class="tocSection">
              <a href="#sid3946864811253508142">9.3.1.1 Behind the Courtain</a>
            </div>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825194462692">9.3.2 Basic Configuration</a>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825193818808">9.3.3 Robustness Checks at C-level</a>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825193819314">9.3.4 Robustness Checks of mbeddr-Extensions</a>
            <div class="tocSection">
              <a href="#sid4315280228446701717">9.3.4.1 Checking Decision Tables</a>
            </div>
            <div class="tocSection">
              <a href="#sid4315280228447176921">9.3.4.2 Checking State Machines</a>
            </div>
          </div>
          <div class="tocSection">
            <a href="#sid9020927825193819488">9.3.5 Functional Verification</a>
            <div class="tocSection">
              <a href="#sid7590231220342167555">9.3.5.1 Assertions verification</a>
            </div>
            <div class="tocSection">
              <a href="#sid7590231220342214141">9.3.5.2 Components Verification</a>
            </div>
          </div>
          <div class="tocSection">
            <a href="#sid2496896684167180661">9.3.6 Defining the Environment for Verification</a>
          </div>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid1481709176727861669" class="section">1 mbeddr Concepts</h1>
      <div>
        <h2 id="sid1481709176725420676" class="section">1.1 JetBrains MPS</h2>
        <p class="body">mbeddr relies on the JetBrains MPS language workbench. A language workbench is a tool that supports language engineering, the activity of building, composing, extending and using languages. MPS can be seen as a framework on which mbeddr relies. </p>
        <p class="body">
          MPS is open source software licensed under Apache 2.0. It can be downloaded from <a href="http://jetbrains.com/MPS" class="url">http://jetbrains.com/MPS</a>. mbeddr currently uses MPS 3.1.4, even though 3.1.5 should work as well. Later in 2014 we will move to the upcoming version 3.2.
        </p>
        <p class="body">
          Various tutorials exist, and the MPS documentation page (at <a href="https://www.jetbrains.com/mps/documentation/" class="url">https://www.jetbrains.com/mps/documentation/</a>) contains links to most of these. We want to highlight in particular the book by Fabien Campagne (<a href="http://www.amazon.com/The-MPS-Language-Workbench-Vol/dp/1497378656/" class="url">http://www.amazon.com/The-MPS-Language-Workbench-Vol/dp/1497378656/</a>). Note that in order to <em class="emph">use</em> mbeddr, you don&apos;t have to understand the MPS language engineering facilities (this is only necessary to <em class="emph">extend</em> mbeddr with new languages. 
        </p>
        <p class="body">
          MPS relies on a projectional editor. Instead of using a parser that transforms character sequence into a tree for further processing, in MPS, every editing gesture <em class="emph">directly</em> changes the tree. This has two important advantages:<br/>
flexible notations and language modularity.
        </p>
        <p class="body">
          <b>Language Modularity</b>&nbsp;&nbsp;Because a projectional editor does not use a grammar, the combination of independently developed grammars cannot become ambiguous. Potential ambiguities are delegated to the user to resolve. This way, arbitrary languages and language extensions can be combined in one single program. mbeddr exploits this by providing a set of modular language extensions to C (and a couple of other languages). If you are interested in the details, please refer to this paper: <a href="http://voelter.de/data/pub/Voelter-GTTSE-MPS.pdf" class="url">http://voelter.de/data/pub/Voelter-GTTSE-MPS.pdf</a> as well as mbeddr in general.
        </p>
        <p class="body">
          <b>Flexible Notations</b>&nbsp;&nbsp;Since no parser is used, MPS can support essentially any notation. This includes classical text, but also prose (as in this user guide), tables, math symbols and also diagrams. We exploit this in mbeddr extensively. For an overview over MPS&apos; supported notations take a look at this paper: <a href="http://mbeddr.com/files/gemoc2014-MPSNotations.pdf" class="url">http://mbeddr.com/files/gemoc2014-MPSNotations.pdf</a>
          
        </p>
        <p class="body">
          Traditionally, the above mentioned benefits of a projectional editor have come at a price: the user experience of traditional projectional editors was not very good, in particular, when editing code that looked like &quot;normal text&quot;. Consequently, projectional editors were not adopted. However, MPS is doing a much better job with this. We have conducted a study with 20 MPS users (most of them mbeddr users as well), and the conclusion is that the editor works well enough. Take a look at this paper for details: <a href="http://mbeddr.com/files/projectionalEditing-sle2014.pdf" class="url">http://mbeddr.com/files/projectionalEditing-sle2014.pdf</a>.
        </p>
      </div>
      <div>
        <h2 id="sid1481709176725865222" class="section">1.2 mbeddr</h2>
        <p class="body">
          mbeddr is essentially a set of plugins to MPS. If you consider MPS as a <em class="emph">framework</em>, then mbeddr can be considered an <em class="emph">application</em>. The plugins contain mostly language definitions: mbeddr C as well as its extensions are languages in terms of MPS. In addition, the plugins also contain additional utilities, libraries, views, editors, etc. However, these details are irrelevant to the mbeddr user.
        </p>
        <p class="body">
          In this user guide we do not explain the philosophical underpinnings, ideas and approaches of mbeddr since these have been discussed extensively in the various papers we wrote. You can find these papers on the mbeddr website (in particular on the Learn page at <a href="http://mbeddr.com/learn.html" class="url">http://mbeddr.com/learn.html</a>. To get an overview we suggest to take a look at the following two:
        </p>
        <ul>
          <li>
            mbeddr - Instantiating a Language Workbench in the Embedded Software Domain: <a href="http://mbeddr.com/files/voelteretal-mbeddr-final.pdf" class="url">http://mbeddr.com/files/voelteretal-mbeddr-final.pdf</a>
            
          </li>
          <li>
            Generic Tools, Specific Languages (Markus&apos; dissertation that uses mbeddr as a case study): <a href="http://voelter.de/data/books/GenericToolsSpecificLanguages-1.0-web.pdf" class="url">http://voelter.de/data/books/GenericToolsSpecificLanguages-1.0-web.pdf</a>
            
          </li>
        </ul>
        <div>
          <h3 id="sid1481709176726611755" class="section">1.2.1 mbeddr Architecture</h3>
          <p class="body">
            mbeddr is structured into 5 layers and addresses three different concerns (see <a href="#sid1481709176726612629" class="imgRef">Fig. 1.2.1-A</a>). The platform layer consists of the JetBrains MPS language workbench, which enables the overall approach. The core layer includes the base languages used in mbeddr; these are different for each of the three concerns. The default extensions layer consits of a set of predefined extensions of the core languages that can be used out-of-the-box to develop software. The user extension layer is empty, it is intended to be filled by users. The backend layer consists of existing tools compilation and analysis tools which mbeddr uses.
          </p>
          <div class="imagecontainer" id="sid1481709176726612629">
            <div class="image">
              <img src="images/concept/architecture.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                1.2.1-A: </b>Overview over mbeddr&apos;s five layers and three concerns.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Implementation Concern</b>&nbsp;&nbsp;The implementation concern addresses the development of applications based on C. On the core layer, mbeddr comes with an implementation of C99 in MPS. There are a few minor differences to C99, and the preprocessor is not exposed to the user; first-class concepts are provided for the legitimate uses of the preprocessor (including a module system). On the default extensions layer, the implementation concern comes with C extensions for decision tables, interfaces and components, state machines, physical units, testing as well as logging and tracing. The user extensions layer is by definition empty; users can easily extend the C core as well as any of the default extensions. State-of-the-art IDE support is available for all languages, including syntax highlighting, code completion, real-time type checks and refactorings. The implementation concern also ships with an extensible debugger that is able to debug on the level of the extensions, so the abstractions do not break down when debugging becomes necessary. At the backend layer, the implementation concern relies on a C compiler, a C debugger and tools for importing existing C code into mbeddr. By default, mbeddr uses the gcc compiler and the gdb debugger.
          </p>
          <p class="body">
            <b>Analysis Concern</b>&nbsp;&nbsp;The analysis concern provides static analyses (formal verification) for some of the default extensions provided by the implementation concern. The analyses themselves are performed by existing external tools. However, mbeddr integrates the tools tightly by (a) providing language abstractions to conveniently describe behavior that can be analyzed, (b) translating this description to the input of the analysis tool, (c) running the tool, and (d) lifting the output of the tool back to the original abstraction level, to make it easier to understand for the user. The integrated analyses are based on symbolic model checking, SMT solving and C-level model-checking. Specifically, the following analyses are available: State machines can be checked with a symbolic model checker. It verifies a set of default properties and optional user-defined properties. Decision tables can be checked for completeness and consistency. Feature model configurations are checked for consistency. Finally, interface contracts can be checked statically: interfaces can specify pre- and post-conditions as well as protocol state machines that specify the valid invocation order of interface operations. These contracts can be checked for each implementing component via a C-level model checker.
          </p>
          <p class="body">
            <b>Process Concern</b>&nbsp;&nbsp;The process concern includes facilities for integrating mbeddr into development processes. These facilities can be used with arbitrary mbeddr languages, such as all the default and user-defined C extensions. The requirements support provides a language for describing requirements. Traces can be attached to any program element expressed in any language. Arbitrary additional data, expressed in any language, can be added to a requirement. The product lines supports defining feature models and configurations. Feature models can be connected to other artifacts by means of presence conditions, While presence conditions are static and work for any language, there is also C-specific support to evaluate variability at runtime. The documentation language aspect supports writing prose documents as part of an mbeddr project, exportable as HTML or LaTeX. It supports close integration with program elements. They can be referenced (with real references that are renamed if the element itself is renamed) and program code can be embedded as text or as an image. The embedded code is updated whenever the document is regenerated. Visualization provides a facility to render diagrams. Reports and assessments are customizable queries over the code.
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid1481709176727857232" class="section">1.3 gcc, make and gdb</h2>
        <p class="body">
          mbeddr does not come with its own compiler. While this could be considered &quot;cheating&quot;, it is actually a good idea because <code class="code">gcc</code> and other compilers contain person-decades of optimizations. Replicating those is hopeless. Hence, mbeddr relies on existing backends.
        </p>
        <p class="body">
          For compiling, building and debugging mbeddr code, mbeddr relies on the established GNU C tool chain. In particular, <code class="code">gcc</code> is used to compile the generated C code, <code class="code">make</code> is used to orchestrate the compile and link process, and <code class="code">gdb</code> is used by the mbeddr debugger. Note that all of these tools are not visible to the mbeddr user. But they have to be available on your system (see  <span class="sectRef">Section <a href="#sid6403595147461065871">Gcc, Make and Gdb</a></span> for details). 
        </p>
        <p class="body">Other compilers, make tools and debuggers can be plugged into mbeddr (we have just integrated the  Microchip PIC 16 for a customer). How this is done is beyond the scope of this user guide.</p>
      </div>
      <div>
        <h2 id="sid1481709176727416605" class="section">1.4 CBMC</h2>
        <p class="body">
          CBMC is used for verification. It is discussed in detail in <span class="sectRef">Section <a href="#sid3861573051957205464">Formal Verification with CBMC</a></span>. To summarize, CBMC is a bounded model checker for C programs. This means that it can essentially simulate the execution of a C program regarding all its possible execution paths. CBMC is open source software and can be downloaded from <a href="http://www.cprover.org/cbmc/" class="url">http://www.cprover.org/cbmc/</a>. It has to be installed separately, as described in the Installation section <span class="sectRef">Section <a href="#sid2564556814935137124">Verification Tools</a></span>. For details on how mbeddr uses CBMC, please take a look at the following papers, as well as at <span><strong class="todo">[ToDo: 
          section
          ]</strong></span>:
        </p>
        <ul>
          <li>
            Automated Domain-Specific C Verification with mbeddr: <a href="http://mbeddr.com/files/dscv-ase2014.pdf" class="url">http://mbeddr.com/files/dscv-ase2014.pdf</a>
            
          </li>
          <li>
            Using Language Engineering to Lift Languages and Analyses at the Domain Level <a href="http://mbeddr.com/files/nfm2013.pdf" class="url">http://mbeddr.com/files/nfm2013.pdf</a>
            
          </li>
        </ul>
      </div>
      <div>
        <h2 id="sid1481709176727855915" class="section">1.5 PlantUML and Graphviz</h2>
        <p class="body">
          PlantUML (<a href="http://www.plantuml.com/" class="url">http://www.plantuml.com/</a>) is an open source tool to generate UML diagrams from relatively simple textual specifications. We use it in mbeddr to render read-only diagrams of program structures in a separate view (these are different from graphical editors). Internally, PlantUML relies on Graphviz (<a href="http://www.graphviz.org/" class="url">http://www.graphviz.org/</a>) for layouting the diagrams. As a user, you will not interact with graphviz directly, but you have to install it manually (see <span class="sectRef">Section <a href="#sid2564556814933926657">Graphviz</a></span>). PlantUML itself is packaged with mbeddr and does not have to be installed manually.
        </p>
      </div>
      <div>
        <h2 id="sid1481709176727858543" class="section">1.6 Java</h2>
        <p class="body">MPS is a Java application. This means that it relies on a Java Virtual Machine (specifically, a JRE) to be able to execute. So, in order to be able to use MPS and mbeddr, you have to install Java on your computer. The specific versions are discussed in the Installation section.</p>
        <p class="body">Note that the Java dependency is of course only for the tool - the systems developed with mbeddr are pure C.</p>
      </div>
    </div>
    <div>
      <h1 id="sid4711768717894034959" class="section">2 Installation and Setup</h1>
      <p class="body">This chapter describes the manual installation process of mbeddr in detail. This includes MPS, Java and additional tools needed for compilation, debugging, visualization and verification. </p>
      <div>
        <h2 id="sid6403595147461065871" class="section">2.1 Gcc, Make and Gdb</h2>
        <p class="body">
          mbeddr relies on <code class="code">gcc</code> and <code class="code">make</code> for compilation and <code class="code">gdb</code> for debugging. You must install these tools unless you have a different, target-specific build process. Below we describe the installation of these tools on the various platforms.
        </p>
        <ul>
          <li>
            <em class="emph">Windows:</em> We recommend installing MinGW (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>), a port of the GNU tools to Windows.  When selecting the packages to be installed (only Class (<code class="code">bin</code>), make sure <code class="code">mingw32-gcc</code>, <code class="code">mingw32-gdb</code> and <code class="code">mingw32-make</code> are included (all of them are in the <code class="code">All Packages</code> subtree in the selection dialog).
          </li>
          <li>
            <em class="emph">Linux:</em> These tools should be installed by default. Otherwise use your favourite package manager to install them (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>).
          </li>
          <li>
            <em class="emph">MacOS:</em> You should install XCode&apos;s command line tools to get <code class="code">gcc</code>, <code class="code">make</code> and the associated tools (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>). XCode comes with <code class="code">lldb</code>, which is not yet supported by mbeddr. Therefore you have to install <code class="code">gdb</code> via <code class="code">brew</code> (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>). Use the following command for installing <code class="code">gdb</code>: <code class="code">brew install https://raw.github.com/Homebrew/homebrew-dupes/master/gdb.rb</code>. Additionally, you have to sign a certificate for <code class="code">gdb</code> (<a href="http://wiki.freepascal.org/GDB_on_OS_X_Mavericks_and_Xcode_5" class="url">http://wiki.freepascal.org/GDB_on_OS_X_Mavericks_and_Xcode_5</a>).
          </li>
        </ul>
        <p class="body">
          After the installation, please make sure the tools can be invoked from the command-line. If this is not possible, please add them to your system path, as described in <span class="sectRef">Section <a href="#sid4711768717894380508">Adding Tools to the System Path</a></span>.
        </p>
      </div>
      <div>
        <h2 id="sid2564556814933926657" class="section">2.2 Graphviz</h2>
        <p class="body">
          mbeddr supports visualization via PlantUML (<a href="http://plantuml.sourceforge.net" class="url">http://plantuml.sourceforge.net</a>), directly embedded in MPS. To use it, you have to install graphviz. <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span> describes which version is required and where to get it from. After the installation, you have to put the <code class="code">bin</code> directory of graphviz into your system path (see <span class="sectRef">Section <a href="#sid4711768717894380508">Adding Tools to the System Path</a></span>). <em class="emph">On Windows</em>, in addition, you also need to have an environment variable <code class="code">GRAPHVIZ_DOT</code> that points to the <code class="code">dot.exe</code> file supplied with graphviz.
        </p>
      </div>
      <div>
        <h2 id="sid2564556814935137124" class="section">2.3 Verification Tools</h2>
        <p class="body">
          To be able to use the verifications in mbeddr, you have to install <code class="code">CBMC</code>, which is a C-level model-checker. <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span> describes which version is required and where to get it from. You can find installers for the various platforms at the bottom of the website. After the installation, please make sure <code class="code">CBMC</code> can be invoked from the command-line. If this is not possible, please add it to your system path, as described in <span class="sectRef">Section <a href="#sid4711768717894380508">Adding Tools to the System Path</a></span>. CBMC uses gcc for preprocessing the C files, so please make sure that you have gcc installed on your machine.
        </p>
        <p class="body">You can check that a proper version of CBMC is correctly installed on your machine by clicking on the &apos;Test CBMC Installation&apos; button from File -&gt; Settings -&gt; CProver Preferences. </p>
      </div>
      <div>
        <h2 id="sid1560676800018096836" class="section">2.4 mbeddr</h2>
        <p class="body">Depending on what you want to do with mbeddr, we provide three different installation methods. The following list describes general differences between these methods, the next sections describe each of them in detail:</p>
        <ul>
          <li>
            <strong class="bold">mbeddr IDE:</strong> sufficient, if  you want to use mbeddr, but not change or extend it. The mbeddr IDE is a stripped-down version of MPS, which just provides the UI facilities required for using mbeddr. It already comes with the mbeddr distribution and is the easiest way to get mbeddr running on your machine.
          </li>
          <li>
            <strong class="bold">mbeddr Plugin Distribution:</strong> suitable if you want to use and extend mbeddr. With this approach, you install MPS manually on your machine and deploy the mbeddr plugins into this installation.
          </li>
          <li>
            <strong class="bold">mbeddr from Sources:</strong> use this option if you want total control over what you are doing with mbeddr or want to stay at the bleeding edge of mbeddr development. This way you can just use mbeddr, extend it or even change the sources and try out things. You can pull from the current master or even check out experimental branches. 
          </li>
        </ul>
        <div>
          <h3 id="sid1560676800018098615" class="section">2.4.1 mbeddr IDE</h3>
          <p class="body">With the mbeddr IDE you can use all languages provided by mbeddr and write applications with them. Installing the IDE is simple, as you just have to perform two tasks:</p>
          <ul>
            <li>
              install a JDK (<span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span> lists which version is required for your platform) on your local machine and make sure it is available on the path (see <span class="sectRef">Section <a href="#sid4711768717894380508">Adding Tools to the System Path</a></span>).
            </li>
            <li>
              download from the mbeddr GitHub page the mbeddr IDE that fits to your platform  and unzip the downloaded ZIP file: <a href="https://github.com/mbeddr/mbeddr.core/releases" class="url">https://github.com/mbeddr/mbeddr.core/releases</a>
              
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid1560676800018098638" class="section">2.4.2 mbeddr Plugin Distribution</h3>
          <p class="body">
            In case you do not want to change mbeddr but still want to be able to extend it (so you&apos;ll need MPS&apos; language engineering facilities), we recommend installing the distribution. This just requires downloading a ZIP file and copying a bunch of plugins into your existing MPS installation. If you do not have an existing MPS installation on your machine, please follow the steps described in <span class="sectRef">Section <a href="#sid6403595147461065892">JetBrains MPS and Java</a></span>.
          </p>
          <p class="body">
            To install the distribution, please download the distribution ZIP file from the mbeddr GitHub release page: <a href="https://github.com/mbeddr/mbeddr.core/releases" class="url">https://github.com/mbeddr/mbeddr.core/releases</a>. This ZIP file contains the mbeddr plugins for MPS. After unzipping, please take all folders inside the <code class="code">plugins</code> directory and copy them into the <code class="code">plugins</code> directory of  your MPS installation <sup id="sid1560676800018098638_footnote_1_origin" title="Note that there is also a plugin (without the s) directory under MPS!" class="footnodeOrigin"><a href="#sid1560676800018098638_footnote_1_text">1</a></sup>. So, for example, after copying, there should be a <code class="code">$MPS_DIR$/plugins/mbeddr.core</code> directory.
          </p>
          <p class="footnoteText" id="sid1560676800018098638_footnote_1_text">
            <a href="#sid1560676800018098638_footnote_1_origin">1:</a> 
             
            Note that there is also a <code class="code">plugin</code> (without the <code class="code">s</code>) directory under MPS!
          </p>
        </div>
        <div>
          <h3 id="sid1560676800018098647" class="section">2.4.3 mbeddr Source Installation</h3>
          <div>
            <h4 id="sid1415849632045903128" class="section">2.4.3.1 Introduction</h4>
            <p class="body">
              Installing mbeddr from sources gives you total control over what you want to do with mbeddr. We rather recommend working with the distribution or the mbeddr IDE, except you have good reasons not to. The following list provides some of these <em class="emph">good reasons</em>:
            </p>
            <ul>
              <li>
                want to stay at the bleeding edge of mbeddr development by using the most recent version on <code class="code">master</code>
                
              </li>
              <li>plan to fork mbeddr</li>
              <li>need to regularly update your local mbeddr</li>
            </ul>
            <p class="body">
              There are two ways to get the mbeddr source installation. One of them is a completely manual installation as it is described below in <span class="sectRef">Section <a href="#sid1415849632045904218">Manual Source Installation</a></span>. And the other one is an equivalent automated interactive process, an installer written in Python, described in <span class="sectRef">Section <a href="#sid1415849632045903752">Source Distribution Python Installer</a></span>
              
            </p>
          </div>
          <div>
            <h4 id="sid1415849632045903752" class="section">2.4.3.2 Source Distribution Python Installer</h4>
            <p class="body">
              The installer is hosted at <a href="http://mbeddr.fortiss.org/" class="url">http://mbeddr.fortiss.org/</a>. To be able to run it you have to install some of the prerequisites required by MPS and mbeddr, and also the installer itself.
            </p>
            <ul>
              <li>Java Development Kit (JDK)</li>
              <li>Apache Ant</li>
              <li>git client</li>
              <li>Python 3</li>
            </ul>
            <p class="body">
              For the hints on how to install the prerequisites, especially for the Windows platform, please, follow to this website: <a href="http://mbeddr.fortiss.org/download/prereq/" class="url">http://mbeddr.fortiss.org/download/prereq/</a>. After the prerequisites are installed, you are ready to run the installer. The installer will check that you have installed everything right before setting up mbeddr. 
            </p>
            <p class="body">
              To use the installer, please, download it from <a href="http://mbeddr.fortiss.org/download/" class="url">http://mbeddr.fortiss.org/download/</a>, run it, and then simply follow the instructions it gives. <br/>
<br/>
After the installer has finished, you should have the following installed and configured:<br/>

            </p>
            <ul>
              <li>mbeddr source code</li>
              <li>MPS of a matching version</li>
              <li>CBMC checker</li>
            </ul>
            <p class="body">
              You might still want to install other optional tools used by mbeddr, as it is described in this chapter. <span><strong class="todo">[ToDo: 
              Make a reference to gcc&amp;make and graphviz.
              ]</strong></span>
              
            </p>
            <p class="body">
              The website with the installer provides additional information on how to run the installer, and what to do next, after it has finished.<br/>
<br/>
Basically the installer is an automation, which performs for you the steps, described below in <span class="sectRef">Section <a href="#sid1415849632045904218">Manual Source Installation</a></span>. Thus, normally, you would never need to perform the steps as described below. However, we provide it for completeness and for troubleshooting purposes, in the rare case when the installer fails to work right.
            </p>
          </div>
          <div>
            <h4 id="sid1415849632045904218" class="section">2.4.3.3 Manual Source Installation</h4>
            <p class="body">The following guide will explain you how to install mbeddr from sources manually. Please carry out the following instructions step by step in their defined order:</p>
            <ol>
              <li>
                First, in order to clone the mbeddr repository, you will need to have a git client installed on your local machine (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>).
              </li>
              <li>
                Second, you will need an Apache ant installation (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>). After the installation, please make sure the <code class="code">ant</code> binary is in your path (see <span class="sectRef">Section <a href="#sid4711768717894380508">Adding Tools to the System Path</a></span>).
              </li>
              <li>
                If you do not already have an MPS installation on your machine, please follow the installation guide in <span class="sectRef">Section <a href="#sid6403595147461065892">JetBrains MPS and Java</a></span>.
              </li>
              <li>
                Next, clone the mbeddr repository from GitHub onto your local machine. You can find it at <a href="https://github.com/mbeddr/mbeddr.core" class="url">https://github.com/mbeddr/mbeddr.core</a>, the repository URLs to be used for cloning (for various protocols) can also be found at this URL.
              </li>
              <li>
                After cloning the repository, you now have to build all languages shipped with mbeddr. For this task we provide a shell script named <code class="code">buildLanguages</code>, which is located inside the <code class="code">mbeddr.core/code/languages</code> directory. Depending on your operating system, you either use the one with <code class="code">.bat</code> (Windows) or <code class="code">.sh</code> (Linux/Mac) file extension. Before running the script, you first have to copy the <code class="code">build.properties.example</code> into the same folder as the script and rename it to <code class="code">build.properties</code>. Next, open this file and change the paths (<em class="emph">On Windows</em>, <strong class="bold">you have to use forward slashes as directory separators even on Windows!</strong>) of the following properties:<br/>
<br/>
  *  <code class="code">mps.home</code>: points to the <code class="code">Contents</code> folder of your MPS installation<br/>
  *  <code class="code">mps.platform.caches</code>: points to a folder, which is used by the build process to store temporary files<br/>
  *  <code class="code">mbeddr.github.core.home</code>: points to the mbeddr.core folder of your local mbeddr repository <br/>
<br/>
You can now execute the <code class="code">buildLanguages</code> script from within the <code class="code">mbeddr.core/code/languages</code> folder. At the end of the build you should get a message stating <code class="code">BUILD SUCCESSFUL</code>. Depending on the performance of your machine, running the script takes between 20 and 45 minutes.
              </li>
              <li>
                We now have to make future application projects aware of the <code class="code">mbeddr.core</code> languages in your local repository. Start MPS and go to the <span class="menuClick"><span><span class="menuItem">File</span>&rarr;</span><span><span class="menuItem">Settings</span></span></span> (on the Mac it is under <span class="menuClick"><span><span class="menuItem">MPS</span>&rarr;</span><span><span class="menuItem">Preferences</span></span></span>)  and select the <code class="code">Path Variables</code> in the <code class="code">IDE Settings</code>. Create a path variable named <code class="code">mbeddr.github.core.home</code> and point to the root directory of your mbeddr git clone (e.g. <code class="code">/Users/peter/Documents/mbeddr.core</code>).
              </li>
              <li>
                Finally, go to the <code class="code">Global Libraries</code> section in the IDE settings (see <a href="#sid2564556814935136498" class="imgRef">Fig. 2.4.3.3-A</a>). Create a library named <code class="code">mbeddr.core</code> that points to the <code class="code">code</code> directory of the github repository directory (<code class="code">/Users/peter/Documents/mbeddr.core/code</code>). This library must point to the <code class="code">code</code> directory of the checkout so that all languages are below it, including <em class="emph">core</em> and <em class="emph">mpsutil</em>. Because we had earlier defined the path variable, it will use the path variable for defining the library. Notice that this is a global setting, which means it has to be performed only once before your first application project. 
              </li>
            </ol>
            <div class="imagecontainer" id="sid2564556814935136498">
              <div class="image">
                <img src="images/core/SettingsGlobalLibraries.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  2.4.3.3-A</b>
                  
                </p>
              </div>
            </div>
            <p class="body">Congrats: you are now ready to build your first project with mbeddr.</p>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid6403595147461065892" class="section">2.5 JetBrains MPS and Java</h2>
        <p class="body">
          The mbeddr system is based on JetBrains MPS, an open source language workbench available from <a href="http://www.jetbrains.com/mps/" class="url">http://www.jetbrains.com/mps/</a>. MPS is available for different platforms, like Windows, Mac and Linux. Please make sure you pick the right installer for your platform and the proper version (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>). When running the installer, please make sure you install MPS in a path that does not contain blanks in any of its directory or file names (not even in the <code class="code">MPS 3.1</code> folder). This will simplify some of the command line work you may want to do. After installing MPS, please follow the platform-specific steps mentioned below.
        </p>
        <ul>
          <li>
            <em class="emph">Windows:</em> If you installed MPS with the Windows-specific installer, Java was already installed along with it. Open the <code class="code">bin</code> folder and edit, depending on weather you are running mbeddr on a 32- or 64-bit machine, either <code class="code">mps.exe.vmoptions</code> or <code class="code">mps64.exe.vmoptions</code>. To make MPS run smoothly, increase the <code class="code">MaxPermSize</code> setting to at least <code class="code">512m</code>. This JVM setting controls how much space is occupied for loaded Java classes, methods etc.
          </li>
          <li>
            <em class="emph">Linux:</em> Make sure you have installed Java on your machine (Version 1.6 or higher). Next, open the <code class="code">bin</code> folder and edit the <code class="code">mps.vmoptions</code>. To make MPS run smoothly, increase the <code class="code">MaxPermSize</code> setting to at least <code class="code">512m</code>.
          </li>
          <li>
            <em class="emph">Mac:</em> Make sure you have installed Java on your machine (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>) Next, open the <code class="code">app</code> folder (right click on the application and do a <em class="emph">Show package contents</em>) and open the <code class="code">Contents</code> folder. Open the <code class="code">Info.plist</code> file with a text editor and navigate to the entry <code class="code">VMOptions</code> at the very bottom of the file. Edit the <code class="code">mps.vmoptions</code> to make MPS run smoothly, increase the <code class="code">-XX:MaxPermSize</code> setting to at least <code class="code">512m</code>.
          </li>
        </ul>
        <p class="body">
          If your MPS does not start with the error message <em class="emph">Could not create the VM</em>, then your system has less main memory available than required. In this case, you should open the previously edited file (<code class="code">*.vmoptions</code> or <code class="code">Info.plist</code>) and decrease the value of the <code class="code">-Xmx</code> parameter in small steps, until you are able to start MPS. This parameter controls the maximum size of dynamic memory that the JVM provides to MPS.
        </p>
      </div>
      <div>
        <h2 id="sid4711768717894380508" class="section">2.6 Adding Tools to the System Path</h2>
        <p class="body">
          For mbeddr/MPS to be able to access command-line tools, their binaries have to be added to your system&apos;s <code class="code">PATH</code> variable. You can do this either globally, or locally in the script that starts up MPS. The way how the <code class="code">PATH</code> variable is changed depends on your platform. The table below shows these platform-specific differences.
        </p>
        <p class="body">
          <br/>
For changing the variable <code class="code">locally</code>, open your <em class="emph">start-up script</em> that is located inside your MPS installation directory. Next, add the <em class="emph">PATH redefinition</em> at the beginning of that file, replacing <code class="code">&lt;your  path&gt;</code> with the file system path of the tool you want to add to the path. For details see the second column of the table below.
        </p>
        <p class="body">
          <br/>
To change the path globally, see the right column of the table below. It explains how to add tools to the global <code class="code">PATH</code> on the different platforms. Here, you should also replace <code class="code">&lt;your  path&gt;</code> with the file system path that points to your tool.
        </p>
        <div class="tableContainer" id="sid4711768717894402160">
          <div class="table">
            <table>
              <tr><td></td><th>locally</th><th>globally</th></tr><tr><th>Windows</th><td><em class="emph">start-up script:</em><br/>
mps.bat<br/>
<br/>
<em class="emph">PATH redefinition:</em> <br/>
set PATH=&lt;your path&gt;;%PATH%</td><td>in your Windows System Settings, change the value of the <code class="code">PATH</code> variable by adding your path to the existing paths: <code class="code">&lt;existing paths&gt;;&lt;your path&gt;</code>
              </td></tr><tr><th>Linux/Mac</th><td><em class="emph">start-up script:</em><br/>
mps.sh <br/>
<br/>
<em class="emph">PATH redefinition:</em> <br/>
export PATH:&lt;your path&gt;;$PATH</td><td>in general you will have to add your tool path to the <code class="code">PATH</code> variable. However, the way how this is done depends on your actual operating system and the shell you are using. Since nowadays almost every Unix system comes with a <code class="code">bash</code> shell, we describe the process just for tis scenario. In case you using a different shell, please refer to the vendor&apos;s documentation. <br/>
<br/>
First, create or open your existing <code class="code">.bash_profile</code>, that is located inside your home folder. Next, just add the following line to it, save the file and restart your shell:<br/>
<code class="code">export PATH=&lt;your path&gt;:$PATH</code>
              </td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              2.6-A</b>
              
            </p>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid2045083395016240670" class="section">2.7 Required Tools and Versions</h2>
        <p class="body">The following table lists all tools mentioned in this guide, on which platform they are needed, in which version, which components are required and where to get the tool from.</p>
        <div class="tableContainer" id="sid2045083395016240672">
          <div class="table">
            <table>
              <tr><th>Tool</th><th>Platform</th><th>Version</th><th>Required components</th><th>URL</th></tr><tr><td>MinGW</td><td>Windows</td><td>newest</td><td>mingw32-gcc (v 4.8.1), <br/>
mingw32-make (v 3.82.90-2), <br/>
mingw32-gdb (v 7.6.1),<br/>
msys-base (v 2013072300) and<br/>
msys-coreutils (v 5.97-3)</td><td><a href="http://http://www.mingw.org/" class="url">http://http://www.mingw.org/</a>
              </td></tr><tr><td>XCode</td><td>Mac</td><td>newest</td><td>gcc and make</td><td>-</td></tr><tr><td>Brew</td><td>Mac</td><td>newest</td><td>gdb</td><td><a href="http://brew.sh" class="url">http://brew.sh</a>
              </td></tr><tr><td>make</td><td>Linux</td><td>newest</td><td>-</td><td>-</td></tr><tr><td>gcc</td><td>Linux</td><td>newest</td><td>-</td><td>-</td></tr><tr><td>gdb</td><td>Linux</td><td>newest</td><td>-</td><td>-</td></tr><tr><td>Graphviz</td><td>all</td><td>2.30</td><td>-</td><td><a href="http://graphviz.org" class="url">http://graphviz.org</a>
              </td></tr><tr><td>CBMC</td><td>all</td><td>4.9</td><td>-</td><td><a href="http://www.cprover.org/cbmc" class="url">http://www.cprover.org/cbmc</a>
              </td></tr><tr><td>ant</td><td>all</td><td>newest</td><td>-</td><td><a href="http://ant.apache.org" class="url">http://ant.apache.org</a>
              </td></tr><tr><td>git</td><td>all</td><td>newest</td><td>-</td><td>-</td></tr><tr><td>MPS</td><td>all</td><td>3.1.4 or 3.1.5 <br/>
(MPS 3.2 not yet supported)</td><td>-</td><td><a href="http://www.jetbrains.com/mps" class="url">http://www.jetbrains.com/mps</a>
              </td></tr><tr><td>JDK</td><td>Windows</td><td>1.6 or higher</td><td>-</td><td>-</td></tr><tr><td></td><td>Linux</td><td>1.6 or higher</td><td>-</td><td>-</td></tr><tr><td></td><td>Mac</td><td>1.6</td><td>-</td><td>-</td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              2.7-A</b>
              
            </p>
          </div>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid1481709176728354858" class="section">3 Fundamentals</h1>
      <div>
        <h2 id="sid1481709176728444538" class="section">3.1 The MPS UI</h2>
        <div>
          <h3 id="sid1481709176728447354" class="section">3.1.1 Overall Structure</h3>
          <p class="body">
            Fundamentally, MPS looks and works like any modern IDE. <a href="#sid1481709176728444850" class="imgRef">Fig. 3.1.1-A</a> shows an overview. We describe the various marked up parts below.
          </p>
          <div class="imagecontainer" id="sid1481709176728444850">
            <div class="image">
              <img src="images/fundamental/markedUpUI.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.1.1-A: </b>The MPS IDE, with major components marked up.
              </p>
            </div>
          </div>
          <p class="body">
            <b>A Menu Bar</b>&nbsp;&nbsp;Like all IDEs and applications MPS comes with a menu bar. Depending on your OS it is located at the top of the MPS window (on Windows) or at the top of the screen (Mac). 
          </p>
          <p class="body">
            <b>B Tool Bar</b>&nbsp;&nbsp;The tool bar contains quick access buttons for various functionalities and the run configuration selection combo box for running and debugging programs.
          </p>
          <p class="body">
            <b>C Project Explorer / Logical View</b>&nbsp;&nbsp;The Project Explorer is the central view on the left side of the screen. It can show several different things: the Logical View of the project (solutions, folders, models), a File System View (directories, files) as well as various favourites lists. In the context of the user guide we mostly talk about the Logical View, which is why we use the terms Project Explorer and Logical View synonymously. 
          </p>
          <p class="body">
            The Logical View contains the project structure. It is the primary means for navigating around mbeddr (and MPS in general). We describe the project structure separately below (<span class="sectRef">Section <a href="#sid1481709176728451319">Project Structure</a></span>). The Project Explorer is an example of a Tool (aka View in Eclipse). 
          </p>
          <p class="body">
            <b>Editor</b>&nbsp;&nbsp;The main part of the MPS window is made up of the editor pane. The editor pane contains any number of editors, each with its own Tab. Each editor edits a so-called root (see <span class="sectRef">Section <a href="#sid1481709176729756665">Nodes, Roots and Concepts</a></span>). It is also possible to split the editor pane into several editors (arranged vertically and horizontally) through the <span class="menuClick"><span><span class="menuItem">Window</span></span></span> menu.
          </p>
          <p class="body">
            <b>Logical Inspector</b>&nbsp;&nbsp;The Inspector is associated with the editor. For each selected node in the currently active editor, the Inspector provides additional (read/write) information. The particular contents of the inspector are determined by the language definition (of the concept that defines the selected node). Sometimes it shows nothing useful, sometimes it just shows additional information (such as the statically evaluated value of an expression), and sometimes it contains additional stuff that can be edited (and is hence essential for the editing experience). We suggest to always keep it open.
          </p>
          <p class="body">
            <b>G Status Bar</b>&nbsp;&nbsp;The status bar shows status information about MPS, including the version control status, the current branch, memory usage and various other details.
          </p>
          <p class="greyBox">
            Note that the Status Bar, the Tool Bar Buttons as well as the little tool placeholder tabs can all be hidden through the <span class="menuClick"><span><span class="menuItem">View</span></span></span> menu.
          </p>
        </div>
        <div>
          <h3 id="sid1481709176728447485" class="section">3.1.2 Tools</h3>
          <p class="body">
            Tools are the windows that are arranged around the edges of the MPS window. In this section we describe the most important ones (some language-specific tools are explained in their respective context). Generally, they can be activated through the <span class="menuClick"><span><span class="menuItem">View</span>&rarr;</span><span><span class="menuItem">Tool Windows</span></span></span> menu. 
          </p>
          <p class="body">
            Tools can be arranged around the edges of the MPS window. Every Tool has a default position on one particular edge of the MPS window. However, by right-clicking on to the title bar, other edges (and a floating mode) can be selected for each Tool. Tools can also be hidden. If not shown, the border shows a little placeholder (like the Context Sidebar tool near D on the left and H on the right). If a tool has a number associated with it (such as the 1 in case of the Logical View), <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">&lt;Number&gt;</span></span></span> can be used to select this window.
          </p>
          <p class="body">
            <b>Project Explorer</b>&nbsp;&nbsp;As mentioned above, the Project Explorer (in its Logical View mode) contains the overall structure of the project. It is the primary means of navigating around your code. We&apos;ll describe it in more detail in <span class="sectRef">Section <a href="#sid1481709176728451319">Project Structure</a></span>.
          </p>
          <p class="body">
            <b>Changes</b>&nbsp;&nbsp;The Changes view shows the files that have been changed since the last commit. This is part of MPS&apos; version control support and is discussed in more detail in <span class="sectRef">Section <a href="#sid1481709176729755835">Version Control</a></span>.
          </p>
          <p class="body">
            <b>Model Checker</b>&nbsp;&nbsp;The Model Checker shows the result of running <span class="menuClick"><span><span class="menuItem">Check Model</span></span></span> on a project, solution, language or model. It shows warnings and errors. Double-clicking on an element opens this element in the editor. There are various options for grouping and filtering the contents using the buttons on the left. You should play around with these options. <a href="#sid1481709176729756382" class="imgRef">Fig. 3.1.2-A</a> shows an example. Note that errors that result from a transformation (code generation) are not shown here. They are shown in the Messages view.
          </p>
          <div class="imagecontainer" id="sid1481709176729756382">
            <div class="image">
              <img src="images/fundamental/modelchecker.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.1.2-A: </b>The model checker showing an error in this document.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Messages</b>&nbsp;&nbsp;This view shows (mostly) messages, errors and warning resulting from the build process. These include problems in the transformation as well as problems with the subsequent compilation and link process. If an error shows up here during build, it is likely that there has already been a problem with the input models. In this case, please run the Model Checker on the respective parts of the project and fix all errors reported there before attempting to generate.
          </p>
          <p class="body">
            <b>Visualizations</b>&nbsp;&nbsp;A visualization is a read-only diagram of some program structures. It is layouted automatically. Users can double-click on nodes and labels to jump back into the code. <a href="#sid1481709176729810904" class="imgRef">Fig. 3.1.2-B</a> shows an example. To open a visualization, users can press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">V</span></span></span> or use the context menu to open a visualization if the selected node defines any. Note that the view also supports changing between multiple visualizations for the same node (if the node defines several of them) through the combobox. The buttons support navigating through the recent diagrams, zooming, and to export the diagram as a PNG file.
          </p>
          <div class="imagecontainer" id="sid1481709176729810904">
            <div class="image">
              <img src="images/fundamental/vis.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.1.2-B: </b>Visualization of module dependencies.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Tree Views</b>&nbsp;&nbsp;Tree views are similar to visualizations in that they are contributed by particular nodes, they are shown in a special view, double-click on the tree node selects the node in the editor, and in that a node can define zero, one or more tree view structures. They are activated through <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">O</span></span></span> or the context menu.
          </p>
          <div class="imagecontainer" id="sid1481709176729812007">
            <div class="image">
              <img src="images/fundamental/treeview.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.1.2-C: </b>Tree view of the document structure.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Event Log</b>&nbsp;&nbsp;The event log shows internal MPS errors. You can generally ignore this Tool except for debugging internal MPS or mbeddr errors.
          </p>
          <p class="body">
            <b>Version Control </b>&nbsp;&nbsp;This tool shows the version control console, essentially a stream of all version control operations. Typically not needed.
          </p>
          <p class="body">
            <b>Explorer</b>&nbsp;&nbsp;The explorer shows the low level tree structure of a node. It is more like a debugging tool and is not used regularly. It can be opened for a node by selecting the node and choosing <span class="menuClick"><span><span class="menuItem">Show Node in Explorer</span></span></span> from the context menu. <a href="#sid1481709176728451511" class="imgRef">Fig. 3.1.2-D</a> shows an example.
          </p>
          <div class="imagecontainer" id="sid1481709176728451511">
            <div class="image">
              <img src="images/fundamental/explorer.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.1.2-D: </b>An example node shown in the explorer.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid1481709176728451319" class="section">3.2 Project Structure</h2>
        <div>
          <h3 id="sid1481709176729756665" class="section">3.2.1 Nodes, Roots and Concepts</h3>
          <p class="body">
            MPS programs are trees of nodes (this is the structure you can see in the Node Explorer). Each node can have several children, resulting in the tree structure. However, there can also be cross-references between nodes in a program tree. So this makes MPS programs a graph, but one with a primary containment hierarchy. And in fact, a complete MPS program consists of several such trees, we call each of theses trees a Root. Importantly, each Root gets its own editor tab in MPS. References can be across Root boundaries. <a href="#sid1481709176729816571" class="imgRef">Fig. 3.2.1-A</a> shows the structure. In <a href="#sid1481709176729817605" class="imgRef">Fig. 3.2.2-A</a>, all the implementation modules (blue I icon) such as <code class="code">Components</code> or <code class="code">StateMachines</code> are roots.
          </p>
          <div class="imagecontainer" id="sid1481709176729816571">
            <div class="image">
              <img src="images/fundamental/nodesRoots.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.2.1-A: </b>This figure shows two roots (grey boxes). Each of them has a number of nodes inside (the letters). The solid lines are the parent-child relationships. The dotted lines are the cross references. Note that references can cross root boundaries.
              </p>
            </div>
          </div>
          <p class="body">
            Each node is an instance of a language concept. The language concept defines all properties of its instance nodes, including its visual representation (notation, concrete syntax). Concepts are created as part of a language. <a href="#sid1481709176729815548" class="imgRef">Fig. 3.2.1-B</a> shows this relationship. 
          </p>
          <div class="imagecontainer" id="sid1481709176729815548">
            <div class="image">
              <img src="images/fundamental/nodesAndConcepts.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.2.1-B: </b>The relationship between nodes and concepts.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid1481709176729756652" class="section">3.2.2 Project, Solutions, Models, Folders, Roots</h3>
          <p class="body">
            MPS has an elaborate project structure. We discuss the most important ingredients in this section. Each of the ingredients is used for configuring different aspects of the overall project. We describe this in <span class="sectRef">Section <a href="#sid1481709176729814334">Using Languages and Devkits</a></span>. The basics on the various kinds of dependencies between these ingredients are discussed  below. The (vast load of) details are  discussed in <a href="https://github.com/mbeddr/mbeddr.core/wiki/Dependencies-and-Classpath-in-MPS" class="url">https://github.com/mbeddr/mbeddr.core/wiki/Dependencies-and-Classpath-in-MPS</a>.
          </p>
          <div class="imagecontainer" id="sid1481709176729817605">
            <div class="image">
              <img src="images/fundamental/projectStructure.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.2.2-A: </b>A typical MPS project structure. Details are discussed in the running text.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Models</b>&nbsp;&nbsp;MPS is fundamentally a file-based system. The roots discussed above are stored in XML files (these can then be managed with existing version control systems, see <span class="sectRef">Section <a href="#sid1481709176729755835">Version Control</a></span>). These files are called <em class="emph">models</em> in MPS. Each model contains a number of roots (which then have arbitrary substructure). In <a href="#sid1481709176729817605" class="imgRef">Fig. 3.2.2-A</a>, the purple diamonds with the little M inside are models. Models als determine which languages are used for the programs/roots/nodes inside the model. Models can import each other in order to be able to establish cross-references. These dependencies are established in the <code class="code">Model Properties</code> dialog (Dependencies tab).
          </p>
          <p class="body">
            Models are important because they represent the only real &quot;physical structure&quot; in MPS. Hence they are the granularity relevant to version control (since they are files, it is models that are seen by file-based tools such as git). Also, the MPS transformation and generation engine always processes complete models. So in order to keep (partial) generation times low, you should split your overall system into a reasonable number of (relatively small-sized) models. See <span class="sectRef">Chapter <a href="#sid2101724341003970568">Structuring Complex Projects</a></span> for details.
          </p>
          <p class="body">
            <b>Solutions</b>&nbsp;&nbsp;From a user&apos;s perspective, a solution is where application code lives (this is in contrast to Languges, which is where language definitions reside). Technically, a solution is a way to group models. A solution can contain any number of models and each model resides in exactly one solution. In <a href="#sid1481709176729817605" class="imgRef">Fig. 3.2.2-A</a>, the orange <code class="code">S</code> is a solution. Solutions can also have dependencies onto other solutions.
          </p>
          <p class="body">
            <b>Project</b>&nbsp;&nbsp;A project contains several solutions. Any particular solution can be used in several projects, so projects do not own the solutions (in contrast to models, which are owned by a solution). A project is really more like a workspace in Eclipse: it&apos;s a collection of solutions which you want to work on for a particular task. The project defines various settings, preferences and view options.
          </p>
        </div>
        <div>
          <h3 id="sid1481709176729814334" class="section">3.2.3 Using Languages and Devkits</h3>
          <p class="body">
            To be able to write code in a model, that model must specify which languages should be used to write the code. As shown in <a href="#sid1481709176729819620" class="imgRef">Fig. 3.2.3-A</a>, these languages are specified in the <code class="code">Used Languages</code> tab of the model&apos;s properties.
          </p>
          <div class="imagecontainer" id="sid1481709176729819620">
            <div class="image">
              <img src="images/fundamental/usedLangs.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.2.3-A: </b>The Used Languages tab of a model properties dialog.
              </p>
            </div>
          </div>
          <p class="body">
            In the Used Languages spec, users can also add dependencies on devkits. A <em class="emph">Devkit</em> is a group of languages. For example, there are several languages that deal with requirements in mbeddr. Instead of adding all of these manually to any given model, users can simply add the <code class="code">com.mbeddr.reqtrace</code> devkit to a model. This simplifies configuration and avoids clutter.
          </p>
        </div>
        <div>
          <h3 id="sid1481709176729756657" class="section">3.2.4 Paths and Libraries</h3>
          <p class="body">A library is essentially a directory that contains additional languages or solutions (it is like a search path or the Java classpath). Instead of adding a needed solution or language to the project, it can remain &quot;outside&quot; the project and made visible by pointing a library to the file system folder. Libraries can be defined specifically for a project (Project Libraries) or globally (Global Libraries). Both are created via the Preferences.</p>
          <p class="body">
            In order not to hard code absolute paths in the definition of libraries, you can define a path variable. A path variable is a name (such as <code class="code">MyProjectDir</code>) plus a directory (such as <code class="code">/Users/markus/mbeddr/project1</code>). If you now define a reference to a libary in, say, <code class="code">/Users/markus/mbeddr/project1/my/folder/sol.mps</code>, then this stored in the project as <code class="code">${myProjectDir}/my/folder/sol.mps</code> even though this is <em class="emph">not</em> visible in the UI. If the same library is accessed on another computer, the its definition of the <code class="code">MyProjectDir</code> variable is used to resolve it.
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid1481709176727862949" class="section">3.3 The Editor</h2>
        <div>
          <h3 id="sid2101724341004008313" class="section">3.3.1 Usability</h3>
          <p class="body">
            MPS is a projectional editor. This means that the editing actions as you know them from a text editor may not work exactly the same way as in a text editor. This leads to a lot of benefits in terms of language modularity and notational flexibility. It also has the potential drawback that the  editor may not work exactly as you&apos;d expect. To better understand how the editor works and what MPS does to achieve quite good editor usability, we suggest you watch this video: <a href="http://www.youtube.com/watch?v=PvcXD4cFM4s" class="url">http://www.youtube.com/watch?v=PvcXD4cFM4s</a>
            
          </p>
          <p class="body">
            In addition, the section on <span class="sectRef">Section <a href="#sid7992580511417017508">Keyboard Shortcuts</a></span> has a lot of important keyboard shortcuts. Please take the time to read this section! The cheat sheet in <span class="sectRef">Section <a href="#sid7992580511418100707">Cheat Sheet</a></span> also summarizes them again.
          </p>
        </div>
        <div>
          <h3 id="sid2101724341004008376" class="section">3.3.2 Projection Modes</h3>
          <p class="body">Since MPS is a projectional editor, the same program can be shown with different notations. Users can switch the notation at any time to match the task they are working on. The specific available notations are discussed throughout this user guide when we discuss the respective languages; examples include a tabular notation for state machines, a textual vs. graphical notation for wiring components, as well as the regular and the presentation mode in the kinds of documents you may be reading right now.</p>
          <p class="body">
            All notations can be switched from one common menu location: <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Modes</span>&rarr;</span><span><span class="menuItem">...</span></span></span>. See also <a href="#sid2101724341004022975" class="imgRef">Fig. 3.3.2-A</a>. The menu shows only those options that are valid for the languages used in the current model, and the selection is specific for any given editor/root. The specific entries are discussed in the context of their respective languages. 
          </p>
          <div class="imagecontainer" id="sid2101724341004022975">
            <div class="image">
              <img src="images/fundamental/projectionModes.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.3.2-A: </b>The menu to change projection modes. The specific entries are discussed in the context of their respective languages.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid7992580511417017508" class="section">3.4 Keyboard Shortcuts</h2>
        <p class="body">Here is a summary of the most important keyboard shortcuts. Please take the time to learn them. It pays off! At the end of this section you can also find a cheatsheet that you can print and put next to your computer.</p>
        <p class="body">
          <b>Entering Code</b>&nbsp;&nbsp;In MPS you can only enter code that is available from the code completion menu. Using aliases and other &quot;tricks&quot;, MPS manages to make this feel <em class="emph">almost</em> like text editing. Here are some hints though:
        </p>
        <ul>
          <li>
            As you start typing, the text you&apos;re entering remains red, with a light red background. This means the string you&apos;ve entered has not yet <em class="emph">bound</em>.
          </li>
          <li>Entered text will bind if there is only one thing left in the code completion menu that starts with the substring you&apos;ve typed so far. An instance of the concept selected by the text you have entered will be created and the red color goes away.</li>
          <li>
            As long as text is still red, you can press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> to explicitly open the code completion menu, and you can select from those concepts that start with the substring you have typed in so far.
          </li>
          <li>
            If you want to go back and enter something different from what the entered text already preselects, press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> again. This will show the whole code completion menu.
          </li>
          <li>Finally, if you&apos;re trying to enter something that does not bind at all because the prefix you&apos;ve typed does not match anything in the code completion menu, there is no point in continuing to type; it won&apos;t ever bind. You&apos;re probably trying to enter something that is not valid in this place. Maybe you haven&apos;t included the language module that provides the concept you have in mind?</li>
          <li>
            Some language features may only be accessible via an intention. If you don&apos;t know how to go on, press <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span> and see if the intentions window has something useful to offer.
          </li>
        </ul>
        <p class="body">
          <b>Entering Expressions</b>&nbsp;&nbsp;Expressions can be entered linearly. So if you have a number literal <code class="code">42</code> and you want to change that expression to <code class="code">42 + 2</code>  you can simply move to the right side of the <code class="code">42</code> and type <span class="keyPress"><span><span class="key">+</span></span></span> and then <span class="keyPress"><span><span class="key">2</span></span></span>. However, if you want to add something on the left side of an expression (e.g. changing <code class="code">42</code> to <code class="code">10 + 42</code>) then you have to move to the <em class="emph">left</em> side of the <code class="code">42</code> and enter <code class="code">+</code> as well; you can then enter <code class="code">10</code>.
        </p>
        <p class="body">
          <b>Parentheses</b>&nbsp;&nbsp;Imagine you have already entered <code class="code">4 + 2 * 3</code>. The <code class="code">*</code> binds more tightly, so the tree root is the <code class="code">+</code>, with the <code class="code">4</code> and the <code class="code">*</code> as children. If you now want to change this to <code class="code">(4 + 2) * 3</code> you have to set parentheses. This is supported in a natural way: just move to the left of the <code class="code">4</code> and enter an opening parenthesis. It will remain red, because the balacing parenthesis is still missing. You can now go to any other place in the expression, in this case, to the right of the <code class="code">2</code>, and enter the closing parenthesis. The tree is restructured accordingly.
        </p>
        <p class="body">
          <b>Navigation</b>&nbsp;&nbsp;Navigation in the source works as usual using the cursor keys or the mouse. References can be followed (&quot;go to definition&quot;) either by <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Click</span></span></span> or by using <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">B</span></span></span>. The reverse is also supported. The context menu on a program element supports Find Useages. This can also be activated via <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">F7</span></span></span>. Within an mbeddr program, you can also press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F12</span></span></span> to get an outline view that lists all top level or important elements in that particular program so you can navigate to it easily. <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">E</span></span></span> will show you the recently closed editors, in case you&apos;ve closed too many. More generally, <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Tab</span></span></span> can be used to switch between windows in MPS.
        </p>
        <p class="body">
          <b>Selection</b>&nbsp;&nbsp;Selection is different than in normal text editors. <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up/Down</span></span></span> can be used to select along the tree. For example consider a local variable declaration <code class="code">int x = 2 + 3 * 4;</code> with the cursor at the <code class="code">3</code>. If you now press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up</span></span></span>, the <code class="code">3 * 4</code> will be selected because the <code class="code">*</code> is the parent of the <code class="code">3</code>. Pressing <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up</span></span></span> again selects <code class="code">2 + 3 * 4</code>, and the next <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up</span></span></span> selects the whole local variable declaration. You can also select with <span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">Up/Down</span></span></span>. This selects siblings in a list. For example, consider a statement list as in a function body:
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">void aFunction() {<br/>
  int x;<br/>
  int y;<br/>
  int z;<br/>
}</pre>
        </div>
        <p class="body">
          Iimagine the cursor in the <code class="code">x</code>. You can press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up</span></span></span> once to select the whole <code class="code">int x;</code> and then you can use <span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">Down</span></span></span> to select the <code class="code">y</code> and <code class="code">z</code> siblings. Note that the screencast mentioned above illustrates these things much clearer. We recommend again to watch it, if you haven&apos;t done so yet.
        </p>
        <p class="body">
          <b>Deleting Things</b>&nbsp;&nbsp;The safest way to delete something is to mark it (using the strategies discussed in the previous paragraph) and the press <span class="keyPress"><span><span class="key">Backspace</span></span></span> or <span class="keyPress"><span><span class="key">Delete</span></span></span>. In many places you can also simply press <span class="keyPress"><span><span class="key">Backspace</span></span></span> behind or <span class="keyPress"><span><span class="key">Delete</span></span></span> before the thing you want to delete.
        </p>
        <p class="body">
          <b>Adding List Elements</b>&nbsp;&nbsp;If you are in list context (e.g. in function arguments or statement lists) you can press <span class="keyPress"><span><span class="key">Enter</span></span></span> to add an element after the current one; you can press <span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">Enter</span></span></span> before the current element. You can also type the list separator (if one is defined) to add a new element. For example, in an argument list, you can type a comma to add another argument.
        </p>
        <p class="body">
          <b>Intentions</b>&nbsp;&nbsp;Some editing functionalities are not available via &quot;regular typing&quot;, but have to be performed via what&apos;s traditionally known as a quick fix. In MPS, those are called intentions. The intentions menu can be invoked by pressing <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span> while the cursor is on the program element for which the intention menu should be shown (each language concept has its own set of intentions). For example, module contents in mbeddr can only be set to be <code class="code">exported</code> by selecting <span class="menuClick"><span><span class="menuItem">export</span></span></span> from the intentions menu. Explore the contents of the intentions menu from time to time to see what&apos;s possible. Note that you can just type the name of an intention once the menu is open, you don&apos;t have to use the cursor keys to select from the list. So, for example, to export a module content (function, struct), you type <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span>, <span class="keyPress"><span><span class="key">e</span></span></span>, <span class="keyPress"><span><span class="key">x</span></span></span>, <span class="keyPress"><span><span class="key">Enter</span></span></span>.
        </p>
        <p class="body">
          <b>Surround-With Intentions</b>&nbsp;&nbsp;Surround-With intentions are used to surround a selection with another construct. For example, if you select a couple of lines (i.e. a list of statements) in a C program, you can then surround these statements with an <code class="code">if</code> or with a <code class="code">while</code>. Press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">T</span></span></span> to show the possible surround options at any time. To reemphasize: in contrast to regular intentions which are opened by <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span>, surround-with intentions can work on a selection that contains several nodes!
        </p>
        <p class="body">
          <b>Refactorings</b>&nbsp;&nbsp;For many language constructs, refactorings are provided. Refactorings are more important in MPS than in &quot;normal&quot; text editors, because a quite few editing operations are hard to do manually. Please explore the refactorings context menu, and take note when we explain refactorings in the user&apos;s guide. Unlike intentions, which cannot have a specific keyboard shortcut assigned, refactorings can, and we make use of this feature heavily. For example, <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">V</span></span></span> extracts a variable from an expression.
        </p>
        <p class="body">
          <b>Select in Project</b>&nbsp;&nbsp;To select the currently edit root note in the project explorer (the big tree of the left), press <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">F1</span></span></span> and then <span class="keyPress"><span><span class="key">Enter</span></span></span>.
        </p>
        <p class="body">
          <b>Open Inspector</b>&nbsp;&nbsp;Sometimes, additional properties of an element can be entered in the inspector (&quot;properties view&quot;). To open the inspector window, press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">2</span></span></span>.
        </p>
        <p class="body">
          <b>Make and Rebuild</b>&nbsp;&nbsp;By default, <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F9</span></span></span> (<span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">F9</span></span></span> on the Mac) makes the current module, i.e. it regenerates and recompiles if the current module has changed. We recommend using the Keymap preferences to assign <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F9</span></span></span> (and <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F9</span></span></span> on the Mac) to a complete Rebuild of the current solution; sometimes changes aren&apos;t detected correctly and a full rebuild is necessary. <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F8</span></span></span> and <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F10</span></span></span> should be mapped to a rebuild of the current model and the current project, respectively (see screenshot below).
        </p>
        <div class="imagecontainer" id="sid7992580511417530077">
          <div class="image">
            <img src="images/fundamental/keymapbuild.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              3.4-A: </b>The keymap preferences dialog in MPS where users can define their own keyboard shortcuts.
            </p>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid1481709176729755835" class="section">3.5 Version Control</h2>
        <div>
          <h3 id="sid2101724341004030799" class="section">3.5.1 Introduction</h3>
          <p class="body">In this chapter we discuss version control with MPS. Note that this is not an introduction to version control in general: we assume that you understand version control concepts before you read this chapter. We use git as the example version control system because this is what the mbeddr team has used successfully for years now. We clearly recommend using git.</p>
          <p class="body">Also, mbeddr/MPS uses the version control support of the IDEA platform. So to get an overview, you can also check out the following links:</p>
          <ul>
            <li>
              <a href="https://www.jetbrains.com/idea/features/version_control.html" class="url">https://www.jetbrains.com/idea/features/version_control.html</a>
              
            </li>
            <li>
              <a href="https://www.jetbrains.com/idea/webhelp/version-control-with-intellij-idea.html" class="url">https://www.jetbrains.com/idea/webhelp/version-control-with-intellij-idea.html</a>
              
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid2101724341004032066" class="section">3.5.2 Supported Version Control Systems</h3>
          <p class="body">In principle, MPS can work with all the version control systems supported by IntelliJ IDEA. These include git, Subversion, CVS, Mercurial, Perforce, TFS, VSS and Rational ClearCase. This is the case because from the version control system&apos;s perspective, MPS is a regular, file based tool. </p>
          <p class="body">However, this is not quite true, because during merging, some MPS-specific things have to be done. For this purpose, version control systems support merge drivers. Currently, MPS merge drivers exist only for git, Subversion and CVS. Since nobody wants to use CVS anymore, git and Subversion are the most reasonable alternatives to use with MPS. However, it is feasible to develop additional merge drivers if this should become necessary. Please contact the MPS team in this case.</p>
          <p class="body">Our experience over the last years is with git, which is why we use git in this chapter. We&apos;ve also used Subversion successfully in one project. We clearly recommend using git with mbeddr.</p>
        </div>
        <div>
          <h3 id="sid2101724341004068759" class="section">3.5.3 Setting Up Version Control for a Project</h3>
          <p class="body">
            To be able to use version control from within MPS, MPS must be made aware of the version control system and its meta data. MPS uses so called VCS roots. A <em class="emph">VCS root</em> is simply a root directory in which git (or other version control systems) store their meta data. You can configure the roots via the Preferences (see <a href="#sid6952748365713388050" class="imgRef">Fig. 3.5.3-A</a>). Note that MPS also detects directories that could/should be roots and brings up a popup.
          </p>
          <div class="imagecontainer" id="sid6952748365713388050">
            <div class="image">
              <img src="images/fundamental/vcssetup.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.5.3-A: </b>The configuration of VCS roots for git.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid2101724341004068813" class="section">3.5.4 Tools and Views</h3>
          <p class="body">
            <b>Change Markup in Editor</b>&nbsp;&nbsp;As you edit code in the regular MPS editor, MPS keeps track of changes. In particular, it shows changes in the left gutter. <a href="#sid6952748365714254507" class="imgRef">Fig. 3.5.4-A</a> shows how new nodes are highlighted. MPS also shows changes to existing nodes as shown in <a href="#sid6952748365714254535" class="imgRef">Fig. 3.5.4-B</a>. Clicking on the respective color bar in the gutter lets you revert that change, among other things. It also lets you show a detailed diff; we discuss the diff in the next paragraph.
          </p>
          <div class="imagecontainer" id="sid6952748365714254507">
            <div class="image">
              <img src="images/fundamental/vcsAdded.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.5.4-A: </b>Highlight of added nodes in the editor.
              </p>
            </div>
          </div>
          <div class="imagecontainer" id="sid6952748365714254535">
            <div class="image">
              <img src="images/fundamental/vcsChanged.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.5.4-B: </b>Highlight of changed nodes in the editor.
              </p>
            </div>
          </div>
          <p class="body">
            <b>Changes View</b>&nbsp;&nbsp;The Changes view keeps track of which files (i.e., models) have changed on you system compared to the latest in the version control system. <a href="#sid6952748365714814903" class="imgRef">Fig. 3.5.4-C</a> shows an example. The <code class="code">defaultExtensions</code> model is the one that contains the root with the two changes shown above. You can see a diff by selecting <span class="menuClick"><span><span class="menuItem">Show Diff</span></span></span> from the context menu of the respective model in the changes view. The view which then opens (<a href="#sid6952748365714866969" class="imgRef">Fig. 3.5.4-D</a>) lets you choose from the changed roots (if several have changed) and then see a diff in the usual side-by-side style. Note that this works for arbitrary notations! You can also undo the changes with the usual operations.
          </p>
          <div class="imagecontainer" id="sid6952748365714814903">
            <div class="image">
              <img src="images/fundamental/changesView.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.5.4-C: </b>The changes view in MPS.
              </p>
            </div>
          </div>
          <div class="imagecontainer" id="sid6952748365714866969">
            <div class="image">
              <img src="images/fundamental/diffView.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.5.4-D: </b>The diff view in MPS.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid2101724341004032080" class="section">3.5.5 Common Version Control Operations</h3>
          <p class="body">
            In principle, all version control operations except the diff/merge can be performed from the command line. You can also use VCS-specific tools such as SourceTree (<a href="http://www.sourcetreeapp.com/" class="url">http://www.sourcetreeapp.com/</a>). However, it is recommended to use the MPS-internal ways to do things to make sure that MPS&apos; caches do not get out of sync. In practice we do the basic things (explained here) with MPS, and the advanced things with the command line or SourceTree.
          </p>
          <p class="body">
            We recommend exploring the <span class="menuClick"><span><span class="menuItem">VCS</span></span></span> menu in MPS, and in particular the <span class="menuClick"><span><span class="menuItem">git</span></span></span> submenu; it has a lot of git operations such as branching or stashing.
          </p>
          <div>
            <h4 id="sid2101724341004032088" class="section">3.5.5.1 Update/Pull</h4>
            <p class="body">
              Updating, or pulling in git-speak, refers to getting the newest contents from the version control system. From within MPS you can do this via  the menu entry <span class="menuClick"><span><span class="menuItem">VCS</span>&rarr;</span><span><span class="menuItem">Update Project</span></span></span>. After the update, the Version Control view shows the set of changed files (<a href="#sid6952748365715126170" class="imgRef">Fig. 3.5.5.1-A</a>). You can use the context menu to show a diff of the changes that came in. 
            </p>
            <div class="imagecontainer" id="sid6952748365715126170">
              <div class="image">
                <img src="images/fundamental/updateChangedFiles.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  3.5.5.1-A: </b>List of changed files after an update/pull.
                </p>
              </div>
            </div>
          </div>
          <div>
            <h4 id="sid2101724341004032093" class="section">3.5.5.2 Commit/Push</h4>
            <p class="body">
              You can use <span class="menuClick"><span><span class="menuItem">VCS</span>&rarr;</span><span><span class="menuItem">Commit Changes</span></span></span> or <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">K</span></span></span> to bring up the commit dialog. This dialog, shown in <a href="#sid6952748365715455374" class="imgRef">Fig. 3.5.5.2-A</a>, lets you select the models you want to commit and specify a commit message. By using the context menu on models, you can also revert some of the changes. By pressing the little down-arrow on the <span class="menuClick"><span><span class="menuItem">Commit</span></span></span> button, you can also directly push from within MPS. You can also use the context menu to show the diff, i.e. the changes that are about to be committed.
            </p>
            <div class="imagecontainer" id="sid6952748365715455374">
              <div class="image">
                <img src="images/fundamental/commitView.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  3.5.5.2-A: </b>Commit dialog in MPS.
                </p>
              </div>
            </div>
          </div>
          <div>
            <h4 id="sid2101724341004032097" class="section">3.5.5.3 Conflicts/Merging</h4>
            <p class="body">
              Conflicts happen if the same node(s) are changed independently by different parties. It can happen during an update/pull (if somebody else has changed the same nodes independently) or when merging a branch (in the case where the two branches have changes to the same model). In both cases, the Version Control view, when showing the incoming changes, will mark conflicting files as red, as shown in <a href="#sid6952748365716245147" class="imgRef">Fig. 3.5.5.3-A</a>. 
            </p>
            <div class="imagecontainer" id="sid6952748365716245147">
              <div class="image">
                <img src="images/fundamental/changesViewConflict.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  3.5.5.3-A: </b>The changes view after it ran into a conflict in a model.
                </p>
              </div>
            </div>
            <p class="body">
              You can then select <span class="menuClick"><span><span class="menuItem">Git</span>&rarr;</span><span><span class="menuItem">Merge Conflicts</span></span></span> to open the Merge overview (<a href="#sid6952748365716256156" class="imgRef">Fig. 3.5.5.3-B</a>). It shows the list of conflicing files, and for each of them you can select whether you want to accept your local changes (overwriting what comes in), accept the incoming changes (discarding your own changes) or merge manually.
            </p>
            <div class="imagecontainer" id="sid6952748365716256156">
              <div class="image">
                <img src="images/fundamental/mergeOverview.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  3.5.5.3-B: </b>The merge overview dialog shows the files that changed as well as the merge options.
                </p>
              </div>
            </div>
            <p class="body">
              In case you select <span class="menuClick"><span><span class="menuItem">Merge</span></span></span>, you will get a three-way merge dialog as shown in <a href="#sid6952748365716257562" class="imgRef">Fig. 3.5.5.3-C</a>. There you pick and choose then changes you want to use. You can also edit, as well as copy/paste changes into the merge result.
            </p>
            <div class="imagecontainer" id="sid6952748365716257562">
              <div class="image">
                <img src="images/fundamental/threeWayMerge.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  3.5.5.3-C: </b>Three-way merge to resovle conflict.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid1195021413141455458" class="section">3.6 Utilitites</h2>
        <div>
          <h3 id="sid1418902825862766330" class="section">3.6.1 Interop with Text</h3>
          <p class="body">
            There are various ways of interoperating with textual worlds. One of them is the import of textual, legacy C source. This is covered in <span class="sectRef">Section <a href="#sid3861573051956758831">Accessing Libraries</a></span>. In this section we discuss a few additional ways.
          </p>
          <p class="body">
            <b>Node Info and Node URL</b>&nbsp;&nbsp;It is often useful to be able to be able to point somebody to a specific node. For example, one may want to send an email to a coworker pointing out a specific node, or an issue in an issue tracker may want to refer to a program node in MPS. For this purpose, it is possible to copy the Node Info and the Node URL to the clipboard (and then paste it as text somewhere else). 
          </p>
          <p class="body">
            You can select any node in MPS and use <span class="menuClick"><span><span class="menuItem">Copy Node URL to Clipboard</span></span></span> from the context menu. The following code snippet is a node URL. If you open this URL in a browser, MPS will try to open the respective node. This requires MPS to be running and the currently opened project must contain the node. MPS does <em class="emph">not</em> open the project if it is currently closed. <span><strong class="todo">[ToDo: 
            Where is the menu entry in MPS to do the same based on URL in the clipboard?
            ]</strong></span>
            
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">http://localhost:8080/select/tutorial/r:4ac377c2-0a54-4908-ae24-f86f1bad7e73/1195021413141453989/</pre>
          </div>
          <p class="body">
            The node URL is not readable by humans, only by the tool. You can use <span class="menuClick"><span><span class="menuItem">Edit</span>&rarr;</span><span><span class="menuItem">Copy Special</span>&rarr;</span><span><span class="menuItem">Copy Node Info to Clipboard</span></span></span> to get a more detailed info about the node, as shown in the next snippet. This contains enough data to navigate to a node manually; of course the URL is also included to automate the navigation.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">project: tutorial (/Users/markusvoelter/Documents/mbeddr/mbeddr.core/code/applications/tutorial)<br/>
module:  com.mbeddr.tutorial.documentation<br/>
model:   com.mbeddr.tutorial.documentation.ug.fundamentals<br/>
root:    G_TextInterOp [Document]<br/>
node:    Word [Word]<br/>
url:     http://localhost:8080/select/tutorial/r:4ac377c2-0a54-4908-ae24-f86f1bad7e73/1195021413141455557/</pre>
          </div>
          <p class="body">By the way: this functionality is also very useful if you want to report problems about the documentation to us. Please include a Node URL or even better, a Node Info of the document or paragraph where you spot a problem.</p>
          <p class="body">
            <b>Copy to Text</b>&nbsp;&nbsp;Every MPS node can be copied to a text editor. However, the result is only useful if the original node has essentially a textual syntax (like regular program code or the paragraphs in this document). In the text editor, it will look essentially similar. However, it is not possible to paste the text back into MPS, because, by default, an MPS language definition does not come with the parser necessary to process the text and build the MPS tree (it is of course possible to build and integrate such parsers into MPS, but you don&apos;t get it for free). So this approach is only useful for communication purposes, but not to actually exchange program code. The next paragraph describes a more useful alternative.
          </p>
          <p class="body">
            <b>Copy to XML</b>&nbsp;&nbsp;It is possible to copy a node (and its complete subtree, of course) to an XML text. The menu item <span class="menuClick"><span><span class="menuItem">Edit</span>&rarr;</span><span><span class="menuItem">Copy Special</span>&rarr;</span><span><span class="menuItem">Copy Node as XML</span></span></span> creates the XML. This can of course be copied into any text context. The following listing shows an example XML (of this paragraph):
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">&lt;_root _nodeID=&quot;1195021413141455614&quot; _conceptFQN=&quot;com.mbeddr.doc.structure.TextParagraph&quot; _linktype=&quot;child&quot;&gt;
<br/>
  &lt;header _nodeID=&quot;1195021413141455617&quot; _conceptFQN=&quot;com.mbeddr.doc.structure.TextParHeader&quot; _linktype=&quot;child&quot; text=&quot;Copy to XML&quot; /&gt;
<br/>
  &lt;text _nodeID=&quot;1195021413141455615&quot; _conceptFQN=&quot;de.slisson.mps.richtext.structure.Text&quot; _linktype=&quot;child&quot;&gt;
<br/>
    &lt;words _nodeID=&quot;1195021413141455616&quot; _conceptFQN=&quot;de.slisson.mps.richtext.structure.Word&quot; _linktype=&quot;child&quot; escapedValue=&quot;It is possible to copy a node (and its complete subtree, of course) to an XML text. The menu item &quot; /&gt;
<br/>
    &lt;words _nodeID=&quot;1195021413141473799&quot; _conceptFQN=&quot;com.mbeddr.doc.structure.KeyPressFormattedText&quot; _linktype=&quot;child&quot;&gt;
<br/>
      &lt;text _nodeID=&quot;1195021413141473800&quot; _conceptFQN=&quot;de.slisson.mps.richtext.structure.Text&quot; _linktype=&quot;child&quot;&gt;
<br/>
        &lt;words _nodeID=&quot;1195021413141473801&quot; _conceptFQN=&quot;de.slisson.mps.richtext.structure.Word&quot; _linktype=&quot;child&quot; escapedValue=&quot;Edit-&amp;gt;Copy Special-&amp;gt;Copy Node as XML&quot; /&gt;
<br/>
      &lt;/text&gt;
<br/>
    &lt;/words&gt;
<br/>
    &lt;words _nodeID=&quot;1195021413141473802&quot; _conceptFQN=&quot;de.slisson.mps.richtext.structure.Word&quot; _linktype=&quot;child&quot; escapedValue=&quot; creates the XML. This can of course be copied into any text context. The following listing shows an example XML (of this paragraph):&quot; /&gt;
<br/>
  &lt;/text&gt;
<br/>
&lt;/_root&gt;</pre>
          </div>
          <p class="body">
            This XML can then be pasted into another MPS using <span class="menuClick"><span><span class="menuItem">Edit</span>&rarr;</span><span><span class="menuItem">Paste XML Node</span></span></span>. The MPS node structure is reconstructed and the (internal and external) references are reestablished. While, in general, it is better to use the version control system (and branching, if necessary) to exchange code, this XML-based facility is sometimes useful as well. 
          </p>
        </div>
        <div>
          <h3 id="sid1418902825862766569" class="section">3.6.2 Searching Models</h3>
          <p class="body">
            You can do a full-text search on soutions and models. The functionality is available via the context menu (shown in <a href="#sid1418902825862783824" class="imgRef">Fig. 3.6-B</a>). The resulting search window (<a href="#sid1418902825863412961" class="imgRef">Fig. 3.6.2-A</a>) reports all the model elements that contain your search string. Note that this can also be used to search this documentation itself.
          </p>
          <div class="imagecontainer" id="sid1418902825863412961">
            <div class="image">
              <img src="images/fundamental/search.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                3.6.2-A: </b>The mbeddr full text search dialog.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid1418902825862775310" class="section">3.6.3 Opening Terminals</h3>
          <p class="body">
            It is often useful to open a terminal (console, command line) in solutions or models. The context menu for solutions or models has this option. For solutions, the terminal opens in the solution directory. For models, it opens in the model&apos;s output directory (where the model&apos;s code will be generated to). <a href="#sid1418902825862783824" class="imgRef">Fig. 3.6-B</a> shows the context menu for solutions.
          </p>
        </div>
        <div class="imagecontainer" id="sid1418902825862783824">
          <div class="image">
            <img src="images/fundamental/terminalSearch.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              3.6-B: </b>The menu options for opening the search dialog and the terminals
            </p>
          </div>
        </div>
        <div>
          <h3 id="sid4424988308481613119" class="section">3.6.4 Find Usages</h3>
          <p class="body">
            <span><strong class="todo">[ToDo: 
            
            ]</strong></span>
            
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid7992580511418100707" class="section">3.7 Cheat Sheet</h2>
        <p class="body">
          Print, cut out and put it next to your monitor when you start with mbeddr. Note that on the Mac, most (but not all!) of the <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Something</span></span></span> are actually <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Something</span></span></span>. You will have to try it out.
        </p>
        <div class="tableContainer" id="sid7992580511418105410">
          <div class="table">
            <table>
              <tr><td>Code Completion Menu</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span>
              </td></tr><tr><td>Code Completion Menu Reset</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> again</td></tr><tr><td>Intentions Menu</td><td><span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span>
              </td></tr><tr><td>Select Intentions</td><td><span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Enter</span></span></span>, then type name</td></tr><tr><td>Wrap With...</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">T</span></span></span>
              </td></tr><tr><td>Deleting</td><td><span class="keyPress"><span><span class="key">Backspace</span></span></span>, or Select-and-then-Backspace</td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-A: </b>Entering Text
            </p>
          </div>
        </div>
        <div class="tableContainer" id="sid7992580511422470248">
          <div class="table">
            <table>
              <tr><td>Add after current</td><td><span class="keyPress"><span><span class="key">Enter</span></span></span>
              </td></tr><tr><td>Add before current</td><td><span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">Enter</span></span></span> again</td></tr><tr><td>Move current node up</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Shift Up</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Shift Up</span></span></span> on Mac </td></tr><tr><td>Move current node down</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Shift Down</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Shift Down</span></span></span> on Mac </td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-B: </b>In Lists
            </p>
          </div>
        </div>
        <div class="tableContainer" id="sid7992580511422477916">
          <div class="table">
            <table>
              <tr><td>Select Along Tree</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Up</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Up</span></span></span> on Mac </td></tr><tr><td>Select Siblings (List)</td><td><span class="keyPress"><span><span class="key">Shift Up/Down</span></span></span>
              </td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-C: </b>Selection
            </p>
          </div>
        </div>
        <div class="tableContainer" id="sid7992580511422483841">
          <div class="table">
            <table>
              <tr><td>Select in Project</td><td><span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">F1</span></span></span>, then <span class="keyPress"><span><span class="key">Enter</span></span></span> </td></tr><tr><td>Go-To-Definition</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Click</span></span></span> or <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">B</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Click</span></span></span> or  <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">B</span></span></span> on Mac</td></tr><tr><td>Find Usages</td><td><span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">F7</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">F7</span></span></span> on Mac</td></tr><tr><td>Find Usages with Options</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">Shift</span>+</span><span><span class="key">F12</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">Shift</span>+</span><span><span class="key">F12</span></span></span> on Mac</td></tr><tr><td>Outline</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F12</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">F12</span></span></span> on Mac</td></tr><tr><td>Open/Focus Project Tree</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">1</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">1</span></span></span> on Mac</td></tr><tr><td>Open/Focus Inspector</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">2</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">2</span></span></span> on Mac</td></tr><tr><td>Close current Editor</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F4</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">F4</span></span></span> on Mac</td></tr><tr><td>Show List of Recent Editors</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">E</span></span></span> on Windows and Linux, <span class="keyPress"><span><span class="key">Cmd</span>+</span><span><span class="key">E</span></span></span> on Mac</td></tr><tr><td>Toggle through current Windows</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Tab</span></span></span>
              </td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-D: </b>Navigation
            </p>
          </div>
        </div>
        <div class="tableContainer" id="sid7992580511422507220">
          <div class="table">
            <table>
              <tr><td>Add Documentation</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">A</span></span></span>
              </td></tr><tr><td>Comment Out</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Shift</span>+</span><span><span class="key">C</span></span></span>
              </td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-E: </b>Generic Refactoring
            </p>
          </div>
        </div>
        <div class="tableContainer" id="sid7992580511422513643">
          <div class="table">
            <table>
              <tr><td>Make Solution</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F9</span></span></span>
              </td></tr><tr><td>Rebuild Solution</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F9</span></span></span> (custom mapped)</td></tr><tr><td>Rebuild Model</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F8</span></span></span> (custom mapped)</td></tr><tr><td>Rebuild Project</td><td><span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">F10</span></span></span> (custom mapped)</td></tr>
            </table>
          </div>
          <div class="tablecaption">
            <p class="caption">
              <b>Table 
              3.7-F: </b>Build
            </p>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid7992580511417536229" class="section">3.8 Useful MPS Settings</h2>
        <p class="body">
          Here are a few settings we recommend you change in MPS more generally (in the <span class="menuClick"><span><span class="menuItem">File</span>&rarr;</span><span><span class="menuItem">Preferences</span></span></span> menu):
        </p>
        <ul>
          <li>
            In the <em class="emph">Editor</em> settings, you should select <em class="emph">Show 1 Tab for EachAspect</em> in the <em class="emph">Editor Tabs</em> choice.
          </li>
          <li>
            In the <em class="emph">Editor</em> settings, you should select <em class="emph">Activate most recentopened Tab</em> in the <em class="emph">When closing active editor</em> choice.
          </li>
          <li>
            In the <em class="emph">Editor</em> settings, you may want to change the font to Consolas. Looks nicer.
          </li>
          <li>
            In the <em class="emph">Generator</em> settings, you may want to turn of the <em class="emph">Check models before Generation</em> in the <em class="emph">General</em> settings. Running the model checker before each generation run is annoyong - you can always run it manually.
          </li>
        </ul>
      </div>
    </div>
    <div>
      <h1 id="sid2101724341003970562" class="section">4 mbeddr C vs. C99</h1>
      <p class="body">While mbeddr tries to stick as close to the C99 standard C as possible there are some differences between the two. In this section we will discuss these differences in detail.</p>
      <div>
        <h2 id="sid2723638869557430314" class="section">4.1 mbeddr&apos;s Module System</h2>
        <p class="body">
          C has header files to manage visibility. If a file <code class="code">A.c</code> wants to access symbols defined in file <code class="code">B.c</code>, then the to-be-accessible entities (or prototypes of them) are put into <code class="code">B</code>&apos;s header file <code class="code">B.h</code>. <code class="code">A.c</code> uses <code class="code">#include</code> to import the <code class="code">B.h</code> header, and this way sees the declaration of the symbols. This way, header files can be used in C to provide some kind of modularization and information hiding. Header files can even be seen as a poor man&apos;s way of specifying interfaces (through prototypes). mbeddr instead provides a native, first-class module system. Headers are not exposed, they are only used under the hood (i.e., generated).<br/>

        </p>
        <p class="body">
          <b>Chunks and Modules</b>&nbsp;&nbsp;MPS&apos; main entity for structuring code are <em class="emph">models</em> (see <span class="sectRef">Section <a href="#sid1481709176728451319">Project Structure</a></span>). A model is essentially a file that contains a set of nodes. The nodes directly beneath the model are called <em class="emph">root nodes</em> in MPS. All root nodes provided by mbeddr are called <em class="emph">chunks</em>. A chunk has a name as well as a set of dependencies, i.e., references of chunks it depends on. Chunks come in many different kinds. <code class="code">BuildConfiguration</code>s are chunks, <code class="code">UnitContainer</code>s are chunks, and the modules in which you can write mbeddr C code are also chunks. In general, any chunk can reference (or <em class="emph">import</em>) any other one, but there may be chunk-type-specific restrictions. If a chunk <code class="code">A</code> imports chunk <code class="code">B</code>, then it is possible to reference <code class="code">B</code>&apos;s contents from <code class="code">A</code> (in some cases only <code class="code">exported</code> content are referencable; see below).
        </p>
        <p class="body">
          <b>Implementation and External Module</b>&nbsp;&nbsp;Modules are the chunks that contain C code (as opposed to, for example, build configurations or requirements). mbeddr has two different kinds of modules. The most common one is the <code class="code">ImplementationModule</code> in which you write your normal mbeddr code which will be generated to C99 code and then compiled. The second kind is the <code class="code">ExternalModule</code>. External Modules won&apos;t be generated into C code. They are used to proxy external, textual C code such as header files on which your code may rely <sup id="sid2723638869557430314_footnote_1_origin" title="This is necessary because, in order to reference a node (e.g., call a function), that node has to be in MPS. If you want to call into textual C code that is not in MPS, you have to create a proxy of that textual code in MPS. External modules are used for this purpose." class="footnodeOrigin"><a href="#sid2723638869557430314_footnote_1_text">1</a></sup>. Since they just proxy existing C or header files they don&apos;t contain any implementation. They just contain declarations. <code class="code">ExternalModule</code>s always have to declare a header file that is included in the generated C code (the files for which they are a proxy).
        </p>
        <p class="body">
          <b>Visibility and Exporting</b>&nbsp;&nbsp;A chunk <code class="code">A</code> that imports (depends on) chunk <code class="code">B</code> only sees those contents of <code class="code">B</code> that are exported. Some kinds of chunks, for example the requirements module, implicitly export everything. Other chunks, for example implementation modules, default to private contents, and the user has to specifically mark contents as <code class="code">exported</code>. An importing chunk, <code class="code">A</code> in the example, can also mark a chunk import as <code class="code">reexport</code>. This way, if a chunk <code class="code">C</code> imports <code class="code">A</code>, and a has <code class="code">reexport</code>ed imports, <code class="code">C</code> can access the contents of <code class="code">B</code> as well.
        </p>
        <p class="footnoteText" id="sid2723638869557430314_footnote_1_text">
          <a href="#sid2723638869557430314_footnote_1_origin">1:</a> 
           
          This is necessary because, in order to reference a node (e.g., call a function), that node has to be in MPS. If you want to call into textual C code that is not in MPS, you have to create a proxy of that textual code in MPS. External modules are used for this purpose.
        </p>
      </div>
      <div>
        <h2 id="sid993292703731045282" class="section">4.2 Data Types</h2>
        <p class="body">mbeddr supports all of C99&apos;s data types in principle, but it changes a few defaults. We discuss these details here.</p>
        <div>
          <h3 id="sid993292703731048905" class="section">4.2.1 Boolean</h3>
          <p class="body">While in C99 the boolean is a typedef&apos;d integer, in mbeddr booleans are first class types. </p>
          <div class="codeblockContainer">
            <pre class="codeblock">boolean bool = true;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205545397804/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">This means code like this is not valid in mbeddr:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">if (1) {    <br/>
  //do stuff<br/>
            <br/>
} if</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/993292703731106457/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Also boolean and integer are not assignable to each other by default. You have to convert them explicitly. This might be the case when you interface legacy code that was not written in mbeddr. In addition to <code class="code">int2bool</code>, there is also a <code class="code">bool2int</code> conversion operator. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">{                                     <br/>
  int16 aInt16 = 0;                   <br/>
  boolean aBoolean = int2bool&lt;aInt16&gt;;<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205545356656/" class="originalNode" title="open in MPS"></a>
          </div>
        </div>
        <div>
          <h3 id="sid3592268205546236794" class="section">4.2.2 User defined types</h3>
          <p class="body">
            C allows you to specify user defined types (struct and union). To make use of these types, they are usually wrapped with a <code class="code">typedef</code>. This is not necceary in mbeddr. mbeddr will take care of the typedef during generation to textual C. In addition, the order of declarations does not matter in mbeddr. It is safe to write code which references types that are defined later in the <code class="code">ImplementationModule</code>. The contents of a module are automatically sorted topographically during generation.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">C99vsMbeddr2                                                                        <br/>
model   com.mbeddr.tutorial.documentation.code    constraints                        <br/>
                                                                                     <br/>
                                                                                     <br/>
                                                                                     <br/>
struct order {                                                                       <br/>
  product product;                                                                   <br/>
  int32 amount;                                                                      <br/>
};                                                                                   <br/>
                                                                                     <br/>
                                                                                     <br/>
struct product {                                                                     <br/>
  int32 product_number;                                                              <br/>
  string name;                                                                       <br/>
};                                                                                   <br/>
                                                                  imports     nothing</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205546278761/" class="originalNode" title="open in MPS"></a>
          </div>
        </div>
        <div>
          <h3 id="sid3592268205546292455" class="section">4.2.3 Integers</h3>
          <p class="body">
            Integers in mbeddr always come with a qualified size. There is no <code class="code">int</code>, <code class="code">short</code>, <code class="code">long long</code> and so on in mbeddr, because the size of these integers can differ depending on the compilation target. mbeddr has its own data types for singed or unsigned integers from 8bit to 64bit. For example, <code class="code">uint8</code> represents an 8bit unsigned integer, <code class="code">int8</code> represents an 8bit signed integer, <code class="code">uint16</code> represents an 16bit integer and so on.<br/>
<br/>
If you need to interact with existing C that uses <code class="code">int</code>, you can still write <code class="code">int</code> inside <code class="code">ExternalModule</code>s but you have to provide a mapping to the mebddr types. This is done inside the <code class="code">TypesizeConfiguration</code>.
          </p>
        </div>
        <div>
          <h3 id="sid3592268205547053903" class="section">4.2.4 Type Size Configuration</h3>
          <p class="body">
            As described above, mbeddr uses size-qualified alternatives of the C99 native types. To interact with existing C code, mbeddr offers <code class="code">ExternalModule</code>s. In those modules it is possible to use unqualified integers (such as <code class="code">int )</code>. Since mbeddr by default doesn&apos;t know about the size of these types, those have to be configured on a per-project basis. This is done in the so called <code class="code">TypesizeConfiguration</code>. This configuration can be accessed via <span class="menuClick"><span><span class="menuItem">File</span>&rarr;</span><span><span class="menuItem">Settings</span>&rarr;</span><span><span class="menuItem">Type Size Configuration</span></span></span> (see <a href="#sid3592268205547072864" class="imgRef">Fig. 4.2.4-A</a>). It contains a mapping for each C99 type to an mbeddr type. The mapping for a given target may differ from the defaults that ship with mbeddr. These can be changes for each project. 
          </p>
          <div class="imagecontainer" id="sid3592268205547072864">
            <div class="image">
              <img src="images/c99vsmbeddr/typesizeconfig.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                4.2.4-A: </b>Type Size Configuration
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid3592268205546300997" class="section">4.3 Array Syntax</h2>
        <p class="body">
          One of the fundamental differences compared to C in mebddr is the way how arrays are declared. In C, array declarations are hard to read when they incorporate pointers and/or the <code class="code">const</code> and <code class="code">volatile</code> modifier. In mbeddr, arrays are declared and read from right to left. This might be different compared to other languages that you are used to, but in order to make reading types consistent across mbeddr, we had to introduce this. Declaring a multidimensional (3 sets of 2 elements) array of 16 bit integers in C99 would look like this:
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">int16[3][2] integers;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205546489290/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">In mbeddr it looks like this:</p>
        <div class="codeblockContainer">
          <pre class="codeblock">int16[2][3] array = {<br/>
  {1, 2},            <br/>
  {3, 4},            <br/>
  {5, 6}             <br/>
};</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205546348784/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          This might look irritating in the first place, but once we add pointers it will look much easier to read. Declaring a pointer to the array, we declared above in C, looks like this:<br/>
<br/>
<code class="code">int16_t *(array[3][2])</code>
          
        </p>
        <p class="body">In mbeddr, the same declaration is completely written from right to left:</p>
        <div class="codeblockContainer">
          <pre class="codeblock">int16[2][3]* pointer = &amp;array;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/3592268205546318118/" class="originalNode" title="open in MPS"></a>
        </div>
      </div>
      <div>
        <h2 id="sid993292703731052551" class="section">4.4 Various Additions</h2>
        <p class="body">
          <b>Declaration order</b>&nbsp;&nbsp;In contrast to C99 the order of declared functions, variables and types doesn&apos;t matter. Also forward declarations aren&apos;t necessary. mbeddr will take care of all these during generation to textual C code.
        </p>
        <p class="body">
          <b>No Preprocessor</b>&nbsp;&nbsp;mbeddr does not expose the C preprocessor to the end user. Because the preprocessor simply replaces text, it is possible that it results in not compileable code (and create all kinds of other mayhem). In addition, the preprocessor does not take the typesystem into account and the code may not typecheck. 
        </p>
        <ul>
          <li>
            Constants are supported via <code class="code">#constant</code>
            
          </li>
          <li>
            Function macros are supported via <code class="code">#macro</code>
            
          </li>
          <li>
            <code class="code">#ifdefs</code> are supported via native support for product-line variability (see <span class="sectRef">Section <a href="#sid536680812410436781">Static Variability</a></span>)
          </li>
        </ul>
        <p class="body">Finally, more sophisticated/awkward/brittle uses of the preprocessor should be replaced by native mbeddr language extensions. There&apos;s no need for &quot;preprocessor meta programming&quot; if you have a full-blown language workbench at your disposal!</p>
      </div>
      <div>
        <h2 id="sid2723638869557433101" class="section">4.5 Unit Tests</h2>
        <p class="body">
          Unit testing is important for software development in general, it is important for developing code with mbeddr, and it is important for the remainder of the user guide. Hence we discuss unit testing now. The examples discussed in this section can be found in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808232621/" class="cref">SimpleTestCase</a>.
        </p>
        <p class="body">
          <b>Test Subjects</b>&nbsp;&nbsp;The example module contains two functions which we will use as test subjects, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808237961/" class="cref">add</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808242016/" class="cref">divide</a>. They look as follows:
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">SimpleTestCase                                                                                          <br/>
model   mbeddr.tutorial.main.defaultExtensions                                                           <br/>
package examples    constraints                                                                          <br/>
                                                                                                         <br/>
                                                                                                         <br/>
int32 add(int32 a, int32 b) {                                                                            <br/>
  return a + b;                                                                                          <br/>
} add (function)                                                                                         <br/>
int32 divide(int32 a, int32 b) {                                                                         <br/>
  return a / b;                                                                                          <br/>
} divide (function)                                                                                      <br/>
                                                                                      imports     nothing</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808232621/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          <b>Declaring Test Cases</b>&nbsp;&nbsp;Test cases are a little bit like void functions: they have no parameters and they do not return anything. mbeddr provides first class abstractions, because they track failures. Here is the signature of a test case: 
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported testcase testAdding {     <br/>
  testHelperFunction();            <br/>
  assert-equals(0) 10 == add(5, 5);<br/>
} testAdding(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808238502/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          <b>Asserting</b>&nbsp;&nbsp;Inside test cases, a number of <code class="code">assert</code> statements are available, as <a href="#sid2723638869555190765" class="imgRef">Fig. 4.5-A</a> shows. It should be self-explanatory what they mean. Using these assert statements, test cases can now be made meaningful.
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported testcase testDivision {     <br/>
  assert-equals(0) 4 == divide(8, 2);<br/>
} testDivision(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808244464/" class="originalNode" title="open in MPS"></a>
        </div>
        <div class="imagecontainer" id="sid2723638869555190765">
          <div class="image">
            <img src="images/tutorial/testing/asserts.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              4.5-A: </b>The various <code class="code">assert</code> statements available in mbeddr.
            </p>
          </div>
        </div>
        <p class="body">
          <b>Invoking test cases</b>&nbsp;&nbsp;A collection of test cases can be invoked via the <code class="code">test</code> expression. It invokes the test cases mentioned as arguments and evaluates to the total number of assertion failures. Typically the <code class="code">test</code> expression is used from a <code class="code">main</code> function, and the result is returned to the OS; this way, the whole process fails if there are assertion failures. The test output will also be printed to the Console in MPS with links pointing to the individual test cases in the C code. You can read more about this in <span class="sectRef">Section <a href="#sid7863625513831639756">Running Applications from MPS/mbeddr</a></span>.
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported int32 main(int32 argc, string[] argv) {                                        <br/>
  return test testAdding; (unittest)  ;                                                 <br/>
} main (function)                                                                       <br/>
                                                                testDivision; (unittest)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808241069/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          The test executable can then be run like any other executable, as, for example, the <a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/949722786950959234/" class="cref">HelloWorld</a> example in <span class="sectRef">Section <a href="#sid5607395629657104236">Build and Run</a></span>. Note that you can set the <code class="code">isTest</code> flag to true for the executable (inside the <code class="code">BuildConfiguration</code>). If you do this, your <code class="code">Makefile</code> has an additional target <code class="code">test</code>, so you can invoke it directly via <code class="code">make test</code>.
        </p>
        <p class="body">
          <b>Helper Functions</b>&nbsp;&nbsp;Assert statements only work in test cases. If, for some reason, you want to access them from regular functions, then these functions have to have the <code class="code">@test helper</code> annotation. It can be attached with the corresponding intention.
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">SimpleTestCase                                                                                          <br/>
model   mbeddr.tutorial.main.defaultExtensions                                                           <br/>
package examples    constraints                                                                          <br/>
                                                                                                         <br/>
                                                                                                         <br/>
void testHelperFunction() {                                                                              <br/>
  assert(0) add(1, 1) == 2;                                                                              <br/>
} testHelperFunction (function)                                                                          <br/>
exported testcase testAdding {                                                                           <br/>
  testHelperFunction();                                                                                  <br/>
  assert-equals(0) 10 == add(5, 5);                                                                      <br/>
} testAdding(test case)                                                                                  <br/>
                                                                                      imports     nothing</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1187244948808232621/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          <b>Parameterized unit tests</b>&nbsp;&nbsp;mbeddr has tight integration with formal verification tools which can be used to specify a verification harness for the testing function. This way similar functionality can be achieved as with the ordinary parameterized tests. Actually, testing your function (unit of the system) with harness and formal verification is much more powerful because unit tests usually cover only punctual cases, while the verification can prove the property (in this case assertions) for a whole wider set of values. You can read more about these features in <span class="sectRef">Section <a href="#sid3861573051957205464">Formal Verification with CBMC</a></span>. 
        </p>
        <p class="body">
          <b>Domain-Specific Testing Support</b>&nbsp;&nbsp;Some of mbeddr&apos;s extensions (such as components or state machines) come with their own extensions of the testing language to make it more efficient to unit-test these abstractions. These extensions are discussed together with the respective language extensions.
        </p>
      </div>
      <div>
        <h2 id="sid85256576563787228" class="section">4.6 Function Pointers</h2>
        <p class="body">Function pointers are an important ingredient to writing flexible, configurable software in C. However, their syntax and type safety is not that great -- hence, mbeddr provides a different, more typesafe approach.</p>
        <div>
          <h3 id="sid5110473669961000551" class="section">4.6.1 Function Types</h3>
          <p class="body">
            As the first example, we will add a configurable event handler using function pointers. We create a new module <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931944290/" class="cref">FunctionPointers</a> using the context menu <span class="menuClick"><span><span class="menuItem">New</span>&rarr;</span><span><span class="menuItem">c.m.core.modules</span>&rarr;</span><span><span class="menuItem">ImplementationModule</span></span></span> on the current model. 
          </p>
          <p class="body">
            Inside it, we will add a <code class="code">struct</code> called <code class="code">Trackpoint</code> that contains a number of members. You create the <code class="code">struct</code> by just typing <code class="code">struct</code> inside the module. You add the members by simply starting to type the <code class="code">int8</code> types. Ignore the physical units (the things behind the slashes after the types) for now.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported struct Trackpoint {<br/>
  int8 id;                  <br/>
  int8/s/ time;             <br/>
  int8/m/ x;                <br/>
  int8/m/ y;                <br/>
  int16/m/ alt;             <br/>
  int16/mps/ speed;         <br/>
};</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We then create two functions that are able to process the <code class="code">Trackpoint</code>s. Here is one function that does nothing (intentionally). You enter this function by starting out with the <code class="code">Trackpoint</code> type, then typing the name and then using the <code class="code">(</code> to actually create the function (the thing has been a global variable up to this point!):
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported Trackpoint process_doNothing(Trackpoint e) {<br/>
  return e;                                          <br/>
} process_doNothing (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931945870/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Other functions with the same signature may process the data in some specific way. We can generalize those into a function type using a <code class="code">typedef</code>. Note that entering the function type <code class="code">()=&gt;()</code> is in fact a little bit cumbersome. The alias for entering it is <code class="code">funtype</code>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported typedef (Trackpoint)⇒(Trackpoint) as DataProcessorType;</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931945886/" class="originalNode" title="open in MPS"></a>
          </div>
        </div>
        <div>
          <h3 id="sid2723638869562319525" class="section">4.6.2 Function References</h3>
          <p class="body">We can now create a global variable that holds an instance of this type and that acts as a global event dispatcher.</p>
          <div class="codeblockContainer">
            <pre class="codeblock">DataProcessorType processor;</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931945894/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We also create a new, empty <code class="code">test case</code> that we will use for making sure the program actually works. In the test we assign a reference to <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931945870/" class="cref">process_doNothing</a> to that event handler. Note the <code class="code">:</code> notation for function references - we do not use the ugly C function pointer syntax. With this in place, we can write the first test assertion:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">{                                         <br/>
  processor = :process_doNothing;         <br/>
  Trackpoint i2 = processor(i1);          <br/>
  assert(0) i2.id == 1 &amp;&amp; i2.alt == 100 m;<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2723638869559842687/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Let us complete this into a runnable system. In the <code class="code">Main</code> module we change our <code class="code">main</code> function to run our new test. Note how we import the <code class="code">FunctionPointers</code> module; we call the test case, which is visible because it is <code class="code">exported</code>. In the code below we call all the test cases built in the tutorial:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported int32 main(int32 argc, string[] argv) {                                                      <br/>
  return test testProcessing; (unittest)            ;                                                 <br/>
} main (function)                                                                                     <br/>
                                                                testLambdaProcessing; (unittest)      <br/>
                                                                testNullerOK; (unittest)              <br/>
                                                                testInterpolator; (unittest)          <br/>
                                                                testJudging; (unittest)               <br/>
                                                                testInterpolatorWithMock; (unittest)  <br/>
                                                                testPrintf; (unittest)                <br/>
                                                                testFlightAnalyzer; (unittest)        <br/>
                                                                testRuntimeVar; (unittest)            <br/>
                                                                testPresenceConditions; (unittest)    <br/>
                                                                testConditionalAlternative; (unittest)<br/>
                                                                testConditionalReplacement; (unittest)<br/>
                                                                testFlightRecorder; (unittest)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931944223/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To make the program build correctly, we have to make sure all modules used in the program are included. In particular, the <code class="code">FunctionPointers</code> module must be included. Mising modules can be included with a quick fix. In the end, this results in the following binary:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">executable MbeddrTutorialDefaultExt is test {                                                <br/>
  modules:                                                                                   <br/>
    Main                                                                                     <br/>
}                                                                                            <br/>
                                                                FunctionPointers (examples)  <br/>
                                                                Components (examples)        <br/>
                                                                DataStructures (examples)    <br/>
                                                                StateMachines (examples)     <br/>
                                                                LibraryAccess (examples)     <br/>
                                                                stdio_stub (external)        <br/>
                                                                stdlib_stub (external)       <br/>
                                                                RuntimeVariability (examples)<br/>
                                                                StaticVariability (examples) <br/>
                                                                ComponentsSRI (examples)     <br/>
                                                                UnitDeclarations (config)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931944284/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">We can run the tests from within MPS or from the console. </p>
        </div>
        <div>
          <h3 id="sid5110473669969280346" class="section">4.6.3 Lambdas</h3>
          <p class="body">
            In contrast to regular C, mbeddr also provides lambdas, i.e. anonymous functions. They can be passed to functions that take function types as an argument. However, they can also be assigned to variables that have a function type, such as the <code class="code">processor</code> above. Here is an example: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testLambdaProcessing {<br/>
  Trackpoint i1 = {                     <br/>
  id = 1,                               <br/>
  time = 0 s,                           <br/>
  x = 0 m,                              <br/>
  y = 0 m,                              <br/>
  alt = 50 m                            <br/>
};                                      <br/>
                                        <br/>
  processor = [tp|                      <br/>
  tp.alt = 100 m;                       <br/>
  tp;];                                 <br/>
                                        <br/>
  assert(0) processor(i1).alt == 100 m; <br/>
} testLambdaProcessing(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464295093541/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            A lamda is expressed as <code class="code">[arg1, arg2, ...|statements]</code>. The type of the arguments is inferred from the context, they don&apos;t have to be specified. If several statements are required (as in the example above), they are layouted vertically. If only an expression is required, it is shown in line.
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid85256576539952864" class="section">4.7 Commenting</h2>
        <p class="body">
          mbeddr supports several kinds of comments. We discuss all of them in this section. All of them have in common that they are so-called richtext blocks. This means that you can edit the multi-line comments in a way that resembles a regular text editor: pressing <span class="keyPress"><span><span class="key">Enter</span></span></span> to get a new line, using <span class="keyPress"><span><span class="key">Alt</span>+</span><span><span class="key">Backspace</span></span></span> to delete words, <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Right</span></span></span> to jump to the end of the line, etc. In addition, you can press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> inside the text blocks to insert actual MPS nodes: this lets you mix unstructured text with &quot;real program code&quot;. We use this, for example, to support references to program elements inside the comments. Since these are real references, they are renamed automatically if the referenced element is renamed. Press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> to see which references are available; here are some:
        </p>
        <ul>
          <li>
            <code class="code">@mc</code> references another top-level element in an implementation module (these are called <em class="emph">module contents, hence the <code class="code">mc</code>
            </em> 
          </li>
          <li>
            <code class="code">@child</code> references any named child under the current node
          </li>
          <li>
            <code class="code">@module</code> references another module
          </li>
          <li>
            <code class="code">@arg</code> references an argument (only works in functions or similar contexts)
          </li>
          <li>
            <code class="code">@local</code> references a local variable (only works in functions or similar contexts)
          </li>
        </ul>
        <p class="body">
          There are several context-specific references available, for example, a comment in a state machine can use <code class="code">@state</code> to reference states.
        </p>
        <div>
          <h3 id="sid85256576539952878" class="section">4.7.1 Statement Comments</h3>
          <p class="body">Statement comments are comments that are used in statement context (i.e., places where you write &quot;procedural&quot; C code). Examples can be seen in the following two code fragments:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">void store_store(Trackpoint* tp) &lt;= op store.store {<br/>
  //here is a regular statement comment.            <br/>
 @arg(tp) is a reference to an argument.            <br/>
  storedTP = tp;                                    <br/>
  return;                                           <br/>
} runnable store_store</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814157/" class="originalNode" title="open in MPS"></a>
          </div>
          <div class="codeblockContainer">
            <pre class="codeblock">Trackpoint* store_take() &lt;= op store.take {              <br/>
  Trackpoint* temp = storedTP;                           <br/>
  //this comment refers to a local variable: @local(temp)<br/>
  storedTP = null;                                       <br/>
  return temp;                                           <br/>
} runnable store_take</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814173/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Statement comments are entered just like you would expect, by typing <code class="code">//</code>.
          </p>
        </div>
        <div>
          <h3 id="sid85256576543084047" class="section">4.7.2 Element Documentations</h3>
          <p class="body">
            The statement comments are simply another kind of statement. They live inside a statement list along with all the other statements. Their only &quot;connection&quot; to the code is their phyical location. Element Documentations are different: they are actually <em class="emph">attached</em> to program nodes. This means that if you move/cut/copy/paste the program node, the documentation moves along with it. In addition, while statement comments can only be used in statement context, element documentations can be attached to all (coarse-grained) program nodes (functions, components, operations, states, transitions, unit declarations, etc). 
          </p>
          <p class="body">
            To attach an element documentation, you can use the <span class="menuClick"><span><span class="menuItem">Add Documentation to ...</span></span></span> intention on the respective element. The following is an example:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component Nuller extends nothing {                             <br/>
  provides TrackpointProcessor processor                                <br/>
  Trackpoint* processor_process(Trackpoint* p) &lt;= op processor.process {<br/>
  p.alt = 42 m;                                                         <br/>
  return p;                                                             <br/>
} runnable processor_process                                            <br/>
} component Nuller</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647781810/" class="originalNode" title="open in MPS"></a>
          </div>
        </div>
        <div>
          <h3 id="sid85256576543364439" class="section">4.7.3 Margin Comments</h3>
          <p class="body">
            Review comments are not inlined in the code. Instead, they a reside in the right margin, just like comments in Word. An example can be found in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587993/" class="cref">DataStructures</a> module. Margin comments can be attached to any node using the <span class="menuClick"><span><span class="menuItem">Add Margin Comment</span></span></span> intention. Once there, they can be replied to or deleted using context menu items. The color of the comment outline depends on the commenter (as determined by the currently logged in user name). 
          </p>
          <p class="body">
            If margin comments are used in a root, the root itself shows a summary at the top: how many comments are in the root, plus who commented last, and when. You can use the <span class="menuClick"><span><span class="menuItem">Delete All Comments</span></span></span> intention on that root annotation to delete all comments.
          </p>
        </div>
        <div>
          <h3 id="sid85256576543581662" class="section">4.7.4 Commenting Out Code</h3>
          <p class="body">The comments described so far were all text comments: their contents was unstructured text. This is totally different from commenting out code, because in this case, even though the code has been commented out, the structure of the code (concepts, nodes, tree, references) must be retained so it can be commented back in. This is why commenting out code is treated differently than the comments discussed above which contain text (as opposed to code). </p>
          <p class="body">
            Essentially all program nodes can be commented out by using the <span class="menuClick"><span><span class="menuItem">Comment Out</span></span></span> intention on the node. Commented code gets greyed, no type checks are performed inside it, and commented nodes cannot be referenced from the outside. Examples can be seen in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="cref">FlightAnalyzer</a> state machine (commented out states and transitions), the commented <code class="code">struct</code> in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587993/" class="cref">DataStructures</a> and the two first statements in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2328978735727159228/" class="cref">calcVerticalSpeed</a>. 
          </p>
          <p class="body">
            To comment something back in, you can either use the <span class="menuClick"><span><span class="menuItem">Comment In</span></span></span> intention anywhere in the commented code, or just press <span class="keyPress"><span><span class="key">Backspace</span></span></span> on the leading <code class="code">/*</code> or trailing <code class="code">*/</code>.
          </p>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid1481709176728354858" class="section">5 Generated Code</h1>
      <div>
        <h2 id="sid3082376456307359987" class="section">5.1 Efficiency</h2>
        <p class="body">If mbeddr is used as a plain C IDE, the efficiency of the generated code will not be any better or worse than it would have been written in any other IDE. mbeddr does not do any magic to code that is written on C-level. </p>
        <p class="body">Extensions to C fall come in two flavours: those that extend only the type system and those that affect the generated C code. </p>
        <p class="body">
          <b>Type System Only</b>&nbsp;&nbsp;An example for such a language is the units support in mbeddr. While it can help you to catch flaws in your code in the IDE, it has no implications for the generated code. This means you will not pay any price at runtime for using this extension.
        </p>
        <p class="body">
          <b>Extensions that affect the generated Code</b>&nbsp;&nbsp;The far more common case is that mbeddr&apos;s extension translate into C code. Here we try to be as efficient wrt. memory and runtime overhead as possible. Again, some of the extensions will have no overhead because they are very straightforward and will just improve the readability and reduce possible errors. However, more complex extensions such as mbeddr&apos;s components or statemachines have to store state and potentially add additional indirections in certain cases. The price you pay for that is typically not any higher than the price you would pay if you implement the same functionality manually in a clean, well-structured way. 
        </p>
        <p class="body">
          In many cases mbeddr offers transformation options in the build configuration which make different trade-offs between flexibility and efficiency. For example, the <code class="code">static wiring</code> strategy in mbeddr&apos;s components does not support interface polymorphism (less flexibility) but translates to C code that does not involve a function pointer indirection (more efficient).
        </p>
      </div>
      <div>
        <h2 id="sid3082376456307360126" class="section">5.2 Readability</h2>
        <p class="body">Within the mbeddr IDE you have many options to write readable code, mostly due to the high-level extensions. Not all of them can be reflected in the code we generate due to limitations of the C-language itself. When translating mbeddr code into C code we follow a few idiomatic rules.</p>
        <p class="body">
          <b>Naming</b>&nbsp;&nbsp;First and foremost mbeddr has a concept of namespaces which is not available in C. Every module in mbeddr forms its own namespace. Additional structural elements such as components or statemachines add additional namespaces. This means that mbeddr allows two functions to have the same name as long as they live in different namespaces. In order to translate these namespaces into C and retain globally unique names, we typically prefix e.g., the function name with the module name. Similar things happen for all module contents. This can make the generated funtion names quite long and thus hard to read. There are two ways around that: You can add the <code class="code">preventNameMangling</code> annotation to module contents. This will prevent the prefixes from being added to the element which has the annotation. This should only be used in cases where you want to provide non-mbeddr users with API to work with. The second option is to select the <code class="code">prevent name mangling</code> configuration item in the build configuration. This will try to get rid of the prefixes where possible, i.e., if an only if a non-prefixed name is globally unique within an executable. This optimization is performed each time you rebuild your code. The downside of that might be that the generated code changes once you introduce a new e.g. function with a name which already exists elsewhere in your code. 
        </p>
        <p class="body">
          <b>Sections</b>&nbsp;&nbsp;The second option to structure your code in mbeddr are <code class="code">section</code>s. They do not affect the generated code (nor the scoping in mbeddr) and are just there to visually structure your module content.
        </p>
        <p class="body">
          <b>Ordering</b>&nbsp;&nbsp;It is also worth noting that in mbeddr you can order your module content according to aspects important for maintainability rather than the declaration dependencies you know from C. 
        </p>
      </div>
    </div>
    <div>
      <h1 id="sid2101724341003970566" class="section">6 C Tooling</h1>
      <div>
        <h2 id="sid85256576565990694" class="section">6.1 Building Binaries in the IDE</h2>
        <div>
          <h3 id="sid6002249030800732328" class="section">6.1.1 Build Configurations</h3>
          <p class="body">
            mbeddr has its own abstraction for building applications. This is called the <code class="code">BuildConfiguration</code>. The <code class="code">BuildConfiguration</code> is responsible for the generation of the <code class="code">Makefile</code> and holds parameters for the various parts of mbeddr generators. The following is an example.<br/>

          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">BuildConfiguration (c.m.t.d.code)<br/>
                                 <br/>
Platform                         <br/>
GNU paths are not checked        <br/>
  make: make                     <br/>
  gdb: gdb                       <br/>
  compiler                       <br/>
    path to executable: gcc      <br/>
    compiler options: -std=c99   <br/>
    debug options: -g            <br/>
                                 <br/>
                                 <br/>
Configuration Items              <br/>
reporting printf                 <br/>
                                 <br/>
Binaries                         <br/>
                                 <br/>
executable HelloWorld is test {  <br/>
  modules:                       <br/>
    HelloWorld                   <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/5777244129531618669/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">It is split into three sections:</p>
          <ul>
            <li>Platform</li>
            <li>Configuration Items</li>
            <li>Binaries</li>
          </ul>
          <p class="body">
            <b>Platform</b>&nbsp;&nbsp;In this section a platform can be referenced. A platform specifies the used compiler and the options passed to the compiler. By default mbeddr ships with two predefined platforms <code class="code">Desktop</code> and <code class="code">Nothing</code>. The <code class="code">Desktop</code> platform will use Make for building, GCC for compiling, GDB for debugging. Per default, mbeddr will expect these tools to be on your global PATH (see paths in build config above). However, you can specify their locations by providing an absolute path or using a path macro (see <span class="sectRef">Section <a href="#sid1481709176729756657">Paths and Libraries</a></span>): e.g., specifying the location of make via ${make.home}/make. Latter makes sense if you are working in a team with people, each having these tools installed at different locations. The <code class="code">Nothing</code> platform, as the name implies, does nothing. It does not compile anything and does not generate a <code class="code">Makefile</code>. It is possible to define additional platforms for other compiler toolchains in the settings: <span><strong class="todo">[ToDo: 
            bild
            ]</strong></span>
            
          </p>
          <p class="body"></p>
          <p class="body"></p>
          <p class="body">
            <b>Configuration Items</b>&nbsp;&nbsp;The <code class="code">Configuration Items</code> sections configures the generators of mbeddr. For example the <code class="code">reporting</code> item configures what the <code class="code">report</code> Statement should be gernerated to. If it is set to <code class="code">printf</code> the generator will create <code class="code">printf</code> statements for them. There are various configuration items for generators in mbeddr. These configuration items are discussed later in the user guide in the context of the languages that contribute (and whose generation is affected by) these config items.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">reporting printf</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/5777244129531800788/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            <b>Binaries</b>&nbsp;&nbsp;The last section is <code class="code">Binaries</code>. It configures which mbeddr modules are compiled as a single compilation unit. By default it can be either <code class="code">Executable</code> or <code class="code">Library</code>. The first one tells the <code class="code">Makefile</code> to create an ELF binary the later one just creates a linkable that can be used in further compilation. An <code class="code">Executable</code> can also be marked as a test. This way it will be included in a target called <code class="code">test</code> inside the resulting makefile. If the tests should be run on the command line <span><strong class="todo">[ToDo: 
            ref
            ]</strong></span> this flag has to be <code class="code">true</code>. mbeddr will also check if all the modules that are used in the code, that should be compiled as a single compilation unit, are included in the <code class="code">Binary</code> (based on the transitive import dependencies between modules). If not, mbeddr will prevent you from generating a broken <code class="code">Makefile</code>. There is also an intention on the binary that adds missing modules.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">executable HelloWorld is test {<br/>
  modules:                     <br/>
    HelloWorld                 <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/5777244129531800781/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Currently only one binary can be specified for each build configuration (this may change in the future).</p>
        </div>
        <div>
          <h3 id="sid85256576565991532" class="section">6.1.2 Model Checking</h3>
          <p class="body">The model checker checks that there are no errors left in the mbeddr code. You can run the model checker from the context menu of models, solutions or the whole project. If there&apos;s something wrong, code generation will likely not work. You may want to make it a habit to check your model (and fix errors) before you attempt a rebuild.</p>
        </div>
        <div>
          <h3 id="sid85256576565991124" class="section">6.1.3 Building in the IDE</h3>
          <p class="body">
            To build a binary in the IDE, make sure that the model from which you want to build contains a <code class="code">BuildConfiguration</code>. You can then invoke the <span class="menuClick"><span><span class="menuItem">Rebuild</span></span></span> action from the context menus of models, solutions and the project -- each rebuild their own scope. You can also press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F9</span></span></span> to rebuild. 
          </p>
          <p class="body">
            Rebuilding in MPS reduced all extensions back to mbeddr C, generates textual C99 from mbeddr C and then also invokes the generated <code class="code">Makefiles</code> to build the final binary. 
          </p>
          <p class="body">
            If you don&apos;t have any errors in your mbeddr code (see previous subsection), then the code generation and compilation should go without problems and you can run the binary (see <span class="sectRef">Section <a href="#sid7863625513831639756">Running Applications from MPS/mbeddr</a></span>). If something goes wrong nontheless (during generation of compilation), then the errors are shown in the messages view. 
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid8694947709985848141" class="section">6.2 Building Binaries from the Command-Line</h2>
        <p class="body">
          This section provides an overview of how build scripts for mbeddr-based applications are written and how you can integrate them into your continous integration environment. For trying out the shown examples, you will either need the mbeddr IDE (see <span class="sectRef">Section <a href="#sid1560676800018098615">mbeddr IDE</a></span>) or mbeddr Distribution (see <span class="sectRef">Section <a href="#sid1560676800018098638">mbeddr Plugin Distribution</a></span>). When building your mbeddr-based applications, we recommend using any of the two installation methods.
        </p>
        <div>
          <h3 id="sid8694947709985848151" class="section">6.2.1 Example Application</h3>
          <p class="body">
            In the folder <code class="code">userguide.samples</code>, you will find a solution named <code class="code">com.mbeddr.tutorial.sample.CProject</code>; <br/>
its main function is here: <a href="http://localhost:8080/select/tutorial/r:4c2ddf77-1e19-49ed-a272-8d381507d2cb/6002249030800799113/" class="cref">Main</a>. It contains an mbeddr-based example application, which we will use throughout this chapter for describing the build process in MPS. The application consists of a single module, which contains a <code class="code">main</code> function that invokes a <code class="code">testcase</code>. As you can see from the <code class="code">assert</code> statements, the latter one will fail due to a false comparison. 
          </p>
          <p class="body">
            You can build the application from within MPS by marking the solution, opening the context menu and selecting <span class="menuClick"><span><span class="menuItem">Rebuild</span></span></span>. Now, you can run the test by putting your cursor on the name of the <code class="code">main</code> function (located inside <a href="http://localhost:8080/select/tutorial/r:4c2ddf77-1e19-49ed-a272-8d381507d2cb/6002249030800799113/" class="cref">Main</a>), opening the context menu and selecting <span class="menuClick"><span><span class="menuItem">run &apos;Main&apos;</span></span></span>. You will now see a console appearing at the bottom of MPS with some messages in it (<span class="sectRef">Section <a href="#sid7863625513831639756">Running Applications from MPS/mbeddr</a></span> describes their meaning). The next sections will describe how to write a build script for this application and how to invoke it from the command-line.
          </p>
        </div>
        <div>
          <h3 id="sid8694947709985848201" class="section">6.2.2 Writing Build Scripts</h3>
          <p class="body">
            In software projects, you often want to build and test your software automatically. To achieve this for our example application, this section will show you how a corresponding script will look like. MPS comes already with a language for writing these scripts. Scripts written with this language are translated to regular <code class="code">ant</code> scripts, which you can then execute from command-line or your CI environment.
          </p>
          <p class="body">
            The tutorial project contains a build script for our example application. You can find it here: <a href="http://localhost:8080/select/tutorial/r:8ee4f4fa-3aa5-4db1-a73c-16bbfa7fe849/6002249030800991566/" class="cref">build-example</a>. This script is organized into different sections, which have different responsibilities. The following list describes the meaning of each: 
          </p>
          <ul>
            <li>
              <code class="code">build</code> build-example <code class="code">generates:</code> <em class="emph">build-example</em> is the name of the MPS script, whereby <em class="emph">build.xml</em> is the name of the generated ant file.
            </li>
            <li>
              <code class="code">base directory:</code> the file system location to which the ant file is generated.
            </li>
            <li>
              <code class="code">use plugins:</code> a list of MPS plugins that are required while executing the script. When building mbeddr-based applications, you just need those two.
            </li>
            <li>
              <code class="code">macros:</code> macros are used in the lower sections to avoid replication of file system paths and string values.
            </li>
            <li>
              <code class="code">dependencies:</code> builds scripts, i.e., artifacts on which our build script depends at generation-time. Since we use <em class="emph">mbeddr</em> (and depend on other languages as well), its plugins should be available while generating code for our application.
            </li>
            <li>
              <code class="code">project structure:</code> contains plugin descriptors and solutions/languages you want to build. In our case, we have a <em class="emph">dummy</em> plugin descriptor that causes classes from MPS&apos; debugger api to be loaded during generation and the solution that contains our example application.
            </li>
            <li>
              <code class="code">default layout:</code> in case your build has artifacts (e.g., plugins or zip files), you can declare their structure here. Since we just want to run code generation and execute make, we do not need to list anything here.
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid8694947709985848289" class="section">6.2.3 Building from Command-Line</h3>
          <p class="body">
            Invoking <code class="code">rebuild</code> on the build solution will cause generation of an ant file. This section describes how we can invoke this file for building and testing our application from command-line. For just building the application, we could directly invoke the scripts from command-line. But, we will write a wrapper script in ant, that calls the generated file. Reason is, this wrapper script will invoke <code class="code">make test</code>, which executes the tests written with mbeddr. MPS itself doesn&apos;t provide off-the-shelf support for that, therefore we have to do it this way. 
          </p>
          <p class="body">
            The listing below shows the wrapper script with two targets: <code class="code">build</code> for building the application and <code class="code">test</code> for invoking the tests. In order to get it run on your machine, please adjust the following paths:  
          </p>
          <ul>
            <li>
              <code class="code">source.location</code>: points to the folder where the generated files of your appplication solution are located (inside folder <em class="emph">source_gen</em>).
            </li>
            <li>
              <code class="code">mps.home</code>: on Windows and Linux, this property points to the directory where your MPS is installed. On Mac, it points to the <em class="emph">Contents</em> folder, located inside MPS&apos; installation directory.
            </li>
          </ul>
          <p class="body">
            In order to execute the script, please install <code class="code">ant</code> on your machine (see <span class="sectRef">Section <a href="#sid2045083395016240670">Required Tools and Versions</a></span>). Next, store this script to your local file system as <em class="emph">wrapper.xml</em>. For building our example application, on the console, navigate to the location where you stored the script and enter <code class="code">ant -f wrapper.xml build</code>. For executing the tests, enter <code class="code">ant -f wrapper.xml test</code> at the same file system location.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">&lt;project name=&quot;build and test helloworld&quot; default=&quot;build&quot; &gt;<br/>
    &lt;property name=&quot;base.path&quot; location=&quot;/Users/domenik/repositories/mbeddr.core/code/applications/tutorial/solutions&quot; /&gt;<br/>
    &lt;property name=&quot;source.location&quot; location=&quot;${base.path}/com.mbeddr.tutorial.sample.CProject/source_gen/com/mbeddr/tutorial/sample/CProject/main&quot; /&gt;<br/>
    &lt;property name=&quot;mps.home&quot; location=&quot;/Users/domenik/MPS/MPS-135.1441.app/Contents&quot; /&gt;<br/>
    <br/>
    &lt;target name=&quot;build&quot;&gt;<br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;clean&quot; /&gt;<br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;generate&quot; /&gt;<br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;build&quot; /&gt;	 		<br/>
    &lt;/target&gt; <br/>
    <br/>
    &lt;target name=&quot;test&quot;&gt;	  <br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;clean&quot; /&gt;<br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;generate&quot;/&gt;<br/>
        &lt;ant antfile=&quot;build.xml&quot; target=&quot;build&quot; /&gt;<br/>
        &lt;exec executable=&quot;make&quot; dir=&quot;${source.location}&quot;&gt;<br/>
            &lt;arg value=&quot;test&quot;/&gt;<br/>
        &lt;/exec&gt;		<br/>
    &lt;/target&gt; <br/>
&lt;/project&gt;</pre>
          </div>
          <p class="body">You can copy the same script to your CI environment and execute it there. Since you might have different file system paths there, we will need to change locations of the ant properties. You can either change the value in the scripts or invoke the script with the following command (replace the brackets): </p>
          <p class="body">
            <code class="code">ant -Dsource.location=&lt;path to solution&gt; -Dmps.home=&lt;path to mps&gt; -f wrapper.xml build</code>
            
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid7863625513831639756" class="section">6.3 Running Applications from MPS/mbeddr</h2>
        <p class="body">
          Once you have built a binary you can run it on the PC (assuming it has been built for the the PC using the <code class="code">Desktop</code> platform). There are two ways to run it:
        </p>
        <ul>
          <li>First, you can open a terminal and run it from the console. We won&apos;t cover this any further.</li>
          <li>
            Alternatively you can run it from within mbeddr. To do this, you have to create a <code class="code">Launch Configuration</code> and run or debug it.
          </li>
        </ul>
        <p class="body">
          The main goal of the <code class="code">Launch Configuration</code> is to be able to specify certain properties of the mbeddr binary you&apos;d like to run. The <code class="code">Launch Configuration</code> is related to the <code class="code">Build Configuration</code> because the latter one specifies which modules constitute the executable and it is mandatory that exactly one module listed in the <code class="code">Build Configuration</code> contains a function which can act as a main function (basically as an entry point). 
        </p>
        <div>
          <h3 id="sid4376803293071865921" class="section">6.3.1 Creating a Launch Configurations</h3>
          <p class="body">
            As an example let&apos;s take a look at the <a href="http://localhost:8080/select/tutorial/r:5bb9f839-879d-4d8b-98b1-43aac3dcfbee/699350427876703513/" class="cref">PlainCDemo</a>, which is located in <code class="code">mbeddr.tutorial.main.plainC</code>. In the same model, you find the corresponding <a href="http://localhost:8080/select/tutorial/r:5bb9f839-879d-4d8b-98b1-43aac3dcfbee/699350427876703571/" class="cref">BuildConfiguration (m.t.m.plainC)</a>. This Configuration is used to specify which modules should be compiled into the binary. As a next step, the <code class="code">plainC</code> model needs to be (re-)built. There are two options to run/debug the binary from within MPS/mbeddr:
          </p>
          <ul>
            <li>
              Go to the entry point (i.e., <a href="http://localhost:8080/select/tutorial/r:5bb9f839-879d-4d8b-98b1-43aac3dcfbee/699350427876703514/" class="cref">main</a>) of the executable and select <span class="menuClick"><span><span class="menuItem">Run PlainCDemo</span></span></span> (or similarly <span class="menuClick"><span><span class="menuItem">Debug PlainCDemo</span></span></span>) from the context menu. You will see the name of the executable at the menu item that you have specified in the <code class="code">Build Configuration</code>. This approach can be seen in <a href="#sid4376803293071871273" class="imgRef">Fig. 6.3.1-A</a>.
            </li>
            <li>
              Go to the <code class="code">Build Configuration</code> of your application and run/debug the executable from the context menu of the executable definition. This approach can be senn in <a href="#sid4376803293071872223" class="imgRef">Fig. 6.3.1-B</a>.
            </li>
          </ul>
          <div class="imagecontainer" id="sid4376803293071871273">
            <div class="image">
              <img src="images/ctooling/launchconfig_context.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.3.1-A: </b>Running the executable from the context menu of the entry point
              </p>
            </div>
          </div>
          <div class="imagecontainer" id="sid4376803293071872223">
            <div class="image">
              <img src="images/ctooling/launchconfig_buildconfig.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.3.1-B: </b>Running the executable from the context menu of the executable definition
              </p>
            </div>
          </div>
          <p class="body">
            After you have run the executable a new launch configuration will be created with the name of the executable that you have specified. If a configuration already exists with the same name then it will be overwritten. From this point, it is also possible to run/debug the executable from the menu bar or from the <span class="menuClick"><span><span class="menuItem">Run</span></span></span> menu of MPS. The launch configuration can also be created manually, or from the context menus of the entry point or executable definition; take a look at the previous two figures (<a href="#sid4376803293071872223" class="imgRef">Fig. 6.3.1-B</a> or <a href="#sid4376803293071871273" class="imgRef">Fig. 6.3.1-A</a>) for the corresponding <code class="code">Create PlainCDemo</code> element. <br/>
<br/>
An existing launch configuration can also be used to launch your application. Select the <code class="code">PlainCDemo</code> element from the drop down list which lists the available <code class="code">Launch Configuration</code>s. Simply click on the green run button to launch the executable as shown on <a href="#sid4376803293071872223" class="imgRef">Fig. 6.3.1-B</a>. In order to debug the application, you need to click on the green bug icon next to the selected <code class="code">Launch Configuration</code>. You can read more about how you can debug your application in <span class="sectRef">Section <a href="#sid3861573051956754942">Debugging</a></span>.
          </p>
          <div class="imagecontainer" id="sid4376803293071879798">
            <div class="image">
              <img src="images/ctooling/launchconfig_menu.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.3.1-C: </b>Running the executable from the menu bar
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid4376803293071868990" class="section">6.3.2 Contents of the Launch Configuration </h3>
          <p class="body">
            <code class="code">Launch Configuration</code>s can be opened for editing either from the menubar or by clicking on the <span class="menuClick"><span><span class="menuItem">Run</span>&rarr;</span><span><span class="menuItem">Edit Configurations</span></span></span> menu item. <a href="#sid4376803293071894118" class="imgRef">Fig. 6.3.2-A</a> shows the contents of the <code class="code">Launch Configuration</code> for the <code class="code">PlainCDemo</code>. 
          </p>
          <div class="imagecontainer" id="sid4376803293071894118">
            <div class="image">
              <img src="images/ctooling/launchconfig_contents.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.3.2-A</b>
                
              </p>
            </div>
          </div>
          <p class="body">The following properties can be edited:</p>
          <ul>
            <li>
              <strong class="bold">Name:</strong> the name of the <code class="code">Launch Configuration</code>. If you specify a custom configuration, it may be important to rename it and save it like that, so that during the next run it will not be overwritten. 
            </li>
            <li>
              <strong class="bold">Build project:</strong> points to the executable within your <code class="code">Build Configuration</code>.
            </li>
            <li>
              <strong class="bold">Launch timeout:</strong> the value here is in milliseconds and it specifies for how long the debugger should try to connect to the low-level C debugger (don&apos;t change the default unless you have a reason). 
            </li>
            <li>
              <strong class="bold">Command timeout:</strong> the value here is in milliseconds and it specifies how long the debugger waits with the execution of individual debug commands (don&apos;t change the default unless you have a reason). 
            </li>
            <li>
              <strong class="bold">Before launch:</strong> this specifies the commands that should be executed before launching. Usually this includes generate and make (to build the executable). 
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid4376803293071917230" class="section">6.3.3 Console output</h3>
          <p class="body">
            After you have launched the application all the output will be redirected to the <code class="code">Console</code> view of MPS. You will be able to see all the messages that would appear if you run the executable from the command line. <br/>
<br/>
Executable tests will show the test results also in the <code class="code">Console</code>. <a href="#sid4376803293072173622" class="imgRef">Fig. 6.3.3-A</a> shows the output of the test run for the <code class="code">mbeddr.tutorial.main.defaultExtensions.SimpleTestCase</code> executable. The console output contains links for executed tests and failed assertions, and you can click on them and to select the corresponding program element (test case, assertion) in the editor.   
          </p>
          <div class="imagecontainer" id="sid4376803293072173622">
            <div class="image">
              <img src="images/ctooling/launchconfig_tests.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.3.3-A: </b>Running a test from MPS lets you directly click on tests and failed assertions.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051956754942" class="section">6.4 Debugging</h2>
        <p class="body">mbeddr comes with a debugger for core C. This chapter describes how to use this debugger to debug C programs written with mbeddr.</p>
        <div>
          <h3 id="sid7863625513831639597" class="section">6.4.1 Introduction</h3>
          <p class="body">
            The mbeddr debugger behaves like a regular C debugger, but on the abstraction level of mbeddr and its extensions: it shows the call stack and watchables and allows stepping and setting of breakpoints. This way, you don&apos;t need to know any details about the generated C code. In addition, the debugger can be extended to enable debugging of code written with user-defined  language extensions. Currently, the debugger uses <code class="code">gdb</code> as debug backend and only supports  local debugging. However, in future releases of mbeddr, we plan to support debugging on the target device. In the tutorial, you find in the solution <code class="code">mbeddr.tutorial.main</code> a model named <code class="code">plainC</code>. We  use the contained mbeddr code to illustrate debugging mbeddr programs in MPS.
          </p>
        </div>
        <div>
          <h3 id="sid7863625513831979563" class="section">6.4.2 Starting a Debug Session</h3>
          <p class="body">
            Before you can debug your program, you have to make sure the C code for the program has been generated. Therefore, click on the model <code class="code">plainC</code>, open the context menu and select <span class="menuClick"><span><span class="menuItem">Rebuild Model &apos;m.t.main.plainC&apos;</span></span></span> or press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">F9</span></span></span>. Next, set a breakpoint in the first line of the <code class="code">main</code> function. This is done by clicking into the gutter of the editor. The result should look like this:
          </p>
          <div class="imagecontainer" id="sid7788280986208222258">
            <div class="image">
              <img src="images/debugger/debugger9.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.4.2-A: </b>Creating a Breakpoint 
              </p>
            </div>
          </div>
          <p class="body">
            Next, create a run configuration as explained in <span class="sectRef">Section <a href="#sid7863625513831639756">Running Applications from MPS/mbeddr</a></span> and run it in debug mode by pressing <span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">F9</span></span></span> or by clicking on the debug button in MPS&apos; toolbar (see <a href="#sid7788280986208260432" class="imgRef">Fig. 6.4.2-B</a>). 
          </p>
          <div class="imagecontainer" id="sid7788280986208260432">
            <div class="image">
              <img src="images/debugger/debugger5.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.4.2-B: </b>Starting a new debug session
              </p>
            </div>
          </div>
          <p class="body">The debugger UI should now appear at the bottom of the MPS window. In the lower left corner of this UI,  you can see two activated buttons: a green (arrow) and a red (square) one. This indicates,  that the debugger is now connected to the underlying C debugger. You can now start program execution by clicking on the green (arrow) button. This will suspend the debugger on the first line of the main function, on your previously created breakpoint:</p>
          <div class="imagecontainer" id="sid7788280986208279567">
            <div class="image">
              <img src="images/debugger/debugger10.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.4.2-C: </b>Debugger suspended at Breakpoint
              </p>
            </div>
          </div>
          <p class="body">
            Next, press <span class="keyPress"><span><span class="key">F7</span></span></span> to <em class="emph">step into</em> the current line, this will suspend the debugger in the called function <code class="code">add</code>. For returning to the calling function <code class="code">main</code>, press <span class="keyPress"><span><span class="key">Shift</span>+</span><span><span class="key">F8</span></span></span>. Once the debugger is suspended there, you can see the stack frame <code class="code">main</code> in the call stack and the local variables <code class="code">p</code>, <code class="code">argc</code> and <code class="code">argv</code> in the watchables view (see <a href="#sid7788280986208289326" class="imgRef">Fig. 6.4.2-D</a>).
          </p>
          <div class="imagecontainer" id="sid7788280986208289326">
            <div class="image">
              <img src="images/debugger/debugger11.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.4.2-D: </b>Suspended Debugger after performing step out
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid85256576565955264" class="section">6.5 Hello, World</h2>
        <p class="body">This section assumes that you have installed MPS and mbeddr correctly. This section walks you through creating a new project. </p>
        <div>
          <h3 id="sid5607395629656564110" class="section">6.5.1 A new Project</h3>
          <p class="body">
            We first create a new project. You can do this via <span class="menuClick"><span><span class="menuItem">File</span>&rarr;</span><span><span class="menuItem">New Project</span></span></span>. <a href="#sid5607395629656569313" class="imgRef">Fig. 6.5.1-A</a> shows the Wizard that opens subsequently. We select a Solution Project <sup id="sid5607395629656564110_footnote_1_origin" title="If you work with the mbeddr IDE, then the language project shown in  is not available." class="footnodeOrigin"><a href="#sid5607395629656564110_footnote_1_text">1</a></sup>, which is a project that contains one solution. We use the usual Java package naming conventions for the solution. 
          </p>
          <div class="imagecontainer" id="sid5607395629656569313">
            <div class="image">
              <img src="images/hw/newProjWizard.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.1-A: </b>MPS&apos; dialog for creating new projects.
              </p>
            </div>
          </div>
          <p class="body">
            If you have a project alredy, then you can simply create a new solution inside the existing project. Select the project node itself and select <span class="menuClick"><span><span class="menuItem">New</span>&rarr;</span><span><span class="menuItem">Solution</span></span></span> from the context menu.
          </p>
          <p class="footnoteText" id="sid5607395629656564110_footnote_1_text">
            <a href="#sid5607395629656564110_footnote_1_origin">1:</a> 
             
            If you work with the mbeddr IDE, then the language project shown in <a href="#sid5607395629656569313" class="imgRef">Fig. 6.5.1-A</a> is not available.
          </p>
        </div>
        <div>
          <h3 id="sid5607395629656570364" class="section">6.5.2 New Model</h3>
          <p class="body">
            Inside the solution you have to create a (or potentially several) new model (see <a href="#sid5607395629656581603" class="imgRef">Fig. 6.5.2-A</a>). Use the <span class="menuClick"><span><span class="menuItem">New</span>&rarr;</span><span><span class="menuItem">Model</span></span></span> in the context menu of the solution. The model should have a (qualified) name which typically starts with the solution name. We call our model <code class="code">...main</code>.  
          </p>
          <div class="imagecontainer" id="sid5607395629656581603">
            <div class="image">
              <img src="images/hw/newModel.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.2-A: </b>The dialog to create a new model in MPS.
              </p>
            </div>
          </div>
          <p class="body">
            After pressing ok, the new model is created. Also, the model&apos;s property dialog pops up automatically (it can be brought up manually by selecting <span class="menuClick"><span><span class="menuItem">Model Properties</span></span></span> from its context menu). In any case, select the <span class="menuClick"><span><span class="menuItem">Used Languages</span></span></span> tab and use the <span class="menuClick"><span><span class="menuItem">+</span></span></span> button to add the <code class="code">com.mbeddr.core</code> devkit (note that you can select devkits and languages by just typing the first letters (<code class="code">c.m.c</code>)). <a href="#sid5607395629656587859" class="imgRef">Fig. 6.5.2-B</a> shows the result. 
          </p>
          <div class="imagecontainer" id="sid5607395629656587859">
            <div class="image">
              <img src="images/hw/modelprops.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.2-B: </b>The MPS dialog for setting the languages used in a model.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid5607395629656589152" class="section">6.5.3 Writing the Code</h3>
          <p class="greyBox">
            Note: the stuff explained in this subsection can be done automatically using the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Wizards</span>&rarr;</span><span><span class="menuItem">Create Minimal Test</span></span></span> wizard. We do it manually to explain things in detail.
          </p>
          <p class="body">
            Inside the model we create a new <code class="code">Implementation Module</code>. To do so, select <span class="menuClick"><span><span class="menuItem">New</span>&rarr;</span><span><span class="menuItem">c.m.c.modules</span>&rarr;</span><span><span class="menuItem">module</span></span></span> from the model&apos;s context menu. Specify the name <code class="code">HelloWorld</code> for the module. The result looks as shown in <a href="#sid5607395629656602954" class="imgRef">Fig. 6.5.3-A</a>.
          </p>
          <div class="imagecontainer border" id="sid5607395629656602954">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_hw.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.3-A</b><a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629656590323/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            Inside the module we now write a test case that (wrongfully) asserts that <code class="code">1 + 1 == 3</code>. Here is the code:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testAdding {<br/>
  assert-equals(0) 1 + 1 == 3;<br/>
} testAdding(test case)</pre><a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629656984748/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Next is a main function. You can create one by simply typing <code class="code">main</code>: this expands to a fully parameterized main function. It also already contains a <code class="code">return 0;</code> statement. Next, we want to replace the <code class="code">0</code> with a call to our test case. Delete the <code class="code">0</code> and instead enter a <code class="code">test</code> expression. Inside it&apos;s brackets, add a reference to the <a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629656984748/" class="cref">testAdding</a> test case. The resulting main function looks like this:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported int32 main(int32 argc, string[] argv) {<br/>
  return test testAdding; (unittest);           <br/>
} main (function)</pre><a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629656995945/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To be able to run the code, we also have to create a build configuration. Use the menu <span class="menuClick"><span><span class="menuItem">New</span>&rarr;</span><span><span class="menuItem">c.m.core.buildconfig</span>&rarr;</span><span><span class="menuItem">BuildConfiguration</span></span></span> on the <code class="code">main</code> model to create one. Initially it looks as shown in <a href="#sid5607395629657097824" class="imgRef">Fig. 6.5.3-B</a>
            
          </p>
          <div class="imagecontainer border" id="sid5607395629657097824">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_bc.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.3-B</b><a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629657005705/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">To make the system run, you have to do three things:</p>
          <ul>
            <li>
              First, you have to select a platform. The platform determines how the generated C code is compiled. Select the <code class="code">desktop</code> platform. No need to change any of its parameters.
            </li>
            <li>
              Then you have to specify configuration items. For our case we need the <code class="code">reporting</code> item that determines how console output is handled. The default <code class="code">printf</code> is ok.
            </li>
            <li>
              Finally, you have to specify an executable. Add one called <code class="code">HelloWorld</code>, and add the <a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629656590323/" class="cref">HelloWorld</a> implementation module to its <code class="code">modules</code> slot.
            </li>
          </ul>
          <p class="body">
            You&apos;re done. It should now look as shown in <a href="#sid5607395629657105885" class="imgRef">Fig. 6.5.3-C</a>
            
          </p>
          <div class="imagecontainer border" id="sid5607395629657105885">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_bcfull.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.3-C</b><a href="http://localhost:8080/select/tutorial/r:f440e167-2cf6-4609-a4e7-2d2c3fda0805/5607395629657005705/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid5607395629657104236" class="section">6.5.4 Build and Run</h3>
          <p class="body">
            You can now build the system, for example by selecting <span class="menuClick"><span><span class="menuItem">Rebuild</span></span></span> from the context menu of the <code class="code">main</code> model or the <code class="code">com.mbeddr.tutorial.sample.HelloWorld</code> solution. In the Messages view you should see the following output:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">rm -rf ./bin <br/>
mkdir -p ./bin <br/>
gcc -std=c99   -c -o bin/HelloWorld.o HelloWorld.c  <br/>
gcc -std=c99 -o HelloWolrd bin/HelloWorld.o   <br/>
make finished successfully for com.mbeddr.tutorial.sample.HelloWorld/com.mbeddr.tutorial.sample.HelloWorld.main<br/>
No input. Skipping optional target.<br/>
&quot;textGen&quot; target execution time: 546 ms<br/>
&quot;callMake&quot; target execution time: 446 ms<br/>
&quot;copyTraceInfo&quot; target execution time: 138 ms<br/>
&quot;generate&quot; target execution time: 131 ms<br/>
&quot;reconcile&quot; target execution time: 37 ms<br/>
Other targets execution time: 35 ms; compile: 24 ms, configure: 6 ms, runProcessors: 5 ms, preloadModels: 0 ms, make: 0 ms, addLanguages: 0 ms, resetCache: 0 ms, checkParameters: 0 ms, auxCompile: 0 ms, collectPathes: 0 ms</pre>
          </div>
          <p class="body">
            To run the code, you can select <span class="menuClick"><span><span class="menuItem">Run HelloWorld</span></span></span> from the context menu of either the <code class="code">main</code> function or the <code class="code">HelloWorld</code> executable. The result should be shown in the <code class="code">Run</code> tool, as shown in <a href="#sid5607395629657116377" class="imgRef">Fig. 6.5.4-A</a>. Note how it contains clickable lines for the test(s) that have run as well as for the failed assertions.
          </p>
          <div class="imagecontainer" id="sid5607395629657116377">
            <div class="image">
              <img src="images/hw/running.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                6.5.4-A: </b>Running a test lets you directly click (and then open in the editor) on tests and failed assertions.
              </p>
            </div>
          </div>
          <p class="body">This concludes the Hello, World.</p>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051956758831" class="section">6.6 Accessing Libraries</h2>
        <p class="body">So far we have not accessed any functions external to the mbeddr program -- everything was self-contained. Let us now look at how to access external code. We start with the simplest possible example. We would like to be able to write the following code:</p>
        <div class="codeblockContainer">
          <pre class="codeblock">module LibraryAccess imports nothing { <br/>
  exported test case testPrintf { <br/>
    printf(&quot;Hello, World\n&quot;); <br/>
    int8 i = 10; <br/>
    printf(&quot;i = %i\n&quot;, i);  } <br/>
  }</pre>
        </div>
        <p class="body">
          To make this feasible, we have to integrate C&apos;s standard <code class="code">printf</code> function. We could import all of <code class="code">stdio</code> automatically (we&apos;ll do that below). Alternatively, if you only need a few API functions from some library, it is simpler to just write the necessary proxies manually. Let&apos;s use the second approach first. 
        </p>
        <div>
          <h3 id="sid7979854108176613196" class="section">6.6.1 Manual Header Import</h3>
          <p class="body">
            External functions are represented in a so-called <code class="code">external module</code>. After you create one and give it a name, it looks like this:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">stdlib_stub                                                                                                                                        <br/>
// contents are exported by default                                                                                                                 <br/>
model   com.mbeddr.tutorial.documentation.code    imports nothing                                                                                   <br/>
                                                                                                                                                    <br/>
                                                                                                                                                    <br/>
                                                                                                      resources 6b853dfb-19be-33ee-b67c-33b658dd0753</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/6002249030799838349/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            An external module is always associated with one or more &quot;real&quot; header files. The trick is that when an implementation module imports an external module in mbeddr, upon generation of the textual C code, the referenced real header is included into the C file. This also means that, even if you <code class="code">stdio.h</code> requires all kinds of additional definitions for it to work, these do <em class="emph">not</em> have to be imported into mbeddr. Only the function prototype must be imported so it can called from mbeddr C. 
          </p>
          <p class="body">
            So the first thing we need to do is to express that this <code class="code">stdlib_stub</code> external module represents the <code class="code">stdlib.h</code> file:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">stdlib_stub                                                                                                                      <br/>
// contents are exported by default                                                                                               <br/>
model   com.mbeddr.tutorial.documentation.code    imports nothing                                                                 <br/>
                                                                                                                                  <br/>
                                                                                                                                  <br/>
                                                                                                      resources header: &lt;stdlib.h&gt;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/6002249030799838349/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            In general, we also have to specify the <code class="code">.o</code> or <code class="code">.a</code> files that have to be linked to the binary during the <code class="code">make</code> process (in the <code class="code">resources</code> section of the external module). In case of <code class="code">stdlib.h</code>, we don&apos;t have to specify this because gcc somehow does this automatically. So what remains to do is to write the actual <code class="code">printf</code> prototype. This is a regular function signature. The ellipsis can be added via an intention. The same is true for the <code class="code">const</code> modifier. This leads us to this:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">stdlib_stub                                                                                                                      <br/>
// contents are exported by default                                                                                               <br/>
model   com.mbeddr.tutorial.documentation.code    imports nothing                                                                 <br/>
                                                                                                                                  <br/>
                                                                                                                                  <br/>
void* malloc(size_t size);                                                                                                        <br/>
void free(void* ptr);                                                                                                             <br/>
                                                                                                      resources header: &lt;stdlib.h&gt;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/6002249030799838349/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To be able to write the test case, we have to import the <code class="code">stdio_stub</code> into our <code class="code">LibraryAccess</code> implementation module. And in the build configuration we have to add the <code class="code">LibraryAccess</code> and the <code class="code">stdio_stub</code> to the binary. We should also call the <code class="code">testPrintf</code> test case from <code class="code">Main</code>.
          </p>
        </div>
        <div>
          <h3 id="sid7979854108176683431" class="section">6.6.2 Automatic Header Import</h3>
          <p class="body">
            mbeddr has support for importing existing C code. But this is a comercial extension that has to be installed seperately. For futher information please contact <a href="mailto:mbeddr@itemis.de" class="url">mailto:mbeddr@itemis.de</a>
            
          </p>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid2101724341003970577" class="section">7 C Extensions</h1>
      <div>
        <h2 id="sid3861573051957167219" class="section">7.1 Static Evaluation</h2>
        <p class="body">
          mbeddr can calculate the static value of an expression if all children of that expression are statically evaluable. This is the case if the leaf nodes of the expression tree consist of literals, references to <code class="code">#constant</code> or references to <code class="code">#macro</code> (function macro calls). Whether an expression is statically evaluatable, as well as as its calculated static value, is shown in the inspector. 
        </p>
        <p class="body">The interpreter which calculates the static value works with a precision of 100 decimal places. The 101st place is rounded half up. </p>
        <p class="body">
          By default the interpreter has no effect on the code generated by mbeddr. However by using the <code class="code">staticValueOf</code> expression you can ask mbeddr&apos;s code generator to first use the interpreter to calculate the static value and use this value then in the generated code. This functionality was introduced so that your code readability does not need to be sacrificed for performance reasons (in traditional C code you would typically see &quot;magic numbers&quot; where <code class="code">staticValueOf</code> is used in mbeddr). The expression can be inserted into your code using the <code class="code">staticValueOf</code> alias or by using a surround-with intention on a statically evaluable expression (<span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">T</span></span></span>). 
        </p>
        <div class="imagecontainer border" id="sid7088286182581556449">
          <div class="imageWithBorder">
            <img src="images/vis/mbeddrUserGuide_staticEval.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              7.1-A</b><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/7088286182578695560/" class="originalNode" title="open in MPS"></a>
            </p>
          </div>
        </div>
        <p class="body">
          In addition to the pure static value calculation mbeddr can perform various rounding operations before the static value is inserted into your code (an example is shown in <a href="#sid7088286182581556449" class="imgRef">Fig. 7.1-A</a>). These rounding operations can be added via an intention on the <code class="code">staticValueOf</code> expression (<span class="menuClick"><span><span class="menuItem">Add rounding operation</span></span></span>) or it can be selected in the inspector of the <code class="code">staticValueOf</code> expression. The following rounding operations are available:
        </p>
        <ul>
          <li>
            <strong class="bold">none:</strong> (default) no rounding operation will be performed. The resulting type might be a floating point type.
          </li>
          <li>
            <strong class="bold">ceil:</strong> rounds torwards positive infinity. The result is an integer.
          </li>
          <li>
            <strong class="bold">floor:</strong> rounds torwards negative infinity. The result is an integer.
          </li>
          <li>
            <strong class="bold">round:</strong> rounds towards &quot;nearest neighbor&quot; unless both neighbors are equidistant, in which case it rounds up. The result is an integer.
          </li>
          <li>
            <strong class="bold">trunc:</strong> rounds torwards zero. The result is an integer.
          </li>
        </ul>
      </div>
      <div>
        <h2 id="sid3861573051957168005" class="section">7.2 Units</h2>
        <p class="body">The purpose of physical units is to annotate types and literals with additional information - units - used to improve type checking. Many embedded systems work with real-world quantities, and many of those have a physical unit associated with them. </p>
        <div>
          <h3 id="sid5000085652829234023" class="section">7.2.1 Physical Units Basics</h3>
          <p class="body">
            <b>Defining and Attaching Units to Types</b>&nbsp;&nbsp;Let us go back to the definition of <code class="code">Trackpoint</code> introduced in <span class="sectRef">Section <a href="#sid85256576563787228">Function Pointers</a></span> and make it more useful. Our application is supposed to work with tracking data (captured from a bike computer or a flight logger). For the examples so far we were not interested in the physical units. 
          </p>
          <p class="body">
            Let us now explore how we can work with physical units, adding more semantics to this data structure. In order to use the physical units language, we need to import either the <code class="code">com.mbeddr.physicalunits</code> devkit. After the import we can add units for the types by simply pressing the <span class="keyPress"><span><span class="key">/</span></span></span> at the right side of them.
          </p>
          <p class="body">
            The 7 standard SI units are available from an accessory module called <a href="http://localhost:8080/select/tutorial/r:679066bc-2da8-4932-a09c-5d2b3d47b911/624957442821420128/" class="cref">SIUnits</a>. It can be imported into any implementation module. There is an extra <code class="code">nounit</code> unit defined in this module. The usage of this unit is limited to test case definitions and conversion rules, which we will talk about in later sections. When you import this module, the simple units like <code class="code">s</code> and <code class="code">m</code> will be immediately available. 
          </p>
          <p class="body">
            For the <code class="code">speed</code> member of the <code class="code">Trackpoint</code> struct we need to add <code class="code">m/s</code>. Since this is not an SI base unit, we first have to define it, which can be done either in the <code class="code">ImplementationModule</code> or in a <code class="code">UnitContainer</code> (such as <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6657613005452170119/" class="cref">UnitDeclarations</a>). To create a new unit just use its alias <code class="code">unit</code>. The specification of the derived units can be typed in after the name of the unit. A simple unit specification consists of one unit with possibly an exponent. If you would like to type in a composite unit specification then press ENTER to expand the components in the specifiction. Exponents can be added to the units by pressing the cap (^) symbol and the value of the exponent. This works for all units in the specification except for the last component; there the cap is disabled because it conflicts with the binary XOR operator. At the last position use the appropriate intention (by the way it is available for all components regardless of the position in the specification) to add the exponent to the unit. An exponent can either be simple integer number or it can be transformed to a fraction by typing <span class="keyPress"><span><span class="key">/</span></span></span> in the exponent expression. 
          </p>
          <p class="body">
            The following code example shows how can we use units for the members of the <code class="code">Trackpoint</code> struct.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported struct Trackpoint {<br/>
  int8 id;                  <br/>
  int8/s/ time;             <br/>
  int8/m/ x;                <br/>
  int8/m/ y;                <br/>
  int16/m/ alt;             <br/>
  int16/mps/ speed;         <br/>
};</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            <b>Units on Literals</b>&nbsp;&nbsp;Adding these units may result in errors in the existing code (depending on whether you had added them in previous tutorial steps) because you cannot simply assign a plain number to a variable or member whose type includes a physical unit (<code class="code">int8/m/ length = 3;</code> is illegal). Instead you have to add units to the literals as well. You can simply type the unit  name after the literal to get to the following:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">Trackpoint i1 = {<br/>
  id = 1,        <br/>
  time = 0 s,    <br/>
  x = 0 m,       <br/>
  y = 0 m,       <br/>
  alt = 100 m    <br/>
};</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931945927/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">You also have to add them to the comparison in the assertions as well, for example in this one:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">{                                         <br/>
  processor = :process_doNothing;         <br/>
  Trackpoint i2 = processor(i1);          <br/>
  assert(0) i2.id == 1 &amp;&amp; i2.alt == 100 m;<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2723638869559842687/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            <b>Operators</b>&nbsp;&nbsp;If we were to write the following code, we would get an error:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">int8 someInt = i1.x + i1.speed; // error, adding m and mps</pre>
          </div>
          <p class="body">
            This is because all the mathematical operators are overloaded for physical units and these operations are also type-checked accordingly. Clearly, the problem with this code is that you cannot add a length (<code class="code">i1.x</code>) and a speed (<code class="code">i1.speed</code>). The result is certainly not a plain <code class="code">int8</code>, so you cannot assign the result to <code class="code">someInt</code>. Adding <code class="code">i1.x</code> and <code class="code">i1.y</code> will work, though. Another example where the units are matched properly: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">int8/mps/ speed1 = (i4.x - i3.x) / (i4.time - i3.time);</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8135882712510805892/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2328978735727159228/" class="cref">calcVerticalSpeed</a> provides a few more examples of working with units in expressions:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">void calcVerticalSpeed(TrackpointWithVertical* prev, TrackpointWithVertical* cur) {<br/>
  /* cur.alt = 0 m; */                                                             <br/>
  /* cur.speed = 0 mps; */                                                         <br/>
  if (prev == null) {                                                              <br/>
  cur.vSpeed = 0 mps;                                                              <br/>
} else {                                                                           <br/>
  int16/m/ dAlt = cur.alt - prev.alt;                                              <br/>
  int8/s/ dTime = cur.time - prev.time;                                            <br/>
  cur.vSpeed = dAlt / dTime;                                                       <br/>
}                                                                                  <br/>
} calcVerticalSpeed (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2328978735727159228/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            <b>Editing Composite Units</b>&nbsp;&nbsp;When you edit an expression with composite units you may encounter the problem that multiple side transformations are available at a given place and so you need to make the choice by hand. Consider the following code example:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">int8/mps/ speed2 = 2 m･s-1 + 3 s-1･m;</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2219633145656890481/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Here, when you are editing the unit definition of the number literal 2, the * operator may be used at the end to introduce a multiplication in the expression or to extend the unit defition. Similarly, the ^ symbol may be used to introduce exponent for the units or could be also used for the binary xor operator. This problem only arises at the end of the unit definition. </p>
          <p class="body">
            <b>Build Configuration</b>&nbsp;&nbsp;If you try to rebuild the model, you will get an error message, saying that you need to add the <code class="code">units</code> configuration item to the build configuration. If you have added this item, the build should be successful and we should be able to run the test again. 
          </p>
        </div>
        <div>
          <h3 id="sid5000085652830089862" class="section">7.2.2 Unit Conversions</h3>
          <p class="body">
            So far, we have used units only for type checking. However, sometimes you have several units for the same physical quantity. For example, speed can be measured in <code class="code">m/s</code> or <code class="code">km/h</code>. For this purpose you can define conversion rules between the units.  
          </p>
          <p class="body">
            <b>Defining Conversions</b>&nbsp;&nbsp;The <code class="code">conversion rule</code> must define a source and a target unit (the conversion will happen between these units) and it must contain one or more conversion specifiers. A conversion specifier defines the conversion expression for a given type. Inside the conversion expression one can use the <code class="code">val</code> expression as a placeholder for the to-be-converted value. It will be substituted with the value that is passed to the conversion rule. The type that you define for the specifier is the type that the val expression will have. Additionally, it is also possible to omit the type: in this case the specifier works as a generic one, where the expression may be applied to any types (the type of the <code class="code">val</code> expression will be double in this case, but this is just a trick that is needed for the typesystem to work properly). The conversion specifiers are checked, and redundant specifiers will be marked as erroneous (the ones that are covered by some other specifier due to its type being the supertype of the original type). 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section conversions {                                                                                                                                                               <br/>
                                                                                                                                                                                    <br/>
  exported conversion mps -&gt; kmh {                                                                                                                                                  <br/>
                                                                                                                                                                                    <br/>
  exported conversion kmh -&gt; mps {                                                                                                                                                  <br/>
                                                                                                                                                                                    <br/>
  exported conversion s -&gt; h {                                                                                                                                                      <br/>
                                                                                                                                                                                    <br/>
  exported conversion m -&gt; km {                                                                                                                                                     <br/>
} section conversions                                                                                                                                                               <br/>
                               val as double -&gt; val * 3.6              val as &lt;no type&gt; -&gt; val / 3.6           val as &lt;no type&gt; -&gt; val / 3600         val as &lt;no type&gt; -&gt; val / 1000<br/>
                              }                                       }                                       }                                      }</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6955693250244965998/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Conversion rules can be either lazy or eager. The default behavior is the lazy evaluation, you can switch to eager from the corresponding intention on the conversion rule itself.</p>
          <ul>
            <li>
              <strong class="bold">Lazy conversion rule:</strong> the val expression inside the conversion specifier has no unit, and the expression must evaluate to a type without units. During the usage of the conversion rule, the type system will just simply append the rule&apos;s target unit to the evaluated expression. 
            </li>
            <li>
              <strong class="bold">Eager conversion rule:</strong> the val expression has the same unit as the rule&apos;s source unit. The expression in the conversion specifier must evaluate to a type with the rule&apos;s target unit. During the usage of the conversion rule, the expression will be simply evaluated and the resulting type will be used (which must match the target unit).
            </li>
          </ul>
          <p class="body">
            <b>Using Conversions</b>&nbsp;&nbsp;You can now invoke this conversion within a convert expression:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">void somethingWithConversion() {                          <br/>
  Trackpoint highSpeed;                                   <br/>
  highSpeed.speed = ((int16/mps/) convert[300 kmh-&gt; mps]);<br/>
} somethingWithConversion (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6955693250245022629/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">The convert expression does not explicitly refer to any specific conversion rule, you only need to define the target unit of the conversion, while the source unit is known from the type of the original expression. The system will try to find a matching conversion specifier (where both the units and the types match). Here comes the conversion specifier with no specific type handy, because it can be applied to any expression if the units match. <br/>
<br/>
The conversion specifier can be set manually too in the Inspector of the convert expression. </p>
        </div>
        <div>
          <h3 id="sid5000085652830090559" class="section">7.2.3 Generic Units</h3>
          <p class="body">Generic units can be used to enhance the type safety for function calls by also providing the possibility to specify the function in a generic way with respect to the used type annotations. The following code snippets show some use cases of generic units:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">int8/U1/ sum(int8/U1/ a, int8/U1/ b) {<br/>
  return a + b;                       <br/>
} sum (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/3018985626169947958/" class="originalNode" title="open in MPS"></a>
          </div>
          <div class="codeblockContainer">
            <pre class="codeblock">int8/U1･U2/ mul(int8/U1/ a, int8/U2/ b) {<br/>
  return a * b;                          <br/>
} mul (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7644849806589599247/" class="originalNode" title="open in MPS"></a>
          </div>
          <div class="codeblockContainer">
            <pre class="codeblock">Trackpoint process_generic(Trackpoint e) {<br/>
  e.time = sum(10 s, 10 s);               <br/>
  e.id = sum(1, 2);                       <br/>
  e.x = sum(10 m, 10 m);                  <br/>
  e.speed = mul(10 m, 10 s-1);            <br/>
  return e;                               <br/>
} process_generic (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7644849806589711728/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            First you need to create generic units by invoking the <code class="code">Add Generic Unit Declaration</code> intention on the function. You can specify multiple generic units once the first one has been created by just simply pressing <span class="keyPress"><span><span class="key">Enter</span></span></span> in the unit list. These newly created generic units can then be used for the type annotation just like any other unit. The substitutions will be computed based on the input parameters of the function call. One can also combine a generic unit with additional arbitrary non-generic units for the type annotations of the parameters and the return type. In addition, it is also possible to invoke the function with bare types, but be aware that once at least one substitution is present, the function call will be type checked also for matching units. The generic units can also have exponents (even as fractions) and the same type-checks also apply to them as it was described for the non-generic units. An example shows how this could be done for a square root function:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">double/U112/ sqrt(double/U1/ a) {                         <br/>
  double/U112/ res = 0 U112;                              <br/>
  //here goes your sophisticated square root approximation<br/>
  return res;                                             <br/>
} sqrt (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2219633145658635843/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Some additional notes on the usage of the generic units:</p>
          <ul>
            <li>You should not use multiple generic units in the annotation of one given function parameter, because the non-generic units will be bound to the first generic unit (all of them), so the substitutions will probably not be the ones that you would expect. This is a constraint introduced to manage the complexity of the compuatation of the bindings; allowing multiple generic units for parameter types could result in a constraint solving problem which we do not support right now. </li>
            <li>The generic units can only be used inside the function definition, this means that they are not visible outside of the function definition. </li>
          </ul>
        </div>
        <div>
          <h3 id="sid5000085652829236414" class="section">7.2.4 Stripping and Reintroducing Units</h3>
          <p class="body">
            Let us assume we have an existing (legacy or external) function that does not know about physial units and you cannot or do not want to use generic units. An example is <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5000085652830222076/" class="cref">anExistingFunction</a>: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">int16 anExistingFunction(int16 x) {<br/>
  return x + 10;                   <br/>
} anExistingFunction (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5000085652830222076/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To be able to call this function with arguments that have units, we have to strip away the units before we call the function. This can be achieved by selecting the corresponding expression and invoking the <code class="code">Strip Unit</code> intention. The type of this stripped expression will be simply the type of the original expression but without units.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">int16/m/ someFunction(Trackpoint* p1, Trackpoint* p2) {             <br/>
  int16 newValueWithoutUnit = anExistingFunction(stripunit[p1.alt]);<br/>
  return newValueWithoutUnit m;                                     <br/>
} someFunction (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5000085652830308750/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The opposite direction (i.e., adding a unit to a value that has no unit) is also supported. The <code class="code">introduceunit</code> operator is available for this. It takes an expression plus the to-be-introduced unit as arguments.
          </p>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051957173387" class="section">7.3 State Machines</h2>
        <p class="body">
          Next to components and units, state machines are one of the main C extensions available in mbeddr. They can be used directly in C programs, or alternatively, embedded into components. To keep the overall complexity of the example manageable, we will show how state machines can be used directly in C. <br/>
<br/>
State machines can either be viewed and edited with the textual notation or with the table based projection. You can switch between the two modes with the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Mode</span>&rarr;</span><span><span class="menuItem">Statemachines as Tables</span></span></span> option. <br/>
<br/>
This section will give a brief overview on state machines; how they can be defined, how one could interact with C code when using the state machines and we will also give details about hierarchical state machines and their visualizations with the help of the PlantUML tool. 
        </p>
        <div>
          <h3 id="sid3458996998997039536" class="section">7.3.1 Implementing a State machine</h3>
          <p class="body">
            Import the <code class="code">com.mbeddr.statemachines</code> devkit into your model and create a new <a href="http://localhost:8080/select/tutorial/r:75ecab8a-8931-4140-afc6-4b46398710fc/6437088627575722830/" class="cref">ImplementationModule</a> (the example module is  called also <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464295358354/" class="cref">StateMachines</a>. Then you can create the state machine in this module and add the <a href="http://localhost:8080/select/tutorial/r:75ecab8a-8931-4140-afc6-4b46398710fc/6437088627575722830/" class="cref">ImplementationModule</a> to the build configuration. This section will guide you through an example that creates a state machine for a flight judgement system. This system has 5 states which describe the behavior of the plane and also give the semantics for awarding the points for a given flight. We will create these states and see how they can be connected with transitions. We will also explore how one could specify guard conditions for the transitions. The informal rules for judging flights are as follows:
          </p>
          <ul>
            <li>Once a flight lifts off, you get 100 points</li>
            <li>For each trackpoint where you go more than 100 mps, you get 10 points</li>
            <li>For each trackpoint where you go more than 200 mps, you get 20 points</li>
            <li>You should land as short as possible; for each trackpoint where you are on the ground, rolling, you get 1 point deducted.</li>
            <li>Once you land successfully, you get another 100 points.</li>
          </ul>
          <p class="body">
            In order to create the state machine in the <a href="http://localhost:8080/select/tutorial/r:75ecab8a-8931-4140-afc6-4b46398710fc/6437088627575722830/" class="cref">ImplementationModule</a> simply type in <code class="code">statemachine</code> at the top level in implementation modules. This will create a new state machine with an initial state and one event already defined. You can leave the event there, we will come back to that later. We know that the airplane will be in various states: <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a>, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762902/" class="cref">airborne</a>, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762903/" class="cref">landing</a> (and still rolling), <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762904/" class="cref">landed</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763117/" class="cref">crashed</a>. You can just rename the already existing initial state to <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> and add the other states to the state machine. In the end you should have the following states: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {<br/>
  state beforeFlight {                                       <br/>
} state beforeFlight                                         <br/>
  state airborne {                                           <br/>
} state airborne                                             <br/>
  state landing {                                            <br/>
} state landing                                              <br/>
  state landed {                                             <br/>
} state landed                                               <br/>
  state crashed {                                            <br/>
} state crashed                                              <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The state machine will accept two kinds of events. The first one is the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762906/" class="cref">next</a> event, which takes the next trackpoint submitted for evaluation. Note how an event can have arguments of arbitrary C types, a pointer to a <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="cref">Trackpoint</a> in this example. The <code class="code">Trackpoint</code> struct is already defined in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587993/" class="cref">DataStructures</a> module. The other event, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762945/" class="cref">reset</a>, resets the state machine back to its initial state. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {<br/>
  in event next(Trackpoint* tp) &lt;no binding&gt;                 <br/>
  in event reset() &lt;no binding&gt;                              <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We also need a variable in the state machine to keep track of the points we have accumulated during the flight. In order to create a new variable simply type <code class="code">var</code> in the state machine. This creates a new variable, you need to specify its name and the type. The newly created variable is invisible from outside by default, you can change this to <code class="code">readable</code> or <code class="code">writable</code> with the corresponding intentions. Readable variables may be read from outside of the state machine, while writable variables can also be modified from the interacting C code (you will have to create a state machine instance first; we explain this below). In the end you should have a <code class="code">points</code> variable in the state machine which is readable only:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {<br/>
  readable var int16 points = 0                              <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We can now implement the rules outlined above using transitions and actions. Let us start with some simple ones. Whenever we enter <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> we reset the points to 0. We can achieve this with an entry action in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {<br/>
  state beforeFlight {                                       <br/>
  entry { points = 0; }                                      <br/>
} state beforeFlight                                         <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">There are some additional rules for taking off, landing and conditions for crashing.</p>
          <ul>
            <li>
              All states other than <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> must have a transition triggered by the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762945/" class="cref">reset</a> event to go back to the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> state. Note, that as a consequence of the entry action in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> state, the points get reset in all three cases.
            </li>
            <li>
              As soon as we submit a trackpoint where the altitude is greater than zero we can transition to the airborne state. This means we have successfully taken off, and we should get 100 points in bonus. <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762962/" class="cref">TAKEOFF</a> is a global constant representing 100 (<code class="code">#constant TAKEOFF = 100;</code>). We also make use of the physical units extension (see <span class="sectRef">Section <a href="#sid3861573051957168005">Units</a></span>) and annotate the speed and altitude with the appropriate unit.
            </li>
            <li>
              Events while we are in the air: when we are airborne and we receive a trackpoint with zero altitude and zero speed (without going through an orderly landing process), we have crashed. If we are at altitude zero with a speed greater than zero, we are in the process of landing. The other two cases deal with flying at over 200 and over 100 mps. In this case we stay in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762902/" class="cref">airborne</a> state (by transitioning to itself) but we increase the points.
            </li>
          </ul>
          <p class="body">The complete set of transitions is as follows:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {                                             <br/>
  state beforeFlight {                                                                                    <br/>
  entry { points = 0; }                                                                                   <br/>
  on next [tp.alt &gt; 0 m] -&gt; airborne                                                                      <br/>
  exit { points += TAKEOFF; }                                                                             <br/>
} state beforeFlight                                                                                      <br/>
  state airborne {                                                                                        <br/>
  on next [tp.alt == 0 m&amp;&amp; tp.speed == 0 mps] -&gt; crashed                                                  <br/>
  on next [tp.alt == 0 m&amp;&amp; tp.speed &gt; 0 mps] -&gt; landing                                                   <br/>
  on next [tp.speed &gt; 200 mps&amp;&amp; tp.alt == 0 m] -&gt; airborne { points += VERY_HIGH_SPEED; }                 <br/>
  on next [tp.speed &gt; 100 mps&amp;&amp; tp.speed &lt;= 200 mps&amp;&amp; tp.alt == 0 m] -&gt; airborne { points += HIGH_SPEED; }<br/>
  on reset [ ] -&gt; beforeFlight                                                                            <br/>
} state airborne                                                                                          <br/>
  state landing {                                                                                         <br/>
  on next [tp.speed == 0 mps] -&gt; landed                                                                   <br/>
  on next [tp.speed &gt; 0 mps] -&gt; landing { points--; }                                                     <br/>
  on reset [ ] -&gt; beforeFlight                                                                            <br/>
} state landing                                                                                           <br/>
  state landed {                                                                                          <br/>
  entry { points += LANDING; }                                                                            <br/>
  on reset [ ] -&gt; beforeFlight                                                                            <br/>
} state landed                                                                                            <br/>
  state crashed {                                                                                         <br/>
  entry { send crashNotification(); }                                                                     <br/>
} state crashed                                                                                           <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Note that the transitions are checked in the order of their appearance in the state machine; if several of them are ready to fire (based on the received event and the evaluation of the guard conditions), the first one is picked. Actually this kind of nondeterminism is usually not wanted and mbeddr provides support for the verification of state machines, which you can read more about in <span class="sectRef">Section <a href="#sid4315280228447176921">Checking State Machines</a></span>.
          </p>
          <p class="body">
            Junction states (influenced by Simulink) can also be created in the state machine in mbeddr. A junction state can only contain epsilon-transitions, meaning these transitions are immediately ready to fire when the state is entered, they don&apos;t need a triggering event. Having multiple epsilon-transitions clearly introduces nondeterminism, so one typically specifies guards for these transitions. The following example uses the <code class="code">points</code> variable to select the state transition that should be applied. The example junction state makes a decision based on the points and immediately fires. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine FlightAnalyzer initial = beforeFlight {<br/>
  junction NextRound {                                       <br/>
  [points &gt; 100] -&gt; airborne                                 <br/>
  [points &lt;= 100] -&gt; beforeFlight                            <br/>
} junction NextRound                                         <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687718765/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Junctions are essentially branching points in a statemachine and help modularize complex guards (especially if several guards in one state have common subexpressions):</p>
        </div>
        <div>
          <h3 id="sid3458996998997358129" class="section">7.3.2 Interacting with Other Code -- Outbound</h3>
          <p class="body">
            So how do we deal with the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763117/" class="cref">crashed</a> state? Assume this flight analyzer runs on a server, analyzing flights that are submitted via the web. If we detect a crash, we want to send notifications or perform other kinds of error handling. In any case, this would involve the invocation of some external code. This can be performed in two ways: 
          </p>
          <p class="body">
            The first one is to simply invoke a C function from an entry or exit action. Another alternative, which is more suitable for formal analysis (as we will see below and in <span class="sectRef">Section <a href="#sid4315280228447176921">Checking State Machines</a></span>) involves out events. From the entry action we <code class="code">send</code> an out event, which we have defined in the state machine. The following code example shows how the latter one would look like. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">StateMachines                                                                                                       <br/>
model   mbeddr.tutorial.main.defaultExtensions                                                                       <br/>
package examples    constraints                                                                                      <br/>
                                                                                                                     <br/>
                                                                                                                     <br/>
exported statemachine FlightAnalyzer initial = beforeFlight {                                                        <br/>
  out event crashNotification() =&gt; raiseAlarm                                                                        <br/>
  state crashed {                                                                                                    <br/>
  entry { send crashNotification(); }                                                                                <br/>
} state crashed                                                                                                      <br/>
}                                                                                                                    <br/>
void raiseAlarm() {                                                                                                  <br/>
  //invoke some kind of real-world thingy                                                                            <br/>
  //that reacts suitably to a detected crash                                                                         <br/>
} raiseAlarm (function)                                                                                              <br/>
                                                                                     imports     FlightJudgementRules<br/>
                                                                                                 DataStructures      <br/>
                                                                                                 stdlib_stub         <br/>
                                                                                                 stdio_stub          <br/>
                                                                                                 UnitDeclarations    <br/>
                                                                                                 SIUnits</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464295358354/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We create an out event called <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763159/" class="cref">crashNotification</a> (which will be sent when we enter the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763117/" class="cref">crashed</a> state). We then specify a binding to the out event; the binding is part of the out event definition: simply add the name of the function as the target of the arrow (in the example this is the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763153/" class="cref">raiseAlarm</a> function). <br/>
<br/>
The benefit of this approach compared to the previous one is that formal verification can check whether the notification was sent at all during the execution of the state machine. The effect is the best of both worlds: in the generated code we do call the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687763153/" class="cref">raiseAlarm</a> function, but on the state machine level we have abstracted the implementation from the intent. See <span class="sectRef">Section <a href="#sid4315280228447176921">Checking State Machines</a></span> for a discussion of state machine verification. 
          </p>
        </div>
        <div>
          <h3 id="sid3458996998997410421" class="section">7.3.3 Interaction with Other Code -- Inbound</h3>
          <p class="body">
            Let us write some test code that interacts with a state machine. To write a meaningful test, we will have to create a whole lot of trackpoints. So to do this we create helper functions. These in turn need <code class="code">malloc</code> and <code class="code">free</code>, so we first create an additional external module that represents <code class="code">stdlib.h</code>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">stdlib_stub                                                                                                                      <br/>
// contents are exported by default                                                                                               <br/>
model   com.mbeddr.tutorial.documentation.code    imports nothing                                                                 <br/>
                                                                                                                                  <br/>
                                                                                                                                  <br/>
void* malloc(size_t size);                                                                                                        <br/>
void free(void* ptr);                                                                                                             <br/>
                                                                                                      resources header: &lt;stdlib.h&gt;</pre><a href="http://localhost:8080/select/tutorial/r:af51c5c3-b54b-4a75-a1e6-409757d1a380/6002249030799838349/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We can now create a helper function that creates a new <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="cref">Trackpoint</a> based on an altitude and speed passed in as arguments:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported Trackpoint* makeTP(int16 alt, int16 speed) {         <br/>
  static int8 trackpointCounter = 0;                          <br/>
  trackpointCounter++;                                        <br/>
  Trackpoint* tp = ((Trackpoint*) malloc(sizeof[Trackpoint]));<br/>
  tp.id = trackpointCounter;                                  <br/>
  tp.time = trackpointCounter s;                              <br/>
  tp.alt = alt m;                                             <br/>
  tp.speed = speed mps;                                       <br/>
  return tp;                                                  <br/>
} makeTP (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687767140/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We can now start writing (and running!) the test. We first create an instance of the state machine (state machines act as types and must be instantiated). We then initialize the state machine by using the <code class="code">init</code> operation:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  FlightAnalyzer f;                                    <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Initially we should be in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687762901/" class="cref">beforeFlight</a> state. We can check this with an assertion:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            We also want to make sure that the value of <code class="code">points</code> is zero initially. Since we have declared the <code class="code">points</code> variable to be writable above, we can write: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Let us now create the first trackpoint and pass it in. This one has speed, but no altitude, so we are in the take-off run. We assume that we remain in the <code class="code">beforeFlight</code> state and that we still have 0 points. Notice how we use the <code class="code">trigger</code>  operation on the state machine instance. It takes the event as well as its arguments (if any):
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Now we lift off by setting the alt to 100 meters:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            So as you can see it is easy to interact from regular C code with a state machine. For testing, we have special support that checks if the state machine transitions to the desired state if a specific event is triggered. Here is some example code (note that you can use the <code class="code">test statemachine</code> construct only within test cases):
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testFlightAnalyzer {                 <br/>
  f.init;                                              <br/>
  assert(0) f.isInState(beforeFlight);                 <br/>
  assert(1) f.points == 0;                             <br/>
  f.trigger(next|makeTP(0, 20));                       <br/>
  assert(2) f.isInState(beforeFlight) &amp;&amp; f.points == 0;<br/>
  f.trigger(next|makeTP(100, 100));                    <br/>
  assert(3) f.isInState(airborne) &amp;&amp; f.points == 100;  <br/>
  test statemachine f {                                <br/>
  next(makeTP(200, 100)) ➔ airborne                    <br/>
  next(makeTP(300, 150)) ➔ airborne                    <br/>
  next(makeTP(0, 90)) ➔ landing                        <br/>
  next(makeTP(0, 0)) ➔ landed                          <br/>
}                                                      <br/>
  assert-equals(4) f.points == 200;                    <br/>
} testFlightAnalyzer(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7727566415687697331/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            You may have noticed that the helper function allocates the new <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="cref">Trackpoint</a>s on the heap, without releasing the memory. You could simply call <code class="code">free</code> on these newly created structures after the test statement has been executed or allocate the trackpoints on the stack to solve this problem.
          </p>
        </div>
        <div>
          <h3 id="sid3458996998997836692" class="section">7.3.4 Hierarchical State Machines</h3>
          <p class="body">
            State machines can also be hierarchical. This means that a state may contain essentially a sub-state machine. The following piece of code shows an example. It was derived from the previous flight judgement example, but the three <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8528611498588547128/" class="cref">flying</a>, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8528611498588547180/" class="cref">landing</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8528611498588547199/" class="cref">landed</a> states are now nested inside the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8528611498588547062/" class="cref">airborne</a> composite state. Composite states can be created in the state machine by typing <code class="code">composite state</code>. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported statemachine HierarchicalFlightAnalyzer initial = beforeFlight {<br/>
  macro stopped(next) = tp.speed == 0 mps                                <br/>
  macro onTheGround(next) = tp.alt == 0 m                                <br/>
  in event next(Trackpoint* tp) &lt;no binding&gt;                             <br/>
  in event reset() &lt;no binding&gt;                                          <br/>
  out event crashNotification() =&gt; raiseAlarm                            <br/>
  readable var int16 points = 0                                          <br/>
  state beforeFlight {                                                   <br/>
  entry { points = 0; }                                                  <br/>
  on next [tp.alt &gt; 0 m] -&gt; airborne                                     <br/>
  exit { points += TAKEOFF; }                                            <br/>
} state beforeFlight                                                     <br/>
  composite state airborne initial = flying {                            <br/>
  on reset [ ] -&gt; beforeFlight { points = 0; }                           <br/>
  on next [onTheGround &amp;&amp; stopped] -&gt; crashed                            <br/>
  state flying (airborne.flying) {                                       <br/>
  on next [onTheGround &amp;&amp; tp.speed &gt; 0 mps] -&gt; landing                   <br/>
  on next [tp.speed &gt; 200 mps] -&gt; flying { points += VERY_HIGH_SPEED; }  <br/>
  on next [tp.speed &gt; 100 mps] -&gt; flying { points += HIGH_SPEED; }       <br/>
} state flying                                                           <br/>
  state landing (airborne.landing) {                                     <br/>
  on next [stopped] -&gt; landed                                            <br/>
  on next [ ] -&gt; landing { points--; }                                   <br/>
} state landing                                                          <br/>
  state landed (airborne.landed) {                                       <br/>
  entry { points += LANDING; }                                           <br/>
} state landed                                                           <br/>
} state airborne                                                         <br/>
  state crashed {                                                        <br/>
  entry { send crashNotification(); }                                    <br/>
} state crashed                                                          <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8528611498588547081/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Here are the semantics:</p>
          <ul>
            <li>When a transition from outside a composite state targets a composite state, the initial state in that composite state is activated.</li>
            <li>A composite state can have its own transitions. These act as if they were defined for each of the states of the composite state.</li>
            <li>
              If a transition from an inner state <code class="code">A</code> crosses a composite state-boundary <code class="code">B</code>, then the actions happen in the following order: exit actions of <code class="code">A</code>, exit actions of <code class="code">B</code>, transition action, and entry action of the transition&apos;s target (which is outside of the composite state).
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid1891280913627286661" class="section">7.3.5 Tabular Notation</h3>
          <p class="body">
            State machines can also be rendered and edited as a table: the events become the column headers, and the states become the row headers. <a href="#sid5450602153900837513" class="imgRef">Fig. 7.3.5-A</a> shows an example. You can switch projection modes the usual way via the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Modes</span></span></span>.
          </p>
          <div class="imagecontainer" id="sid5450602153900837513">
            <div class="image">
              <img src="images/sm/smtable.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.3.5-A: </b>The <code class="code">FlightAnalyzer</code> state machine shown as a table.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid3458996998997887919" class="section">7.3.6 State Machine Diagrams</h3>
          <p class="body">
            State machines can also be visualized with PlantUML (a graphical editor will be done soon). The visualization can be generated from the context menu of the state machine. You may want to use the <code class="code">statechart</code> or <code class="code">statechart (short)</code>, the former one displays all information for the transitions while the latter one will only print the event&apos;s name which triggers the given transition.<br/>
<br/>
<a href="#sid3458996998997894837" class="imgRef">Fig. 7.3.6-A</a> shows an example visualization for the hierarchical state machine that was described in the previous section.
          </p>
          <div class="imagecontainer" id="sid3458996998997894837">
            <div class="image">
              <img src="images/tutorial/v_sm.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.3.6-A: </b>A visualization of a state machine in mbeddr. You can click on the states and transitions to select the respective element in the editor.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051957169274" class="section">7.4 Components</h2>
        <p class="body">
          Let us now introduce components to further structure the system. We start by factoring the <code class="code">Trackpoint</code> data structure into a separate module and export it to make it accessible from importing modules.
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported struct Trackpoint {<br/>
  int8 id;                  <br/>
  int8/s/ time;             <br/>
  int8/m/ x;                <br/>
  int8/m/ y;                <br/>
  int16/m/ alt;             <br/>
  int16/mps/ speed;         <br/>
};</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647587994/" class="originalNode" title="open in MPS"></a>
        </div>
        <div>
          <h3 id="sid4199862776472278007" class="section">7.4.1 An Interface with Contracts</h3>
          <p class="body">
            We now define an interface that processes <code class="code">Trackpoint</code>s. To be able to do that we have to add the <code class="code">com.mbeddr.components</code> devkit to the current model. We can then enter a client-server interface in a new module <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588211/" class="cref">Components</a>. We use pointers for the trackpoints here to optimize performance. Note that you can just press <span class="keyPress"><span><span class="key">*</span></span></span> on the right side of <code class="code">Trackpoint</code> to make it a <code class="code">Trackpoint*</code>. 
          </p>
          <p class="body">
            The interface has one operation <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588217/" class="cref">process</a>.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface TrackpointProcessor {<br/>
  Trackpoint* process(Trackpoint* p)       <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588216/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To enhance the semantic &quot;richness&quot; of the interface we add preconditions and a postcondition. To do so, use an intention <span class="menuClick"><span><span class="menuItem">Add Precondition</span></span></span> on the operation itself. Please add the following pre- and postconditions (note how you can of course use units in the precondition). The <code class="code">result</code> expression is only available in postconditions and represents the result of the executed operation.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface TrackpointProcessor {<br/>
  Trackpoint* process(Trackpoint* p)       <br/>
  pre(0) p != null                         <br/>
  pre(1) p.id != 0                         <br/>
  pre(2) p.time != 0 s                     <br/>
  post(3) result.id != 0                   <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588216/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">After you have added these contracts, you will get an error message on the interface. The problem is this: if a contract (pre- or postcondition) fails, the system will report a message (this message can be deactivated in case you don&apos;t want any reporting). However, for the program to work you have to specify a message on the interface. We create a new message list and a messge.</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported messagelist ContractMessages {                                                <br/>
  message contractFailed(int8 opID, int8 constraintID) ERROR: contract failed  (active)<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647781355/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">You can now open the inspector for the interface and reference this message from there:</p>
          <div class="imagecontainer" id="sid4199862776472397526">
            <div class="image">
              <img src="images/tutorial/contractmessage.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.4.1-A: </b>A message definition used in the interface definition to report contract failures.
              </p>
            </div>
          </div>
          <p class="body">There are still errors. The first one complains that the message list must be exported if the interface is exported. We fix it by exporting the message list (via an intention). The next error complains that the message needs to have to integer arguments to represent the operation and the pre- or postcondition. We change it thusly (note that there are quick fixes available to adapt the signatures in the required way).</p>
        </div>
        <div>
          <h3 id="sid4199862776472592797" class="section">7.4.2 A first Component</h3>
          <p class="body">
            We create a new component by typing <code class="code">component</code>. We call it <code class="code">Nuller</code>. It has one provided port called <code class="code">processor</code> that provides the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588216/" class="cref">TrackpointProcessor</a> interface.  
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component Nuller extends nothing {<br/>
  provides TrackpointProcessor processor   <br/>
} component Nuller</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647781810/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">After you add only the provided port, you get an error that complains that the component needs to implement the operations defined by the port&apos;s interface; we can get those automatically generated by using a quick fix from the intentions menu on the provided port. This gets us the following: </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component Nuller extends nothing {                             <br/>
  provides TrackpointProcessor processor                                <br/>
  Trackpoint* processor_process(Trackpoint* p) &lt;= op processor.process {<br/>
  p.alt = 42 m;                                                         <br/>
  return p;                                                             <br/>
} runnable processor_process                                            <br/>
} component Nuller</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647781810/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647782993/" class="cref">processor_process</a> runnable is triggered by an incoming invocation of the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588217/" class="cref">process</a> operation defined in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588216/" class="cref">TrackpointProcessor</a> interface. The <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647781810/" class="cref">Nuller</a> simply sets the altitute to zero.
          </p>
          <p class="body">
            Let us now write a simple test case to check this component. To do that, we first have to create an instance of <code class="code">Nuller</code>. We create an <em class="emph">instance configuration</em> that defines exactly one instance of this component. Also, we add an adapter. An adapter makes a provided port of a component instance (<code class="code">Nuller.processor</code>) available to a regular C program under the specified name <code class="code">n</code>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">instances nullerInstancesFailing {<br/>
  instance Nuller nuller          <br/>
  adapt n -&gt; nuller.processor     <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647783034/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Now we can write a test case that accesses the <code class="code">n</code> adapter -- and through it, the <code class="code">processor</code> port of the <code class="code">Nuller</code> component instance <code class="code">nuller</code>. We create a new <code class="code">Trackpoint</code>, using 0 as the <code class="code">id</code> -- intended to trigger a contract violation (remember <code class="code">pre(1) p-&gt;id != 0</code>). To enter the <code class="code">&amp;tp</code> just enter a <code class="code">&amp;</code>, followed by <code class="code">tp</code>. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section testNullerFailing {            <br/>
  instances nullerInstancesFailing {   <br/>
  instance Nuller nuller               <br/>
  adapt n -&gt; nuller.processor          <br/>
}                                      <br/>
                                       <br/>
  exported testcase testNullerFailing {<br/>
  initialize nullerInstancesFailing;   <br/>
  Trackpoint tp = {                    <br/>
  id = 0,                              <br/>
  time = 0 s,                          <br/>
  alt = 1000 m                         <br/>
};                                     <br/>
  n.process(&amp;tp);                      <br/>
  assert(0) tp.alt == 0 m;             <br/>
} testNullerFailing(test case)         <br/>
} section testNullerFailing</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919743/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Before we can run this, we have to make sure that the <code class="code">instances</code> are initialized (cf. the warning you get on them). We do this right in the beginning of the test case. We then create a trackpoint and assert that it is correctly nulled by the <code class="code">Nuller</code>. 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section testNullerFailing {            <br/>
  instances nullerInstancesFailing {   <br/>
  instance Nuller nuller               <br/>
  adapt n -&gt; nuller.processor          <br/>
}                                      <br/>
                                       <br/>
  exported testcase testNullerFailing {<br/>
  initialize nullerInstancesFailing;   <br/>
  Trackpoint tp = {                    <br/>
  id = 0,                              <br/>
  time = 0 s,                          <br/>
  alt = 1000 m                         <br/>
};                                     <br/>
  n.process(&amp;tp);                      <br/>
  assert(0) tp.alt == 0 m;             <br/>
} testNullerFailing(test case)         <br/>
} section testNullerFailing</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919743/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To make the system work, you have to import the <code class="code">Components</code> module into the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931944222/" class="cref">Main</a> module so you can call the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919743/" class="cref">testNullerFailing</a> test case from the <code class="code">test</code> expression in <code class="code">Main</code>. In the build configuration, you have to add the missing modules to the executable (using the quick fix). Finally, also in the build configuration, you have to add the <code class="code">components</code> configuration item:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">Configuration Items:<br/>
  reporting: printf (add labels false) <br/>
  physical units (config = Units Declarations (mbeddr.tutorial.main.m1)) <br/>
  components: no middleware         <br/>
              wire statically: false</pre>
          </div>
          <p class="body">You can now rebuild and run. As a result, you&apos;ll get contract failures: </p>
          <div class="codeblockContainer">
            <pre class="codeblock">./MbeddrTutorial<br/>
$$runningTest: running test () @FunctionPointers:test_testProcessing:0#767515563077315487<br/>
$$runningTest: running test () @Components:test_testNuller:0#767515563077315487<br/>
$$contractFailed: contract failed (op=0, pc=1) @Components:null:-1#1731059994647588232<br/>
$$contractFailed: contract faied (op=0, pc=2) @Components:null:-1#1731059994647588253</pre>
          </div>
          <p class="body">We can fix these problems by changing the test data to conform to the contract, i.e.  </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section testNullerOK {            <br/>
  instances nullerInstancesOK {   <br/>
  instance Nuller nuller          <br/>
  adapt n -&gt; nuller.processor     <br/>
}                                 <br/>
                                  <br/>
  exported testcase testNullerOK {<br/>
  initialize nullerInstancesOK;   <br/>
  Trackpoint tp = {               <br/>
  id = 10,                        <br/>
  time = 10 s,                    <br/>
  alt = 100 m                     <br/>
};                                <br/>
  n.process(&amp;tp);                 <br/>
  assert(0) tp.alt == 0 m;        <br/>
} testNullerOK(test case)         <br/>
} section testNullerOK</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7697861917661699901/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Let us provoke another contract violation by returning from the implementation in the <code class="code">Nuller</code> component a <code class="code">Trackpoint</code> whose <code class="code">id</code> is 0. 
          </p>
          <p class="body">
            Running it again provokes another contract failure. Notice how the contract is specified on the <em class="emph">interface</em>, but they are checked for each <em class="emph">component</em> implementing the interface. There is no way how an implementation can violate the interface contract without the respective error being reported!
          </p>
        </div>
        <div>
          <h3 id="sid2179458690433981422" class="section">7.4.3 Verifying Contracts Statically</h3>
          <p class="body">
            <span><strong class="todo">[ToDo: 
            Need to fill in the static verification part here.
            ]</strong></span>
            
          </p>
        </div>
        <div>
          <h3 id="sid4199862776475048963" class="section">7.4.4 Collaborating and Stateful Components</h3>
          <p class="body">
            Let us look at interactions between components. We create a new interface, the <br/>
<a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814010/" class="cref">TrackpointStore1</a>. It can store and return trackpoints<sup id="sid4199862776475048963_footnote_1_origin" title="sure, it is completely overdone to separate this out into a separate interface/component, but for the sake of the tutorial it makes sense." class="footnodeOrigin"><a href="#sid4199862776475048963_footnote_1_text">1</a></sup>. Here is the basic interface: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface TrackpointStore1 {<br/>
  void store(Trackpoint* tp)            <br/>
  Trackpoint* get()                     <br/>
  Trackpoint* take()                    <br/>
  query boolean isEmpty()               <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814010/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Let us again think about the semantics: you shouldn&apos;t be able to get or take stuff from the store if it is empty, you should not put stuff into it when it is full, etc. These things can be expressed as pre- and postconditions. The following should be pretty self-explaining. The only new thing is the <code class="code">query</code> operation. Queries can be used from inside pre- and postconditions, but cannot modify state <sup id="sid4199862776475048963_footnote_2_origin" title="Currently this is not yet checked. But it will be." class="footnodeOrigin"><a href="#sid4199862776475048963_footnote_2_text">2</a></sup>
            
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface TrackpointStore1 {<br/>
  void store(Trackpoint* tp)            <br/>
  pre(0) isEmpty()                      <br/>
  pre(1) tp != null                     <br/>
  post(2) !isEmpty()                    <br/>
  Trackpoint* get()                     <br/>
  pre(0) !isEmpty()                     <br/>
  Trackpoint* take()                    <br/>
  pre(0) !isEmpty()                     <br/>
  post(1) result != null                <br/>
  post(2) isEmpty()                     <br/>
  query boolean isEmpty()               <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814010/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            These pre- and postconditions mostly express a valid sequence of the operation calls: you have to call <code class="code">store</code> before you can call <code class="code">get</code>, etc. This can be expressed directly with protocols, as implemented in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814089/" class="cref">TrackpointStore2</a>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface TrackpointStore2 {<br/>
                                        <br/>
  void store(Trackpoint* tp)            <br/>
  protocol init(0) -&gt; new full(1)       <br/>
                                        <br/>
  Trackpoint* get()                     <br/>
  protocol full -&gt; full                 <br/>
                                        <br/>
  Trackpoint* take()                    <br/>
  post(0) result != null                <br/>
  protocol full -&gt; init(0)              <br/>
                                        <br/>
  query boolean isEmpty()               <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814089/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            You can add a new protocol using the respective intention. The protocol is essentially a state machine. On each operation you can specify the transition from the old to the new state. We have one special state which is called initial. On a transition you can either jump into an already existing state or create a new state and then directy move into that. I.e. you see on the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814090/" class="cref">store</a> operation that we transition from the <code class="code">initial</code> state into the newly created <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814106/" class="cref">full</a> state. The operation <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814107/" class="cref">get</a> can now make use of the previously created <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814106/" class="cref">full</a> state and does not create a new state. It is also worth mentioning that you can reset the protocol by transitioning into the <code class="code">initial</code> state again (as done in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814116/" class="cref">take</a>)
          </p>
          <p class="body">The two interfaces are essentially equivalent, and both are checked at runtime and lead to errors if the contract is violated. </p>
          <p class="body">
            We can now implement a component that provides this interface: <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814153/" class="cref">InMemoryStorage</a> Most of the following code should be easy to understand based on what we have discussed so far. There are two new things. There is a field <code class="code">Trackpoint* storedTP;</code> that represents component state.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">Trackpoint* storedTP;</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647814189/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Second there is an <code class="code">on-init</code> runnable: this is essentially a constructor that is executed as an instance is created.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">void init() &lt;= on init {<br/>
  storedTP = null;      <br/>
  return;               <br/>
} runnable init</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647897619/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            To keep our implementation module <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588211/" class="cref">Components</a> well structured we can use sections. A <code class="code">section</code> is a named part of the implementation module that has no semantic effect beyond that. Sections can be collapsed.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">module Components imports DataStructures { <br/>
   <br/>
  exported messagelist ContractMessages {...}<br/>
   <br/>
  section processor {...} <br/>
 <br/>
  section store { <br/>
  	exported cs interface TrackpointStore1 { <br/>
    	... <br/>
  	} <br/>
  	exported cs interface TrackpointStore2 { <br/>
    	... <br/>
  	} <br/>
    exported component InMemoryStorage extends nothing { <br/>
	    ... 	<br/>
  	} <br/>
  }<br/>
    <br/>
  instances nullerInstances {...} <br/>
  test case testNuller {...} <br/>
  instances interpolatorInstances {...} <br/>
  exported test case testInterpolator { ... } <br/>
}</pre>
          </div>
          <p class="body">
            We can now implement a second processor, the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647866538/" class="cref">Interpolator</a>. For subsequent calls of <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647588217/" class="cref">process</a> it computes the average of the two last speeds of the passed trackpoints. Let us start with the test case. Note how <code class="code">p2</code> has its speed changed to the average of the <code class="code">p1</code> and <code class="code">p2</code> originally.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section testInterpolator {                                <br/>
                                                          <br/>
  instances interpolatorInstances {                       <br/>
  instance InMemoryStorage store                          <br/>
  instance Interpolator interpolator(divident = 10)       <br/>
  connect interpolator.store to store.store               <br/>
  adapt ip -&gt; interpolator.processor                      <br/>
}                                                         <br/>
                                                          <br/>
                                                          <br/>
  exported testcase testInterpolator {                    <br/>
  initialize interpolatorInstances;                       <br/>
  Trackpoint p1 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 10 mps                                          <br/>
};                                                        <br/>
  Trackpoint p2 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 20 mps                                          <br/>
};                                                        <br/>
  ip.process(&amp;p1);                                        <br/>
  assert(0) p1.speed == 10 mps;                           <br/>
  ip.process(&amp;p2);                                        <br/>
  assert-equals(1) p2.speed == 3 mps;                     <br/>
                                                          <br/>
} testInterpolator(test case)                             <br/>
                                                          <br/>
                                                          <br/>
                                                          <br/>
  mock component StorageMock report messages: true {      <br/>
  provides TrackpointStore1 store                         <br/>
  Trackpoint* lastTP;                                     <br/>
  total no. of calls is 5                                 <br/>
  sequence {                                              <br/>
  step 0: store.isEmpty return true;                      <br/>
  step 1: store.store {                                   <br/>
    assert 0: parameter tp: tp != null                    <br/>
  }                                                       <br/>
  do { lastTP = tp; }                                     <br/>
  step 2: store.isEmpty return false;                     <br/>
  step 3: store.take return lastTP;                       <br/>
  step 4: store.store                                     <br/>
}                                                         <br/>
}                                                         <br/>
                                                          <br/>
  instances interpolatorInstancesWithMock {               <br/>
  instance StorageMock storeMock                          <br/>
  instance Interpolator ip(divident = 2)                  <br/>
  connect ip.store to storeMock.store                     <br/>
  adapt ipMock -&gt; ip.processor                            <br/>
}                                                         <br/>
                                                          <br/>
                                                          <br/>
  exported testcase testInterpolatorWithMock {            <br/>
  initialize interpolatorInstancesWithMock;               <br/>
  Trackpoint p1 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 10 mps                                          <br/>
};                                                        <br/>
  Trackpoint p2 = {                                       <br/>
  id = 2,                                                 <br/>
  time = 2 s,                                             <br/>
  speed = 20 mps                                          <br/>
};                                                        <br/>
  ipMock.process(&amp;p1);                                    <br/>
  ipMock.process(&amp;p2);                                    <br/>
  validatemock(0) interpolatorInstancesWithMock:storeMock;<br/>
} testInterpolatorWithMock(test case)                     <br/>
} section testInterpolator</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919757/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Let us look at the implementation of the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647866538/" class="cref">Interpolator</a>:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component Interpolator extends nothing {                       <br/>
  provides TrackpointProcessor processor                                <br/>
  requires TrackpointStore1 store                                       <br/>
  init int8 divident;                                                   <br/>
                                                                        <br/>
  Trackpoint* processor_process(Trackpoint* p) &lt;= op processor.process {<br/>
  if (store.isEmpty()) {                                                <br/>
  store.store(p);                                                       <br/>
  return p;                                                             <br/>
} else {                                                                <br/>
  Trackpoint* old = store.take();                                       <br/>
  p.speed = (p.speed + old.speed) / divident;                           <br/>
  store.store(p);                                                       <br/>
  return p;                                                             <br/>
}                                                                       <br/>
} runnable processor_process                                            <br/>
} component Interpolator</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647866538/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            A few things are worth mentioning. First, the component <code class="code">requires</code> another interface, <code class="code">TrackpointStore1</code>. Any component that implements this interface can be used to fulfil this requirement (we&apos;ll discuss how, below). Second, we use an <code class="code">init</code> field. This is a regular field from the perspective of the component (i.e. it can be accessed from within the implementation), but it is special in that a value for it has to be supplied when the component is instantiated. Third, this example shows how to call operations on required ports (<code class="code">store.store(p);</code>). The only remaining step before running the test is to define the instances:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">instances interpolatorInstances {                  <br/>
  instance InMemoryStorage store                   <br/>
  instance Interpolator interpolator(divident = 10)<br/>
  connect interpolator.store to store.store        <br/>
  adapt ip -&gt; interpolator.processor               <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647878529/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            A few interesting things. First, notice how we pass in a value for the init field <code class="code">divident</code> as we define an instance of <code class="code">Interpolator</code>. Second, we use <code class="code">connect</code> to connect the required port <code class="code">store</code> of the <code class="code">ipc</code> instance to the <code class="code">store</code> provided port of the <code class="code">store</code> instance. If you don&apos;t do this you will get an error on the <code class="code">ipc</code> instance since it <em class="emph">requires</em> this thing to be connected (there are also <code class="code">optional</code> required ports which may remain unconnected and <code class="code">multiple</code> required ports which can be connected to more than one required port). Finally, the provided interface <code class="code">processor</code> is made available to other code as the variable <code class="code">ip</code>. You can run the test case now. On my machine here it works successfully :-) 
          </p>
          <p class="body">
            To better understand the connections between component instances, there is also a graphical editor available. To switch to the graphical wireing you can select the respective option form the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Mode</span>&rarr;</span><span><span class="menuItem">Component Wiring as Diagram</span></span></span> menu.
          </p>
          <p class="footnoteText" id="sid4199862776475048963_footnote_1_text">
            <a href="#sid4199862776475048963_footnote_1_origin">1:</a> 
             
            sure, it is completely overdone to separate this out into a separate interface/component, but for the sake of the tutorial it makes sense.
          </p>
          <p class="footnoteText" id="sid4199862776475048963_footnote_2_text">
            <a href="#sid4199862776475048963_footnote_2_origin">2:</a> 
             
            Currently this is not yet checked. But it will be.
          </p>
        </div>
        <div>
          <h3 id="sid4098353292122310610" class="section">7.4.5 Mocks</h3>
          <p class="body">
            Let us assume we wanted to test if the <code class="code">Interpolator</code> works correctly with the <code class="code">TrackpointStore</code> interface. Of course, since we have already described the interface contract semantically we would find out quickly if the <code class="code">Interpolator</code> would behave badly. However, we can make such a test more explicit. Let us revisit the test from above:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">section testInterpolator {                                <br/>
                                                          <br/>
  instances interpolatorInstances {                       <br/>
  instance InMemoryStorage store                          <br/>
  instance Interpolator interpolator(divident = 10)       <br/>
  connect interpolator.store to store.store               <br/>
  adapt ip -&gt; interpolator.processor                      <br/>
}                                                         <br/>
                                                          <br/>
                                                          <br/>
  exported testcase testInterpolator {                    <br/>
  initialize interpolatorInstances;                       <br/>
  Trackpoint p1 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 10 mps                                          <br/>
};                                                        <br/>
  Trackpoint p2 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 20 mps                                          <br/>
};                                                        <br/>
  ip.process(&amp;p1);                                        <br/>
  assert(0) p1.speed == 10 mps;                           <br/>
  ip.process(&amp;p2);                                        <br/>
  assert-equals(1) p2.speed == 3 mps;                     <br/>
                                                          <br/>
} testInterpolator(test case)                             <br/>
                                                          <br/>
                                                          <br/>
                                                          <br/>
  mock component StorageMock report messages: true {      <br/>
  provides TrackpointStore1 store                         <br/>
  Trackpoint* lastTP;                                     <br/>
  total no. of calls is 5                                 <br/>
  sequence {                                              <br/>
  step 0: store.isEmpty return true;                      <br/>
  step 1: store.store {                                   <br/>
    assert 0: parameter tp: tp != null                    <br/>
  }                                                       <br/>
  do { lastTP = tp; }                                     <br/>
  step 2: store.isEmpty return false;                     <br/>
  step 3: store.take return lastTP;                       <br/>
  step 4: store.store                                     <br/>
}                                                         <br/>
}                                                         <br/>
                                                          <br/>
  instances interpolatorInstancesWithMock {               <br/>
  instance StorageMock storeMock                          <br/>
  instance Interpolator ip(divident = 2)                  <br/>
  connect ip.store to storeMock.store                     <br/>
  adapt ipMock -&gt; ip.processor                            <br/>
}                                                         <br/>
                                                          <br/>
                                                          <br/>
  exported testcase testInterpolatorWithMock {            <br/>
  initialize interpolatorInstancesWithMock;               <br/>
  Trackpoint p1 = {                                       <br/>
  id = 1,                                                 <br/>
  time = 1 s,                                             <br/>
  speed = 10 mps                                          <br/>
};                                                        <br/>
  Trackpoint p2 = {                                       <br/>
  id = 2,                                                 <br/>
  time = 2 s,                                             <br/>
  speed = 20 mps                                          <br/>
};                                                        <br/>
  ipMock.process(&amp;p1);                                    <br/>
  ipMock.process(&amp;p2);                                    <br/>
  validatemock(0) interpolatorInstancesWithMock:storeMock;<br/>
} testInterpolatorWithMock(test case)                     <br/>
} section testInterpolator</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919757/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            In this test, we expect the following: when we call <code class="code">process</code> first, the store is still empty, so the interpolator stores a new trackpoint. When we call <code class="code">process</code> again, we expect the interpolator to call <code class="code">take</code> and then <code class="code">store</code>. In both cases we expect <code class="code">isEmpty</code> to be called first. 
          </p>
          <p class="body">
            We can test for this behavior explicitly via a mock. A mock is a component that specifies the <em class="emph">behavior it expects</em> to see on a provided port during a <em class="emph">specific</em> test case. The crucial point about mocks is that a mock implements each operation <em class="emph">invocation</em> separately (the <code class="code">step</code>s below), whereas a regular component or even a stub just describes each operation with <em class="emph">one</em> implementation. This makes a mock implementation much simpler -- it doesn&apos;t have to replicate the algorithmic implementation of the real component. Let us look at the implementation:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">mock component StorageMock report messages: true {<br/>
  provides TrackpointStore1 store                 <br/>
  Trackpoint* lastTP;                             <br/>
  total no. of calls is 5                         <br/>
  sequence {                                      <br/>
  step 0: store.isEmpty return true;              <br/>
  step 1: store.store {                           <br/>
    assert 0: parameter tp: tp != null            <br/>
  }                                               <br/>
  do { lastTP = tp; }                             <br/>
  step 2: store.isEmpty return false;             <br/>
  step 3: store.take return lastTP;               <br/>
  step 4: store.store                             <br/>
}                                                 <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294671016/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            This mock component expresses that we expect 5 calls in total. Then we describe the sequence of calls we expect. The first one must be a call to <code class="code">isEmpty</code> and we return <code class="code">true</code>. Then we expect a <code class="code">store,</code> and for the sake of the example, we check that <code class="code">tp</code> is not <code class="code">null</code>. We also store the <code class="code">tp</code> parameter in a field <code class="code">lastTP</code> so we can return it later (you can add the parameter assertions and the <code class="code">do</code> body with <em class="emph">intentions</em>). We then expect another <code class="code">isEmpty</code> query, which we now answer with <code class="code">false</code>. At this point we expect a call to <code class="code">take</code>, and another call to <code class="code">store.</code> Notice how we return <code class="code">null</code> from <code class="code">take</code>: this violates the postcondition!<strong class="bold"></strong> However, pre- and postconditions are <em class="emph">not</em> checked in mock components because their checking may interfere with the expectations! Also, we have slightly changed the test case so we don&apos;t stumble over the <code class="code">null</code>. We don&apos;t <code class="code">assert</code> anything about the result of the <code class="code">process</code> calls:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase testInterpolatorWithMock {<br/>
  initialize interpolatorInstancesWithMock; <br/>
  Trackpoint p1 = {                         <br/>
  id = 1,                                   <br/>
  time = 1 s,                               <br/>
  speed = 10 mps                            <br/>
};                                          <br/>
  Trackpoint p2 = {                         <br/>
  id = 2,                                   <br/>
  time = 2 s,                               <br/>
  speed = 20 mps                            <br/>
};                                          <br/>
  ipMock.process(&amp;p1);                      <br/>
  ipMock.process(&amp;p2);                      <br/>
} testInterpolatorWithMock(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294670930/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Two more steps are required for this test to work. The first one is the instances and the wiring. Notice how we now connect the interpolator with the mock:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">instances interpolatorInstancesWithMock {<br/>
  instance StorageMock storeMock         <br/>
  instance Interpolator ip(divident = 2) <br/>
  connect ip.store to storeMock.store    <br/>
  adapt ipMock -&gt; ip.processor           <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294711452/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The second thing is the test case itself. Obviously, we want the test case to fail if the mock saw something other than what it expects on its port. We can achieve this by using the <code class="code">validate mock</code> statement in the test:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">validatemock(0) interpolatorInstancesWithMock:storeMock;</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294711544/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Check out the complete <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919757/" class="cref">testInterpolator</a> test case.
          </p>
        </div>
        <div>
          <h3 id="sid4098353292122311090" class="section">7.4.6 Sender/Receiver Interfaces</h3>
          <p class="body">
            So far we have always used client/server interfaces to communicate between components. These essentially define a set of operations, plus contracts, that can be invoked in a client/server style. However, mbeddr comes with a second kind of interface, the sender/receiver interface. In this case, the providing and requiring components exchange <em class="emph">data items</em>. To demonstrate how they work, let us explore another aspect of the application around <code class="code">Trackpoint</code>s (the example is in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6700886800242034956/" class="cref">ComponentsSRI</a> implementation module). The data has to be collected in the airplane. Let us assume we have the following components:   
          </p>
          <ul>
            <li>a GPS to provide the position</li>
            <li>a speed indicator for the speed</li>
            <li>
              a flight recorder, whose job it is to create lists of <code class="code">Trackpoint</code>s that capture the progress of the flight
            </li>
          </ul>
          <p class="body">
            All these components are time-triggered, i.e. it is assumed that they execute in regular intervals, by some kind of scheduler. They all provide an interface <code class="code">Timed</code> that provides an operation <code class="code">tick</code> that is called by the scheduler.  So far, these components don&apos;t exchange any data yet: sender/receiver interfaces will be used for that later<sup id="sid4098353292122311090_footnote_1_origin" title="Note that this time-triggered architecture is very widespread in embedded software. In future releases of mbeddr we will provide direct support for time-triggered runnables, so you don't have to use an explicit interface such as Timed." class="footnodeOrigin"><a href="#sid4098353292122311090_footnote_1_text">1</a></sup>. Here is the code so far:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">module ComponentsSRI imports DataStructures { <br/>
   <br/>
  exported cs interface Timed { <br/>
    void tick() <br/>
  }    <br/>
   <br/>
  exported component GPS extends nothing { <br/>
    provides Timed timed <br/>
    void timed_tick() &lt;= op timed.tick {}<br/>
  } <br/>
   <br/>
  exported component SpeedIndicator extends nothing { <br/>
    provides Timed timed <br/>
    void timed_tick() &lt;= op timed.tick {}<br/>
  } <br/>
   <br/>
  exported component FlightRecorder extends nothing { <br/>
    provides Timed timed <br/>
    void timed_tick() &lt;= op timed.tick {}<br/>
  } <br/>
     <br/>
}</pre>
          </div>
          <p class="body">Let&apos;s now look at the data exchange, focussing on the position first. Here is a sender/receiver interface position provider. The interface declares a set of data elements, in this case with physical units:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported sr interface PositionProvider {<br/>
  int8/m/ x;                            <br/>
  int8/m/ y;                            <br/>
  int16/m/ alt;                         <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6700886800242034960/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">The GPS is supposed to provide this data, so we give it a provided port with this interface:</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component GPS extends nothing {<br/>
  provides PositionProvider pos         <br/>
  provides Timed timed                  <br/>
  void init() &lt;= on init {              <br/>
  pos.x = 0 m;                          <br/>
  pos.y = 0 m;                          <br/>
  pos.alt = 0 m;                        <br/>
} runnable init                         <br/>
  void timed_tick() &lt;= op timed.tick {  <br/>
  pos.x++;                              <br/>
  pos.y++;                              <br/>
} runnable timed_tick                   <br/>
} component GPS</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6700886800242034993/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">Note how from within component runnables we can use expressions to assign to the data values defined in the interface as if they were normal fields. Let us now look at the flight recorder. It is supposed to read the data written by the GPS (and the same with the speed indicator):</p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported component FlightRecorder extends nothing {<br/>
  provides Timed timed                             <br/>
  requires PositionProvider pp                     <br/>
  requires SpeedProvider sp                        <br/>
  Trackpoint[1000] recordedFlight;                 <br/>
  uint16 count = 0;                                <br/>
  void timed_tick() &lt;= op timed.tick {             <br/>
                                                   <br/>
  with (recordedFlight[count]) {                   <br/>
  id = ((int8) count);                             <br/>
  x = pp.x;                                        <br/>
  y = pp.y;                                        <br/>
  alt = pp.alt;                                    <br/>
  speed = sp.speed;                                <br/>
}                                                  <br/>
  count++;                                         <br/>
} runnable timed_tick                              <br/>
  Trackpoint getFlightNo(uint16 no) &lt;= no trigger {<br/>
  return recordedFlight[no];                       <br/>
} runnable getFlightNo                             <br/>
} component FlightRecorder</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6700886800242035156/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            Inside the <code class="code">with</code>-statement, we can access the data acquired via the <code class="code">pp</code> and <code class="code">sp</code> required ports.  What distinguishes this from global variables, of course, is that the component instances still have to be wired: required ports have to be connected to provided ports, in this case, defining access to the data items:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">instances instances {                   <br/>
  instance GPS gps_comp                 <br/>
  instance SpeedIndicator indicator     <br/>
  instance FlightRecorder recorder      <br/>
  connect recorder.sp to indicator.speed<br/>
  connect recorder.pp to gps_comp.pos   <br/>
  adapt gps -&gt; gps_comp.timed           <br/>
  adapt si -&gt; indicator.timed           <br/>
  adapt rec -&gt; recorder.timed           <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/6700886800242040150/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">This part of the tutorial only provided a few examples of Interfaces and Components. For a full discussion of Interfaces and Components see \\fordetails{Interfaces and Components}{\\sect{details_components}}</p>
          <p class="footnoteText" id="sid4098353292122311090_footnote_1_text">
            <a href="#sid4098353292122311090_footnote_1_origin">1:</a> 
             
            Note that this time-triggered architecture is very widespread in embedded software. In future releases of mbeddr we will provide direct support for time-triggered runnables, so you don&apos;t have to use an explicit interface such as <code class="code">Timed</code>.
          </p>
        </div>
        <div>
          <h3 id="sid6669194810542205988" class="section">7.4.7 Composite Components</h3>
          <p class="body">
            Components are great to structure your code in reusable pieces. But typically when your systems grow you want to reuse whole subsystems. To the outside they look exactly like any other component but on the inside they again are wired up out of many components. This can be achieved with mbeddr&apos;s composite components.<br/>
A composite component, as any other component can require and provide interfaces from/to its environment. In addition to regular components it has an additional code block called <code class="code">internal instances</code> for instantiating other components and wire them up. <br/>
Let&apos;s build an imaginary GPS parser that can be reused. The first interface we create is a client server interface which accepts single characters. Those characters will be used by a line parser which can tokenize the stream of chars into whole lines and at the same time figures out which command was send by the client. Each line is then fed into another component which itself delegates the command to a command handler. This command handler parses the command and transforms the data into a struct that can be easily consumed by a client. The client of the GPS parser does not need to know how the parsing works internally and that it again is split up into separate components. The only relevant part is that she needs to provide the system with the stream of characters and takes the events produced by the GPS parser to work on them. To achieve this we create a composite component which provides the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7525936201955709890/" class="cref">CharParser</a> and requires the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1769384868164310977/" class="cref">NmeaRmcEventProcessor</a>. In the wiring we instantiate the respective components and wire them up. Finally, we <em class="emph">delegate</em> the outside required and provided ports. The whole code for the composite component is here. Don&apos;t forget to add the <code class="code">composite components</code> config item to the build configuration.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported composite component NmeaStack {                                        <br/>
                                                                                <br/>
  provides CharParser charParser                                                <br/>
  requires NmeaRmcEventProcessor rmcEventProcessor                              <br/>
                                                                                <br/>
  internal instances {                                                          <br/>
  instance NmeaLineParserImpl lineParser                                        <br/>
  instance NmeaSentenceHandlerImpl sentenceHandler                              <br/>
                                                                                <br/>
  instance NmeaRmcHandlerImpl rmcHandler                                        <br/>
  connect lineParser.sentenceHandler to sentenceHandler.sentenceHandler         <br/>
  connect multi sentenceHandler.commandHandlers to rmcHandler.nmeaCommandHandler<br/>
                                                                                <br/>
  delegate charParser to lineParser.charParser                                  <br/>
  delegate rmcEventProcessor to rmcHandler.nmeaRmcEventProcessor                <br/>
}                                                                               <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7525936201962025279/" class="originalNode" title="open in MPS"></a>
          </div>
        </div>
        <div>
          <h3 id="sid6669194810542205892" class="section">7.4.8 Interface Types</h3>
          <p class="body">
            In a few rare cases you want to store a required port also as a local variable (e.g. when iterating over a bunch of multiports where you filter out some of them). In even rarer cases you may want to pass a required port as an argument to a function or runnable you are calling or store it in a global variable. To address those use cases we introduces a type in mbeddr called <code class="code">interface</code>. In order to use an interface in such a interface type this interface has to be specially marked with an annotation <span class="menuClick"><span><span class="menuItem">Toggle Can be used as Type</span></span></span>.
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">exported cs interface NmeaCommandHandler can be used as type {  <br/>
  boolean canHandle(string command)                             <br/>
  void handle(int8[MAX_NMEA_WORD_COUNT]* words, uint8 wordCount)<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7525936201961561072/" class="originalNode" title="open in MPS"></a>
          </div>
          <div class="codeblockContainer">
            <pre class="codeblock">void sentenceHandler_parseSentence(int8[MAX_NMEA_WORD_COUNT]* words, uint8 wordCount) &lt;= op sentenceHandler.parseSentence {<br/>
  interface&lt;NmeaCommandHandler&gt; handlerToCall = null;                                                                      <br/>
  for (i ++ in [0..MAX_NMEA_COMMAND_HANDLER_COUNT[) {                                                                      <br/>
  if (commandHandlers[i] != null &amp;&amp; commandHandlers[i].canHandle(words[0])) {                                              <br/>
  handlerToCall = commandHandlers[i];                                                                                      <br/>
} if                                                                                                                       <br/>
} for                                                                                                                      <br/>
  handlerToCall.handle(words, wordCount);                                                                                  <br/>
} runnable sentenceHandler_parseSentence</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7525936201961540123/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The example above actually would not need the interface type as the <code class="code">handle</code> runnable could be called right in place.
          </p>
        </div>
        <div>
          <h3 id="sid4098353292122311572" class="section">7.4.9 Visualizing Components</h3>
          <p class="body">mbeddr&apos;s diagramming capabilities are put to use in two ways in the context of components: component/interface dependencies and instance diagrams.</p>
          <p class="body">
            <strong class="bold">* Component/Interface Dependencies</strong> Select a component or an interface and execute the <em class="emph">Visualize</em> action from the context menu (or press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">V</span></span></span>). <a href="#sid2112775524680345223" class="imgRef">Fig. 7.4.9-A</a> shows the result. 
          </p>
          <div class="imagecontainer" id="sid2112775524680345223">
            <div class="image">
              <img src="images/tutorial/v_components.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.4.9-A: </b>The interface/components dependency diagram shows all components visible from the current module, the interfaces, and the provided (solid lines) and required ports (dashed lines).
              </p>
            </div>
          </div>
          <p class="body">
            <strong class="bold">* Instance/Wiring Diagrams</strong> You can also select an instance configuration and visualize it. You&apos;ll get a diagram that shows component instances and their connections (<a href="#sid2112775524680350931" class="imgRef">Fig. 7.4.9-B</a>).
          </p>
          <div class="imagecontainer" id="sid2112775524680350931">
            <div class="image">
              <img src="images/tutorial/v_instances.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.4.9-B: </b>This diagram shows component instances and their connectors. The label in the instance boxes contain the instance name and the component name (after the colon). The edges represent connectors. The label shows the required port (before the arrow, the provided port name (after the arrow), and the name of the interface used by the two ports (on the new line).
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid4098353292122312056" class="section">7.4.10 Contract Verification</h3>
          <p class="body">
            mbeddr comes with support for verifying contracts of components statically. This verification is based on C-level verification with CBMC (for a more detailed discussion about the formal verification with mbeddr, please look at <span class="sectRef">Section <a href="#sid9020927825193819488">Functional Verification</a></span>. Let&apos;s set up our tutorial to use verification.  Let us verify the <code class="code">InMemoryStorage</code> component. To do so,  first add the <code class="code">com.mbeddr.analyses.componentcontracts</code> devkit to the model that contains the components code. Then use an intention to add the <code class="code">verifiable</code> flag to the component. To make the verification work, you will have to provide some more information in the inspector:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">entry point: verification   <br/>
  loops unwinding: 2         <br/>
  unwinding assertions: false</pre>
          </div>
          <p class="body">
            Let us look at the three parameters you have to set here: The first one determines from where the program is &quot;executed&quot;. The entry point should be selected to be &quot;close&quot; to the to-be-verified component (if you verify the whole system, then, at least for big systems, this will take long). In our case we use a special test case <code class="code">verification</code>, which looks as follows:
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">instances verificationInstances {                     <br/>
  instance Interpolator interpol(divident = 2)        <br/>
  connect interpol.store to store.store               <br/>
  instance InMemoryStorage store                      <br/>
  adapt verificationInterpolator -&gt; interpol.processor<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1634970928501130997/" class="originalNode" title="open in MPS"></a>
          </div>
          <div class="codeblockContainer">
            <pre class="codeblock">exported testcase verification {        <br/>
  initialize verificationInstances;     <br/>
  Trackpoint p1 = {                     <br/>
  id = 1,                               <br/>
  time = 1 s,                           <br/>
  speed = 10 mps                        <br/>
};                                      <br/>
  Trackpoint p2 = {                     <br/>
  id = 1,                               <br/>
  time = 1 s,                           <br/>
  speed = 20 mps                        <br/>
};                                      <br/>
  verificationInterpolator.process(&amp;p1);<br/>
  verificationInterpolator.process(&amp;p2);<br/>
} verification(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1634970928501131025/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            The second line in the configuration determines how often a loop is executed. You should start with low numbers to keep verification times low. Finally, the third parameter determines if the verification should fail in case it cannot be proven that the <code class="code">unwinding loops</code> number is sufficient.  You can now run the verification by selecting the component and executing the <span class="menuClick"><span><span class="menuItem">Verify Component</span></span></span> action. After a few seconds, you&apos;ll get a result table that reports everything as ok (see <a href="#sid7979854108175988977" class="imgRef">Fig. 7.4.10-A</a>): every precondition of every operation in every provided port has been proven to be correct.
          </p>
          <div class="imagecontainer" id="sid7979854108175988977">
            <div class="image">
              <img src="images/tutorial/verificationOK.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.4.10-A: </b>The table that shows the verification results; everything is ok in this case.
              </p>
            </div>
          </div>
          <p class="body">
            Let us introduce an error. The following version of the <code class="code">trackpointStore_store</code> runnable does not actually store the trackpoint. This violates the postcondition, which claims that <code class="code">storedTP != null</code>. Note that for the analysis to work, all paths through the body of a function (or a runnable) must end with a return (you&apos;ll get an in-IDE error if you don&apos;t do this). 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">void trackpointStore_store(Trackpoint* tp) &lt;- op store.store { <br/>
  return; <br/>
}</pre>
          </div>
          <p class="body">
            Let us rerun the verification. Now we get an error, as shown in <a href="#sid7979854108176023036" class="imgRef">Fig. 7.4.10-B</a>. Note how the lower part of the table now shows the execution trace that led to the contract violation. You should check the <code class="code">Call/Return</code> checkbox to filter the trace to only show the call/return-granularity, and not every statement. You can also double-click onto the trace elements to select the particular program element in the code.
          </p>
          <div class="imagecontainer" id="sid7979854108176023036">
            <div class="image">
              <img src="images/tutorial/verificationNotOK.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                7.4.10-B: </b>The table that shows the verification results; now we have an error, and the trace in the bottom half shows an example execution that led to the error.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051957167614" class="section">7.5 Decision Tables</h2>
        <p class="body">
          Let us implement another interface, one that lets us judge flights (we do this in a new section in the <code class="code">Components</code> module). The idea is that clients add trackpoints, and the <code class="code">FlightJudger</code> computes some kind of score from it (consider some kind of biking/flying competition as a context):
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported cs interface FlightJudger {<br/>
  void reset()                      <br/>
  void addTrackpoint(Trackpoint* tp)<br/>
  int16 getResult()                 <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919766/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">Here is the basic implementation of a component that provides this interface.</p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported component Judge extends nothing { <br/>
  provides FlightJudger judger <br/>
  int16 points = 0; <br/>
  void judger_reset() &lt;- op judger.reset { <br/>
    points = 0; <br/>
  }  <br/>
  void judger_addTrackpoint(Trackpoint* tp) &lt;- op judger.addTrackpoint { <br/>
    points += 0; // to be changed<br/>
  }  <br/>
  int16 judger_getResult() &lt;- op judger.getResult { <br/>
    return points; <br/>
  }  <br/>
}</pre>
        </div>
        <p class="body">
          Of course the implementation of <code class="code">addTrackpoint</code> that just adds <code class="code">0</code> to the <code class="code">points</code> doesn&apos;t make much sense yet. The amount of points added should depend on how fast and how high the plane (or whatever) was going. The following screenshot shows an embedded decision table that computes points (Notice we mix the components language, the decision tables and the units in one integrated program):
        </p>
        <div class="imagecontainer" id="sid7979854108176393267">
          <div class="image">
            <img src="images/tutorial/dectab.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              7.5-A</b>
              
            </p>
          </div>
        </div>
        <p class="body">
          You can create the decision on your own by first of all typing the keyword <code class="code">dectab</code> - this instanciates the concept.  To add a column, hit <span class="keyPress"><span><span class="key">enter</span></span></span> in one of the cells. For adding a row, move your cursor  on the left side of the table (between the default return value and the table) and hit <span class="keyPress"><span><span class="key">enter</span></span></span>.  Now, let us write a test. Of course we first need an instance of <code class="code">Judge</code>:
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">instances instancesJudging {<br/>
  instance Judge theJudge   <br/>
  adapt j -&gt; theJudge.judger<br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294662008/" class="originalNode" title="open in MPS"></a>
        </div>
        <p class="body">
          Below is the test case. It contains two things you maybe haven&apos;t seen before. There is a second form of the <code class="code">for</code> statement that iterates over a range of values. The range can be exclusive the ends or inclusive (to be changed via an intention). In the example we iterate from 0 to 4, since 5 is excluded. The <code class="code">introduceunit</code> construct can be used to &quot;sneak in&quot; a unit into a regular value. This is useful for interacting with non-unit-aware (library) code. Note how the expression for <code class="code">speed</code> is a way of expressing the same thing without the <code class="code">introduceunit</code> in this case. Any expression can be surrounded by <code class="code">introduceunit</code> via an intention.
        </p>
        <div class="codeblockContainer">
          <pre class="codeblock">exported testcase testJudging {                          <br/>
  initialize instancesJudging;                           <br/>
  j.reset();                                             <br/>
  Trackpoint[5] points;                                  <br/>
  for (i ++ in [0..5[) {                                 <br/>
  points[i].id = ((int8) i);                             <br/>
  points[i].alt = 1810 + 100 * i m;                      <br/>
  points[i].speed = 130 mps+ 10 mps* i;                  <br/>
  j.addTrackpoint(&amp;points[i]);                           <br/>
} for                                                    <br/>
  assert-equals(0) j.getResult() == 0 + 0 + 20 + 20 + 20;<br/>
} testJudging(test case)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294655278/" class="originalNode" title="open in MPS"></a>
        </div>
        <div>
          <h3 id="sid7979854108176472498" class="section">7.5.1 Verifying the Decision Table</h3>
          <p class="body">
            So far so good. The test case is fine. However, as with many tests, this one only tests part of the overall functionality. And in fact, you may have noticed that an error lurks inside our decision table: for 2000 m of altitude, the table is non-deterministic: both conditions in the column header work! We could find this problem with more tests, or we could use formal verification as described in <span class="sectRef">Section <a href="#sid4315280228446701717">Checking Decision Tables</a></span>. 
          </p>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid2101724341003970560" class="section">8 Process Support</h1>
      <div>
        <h2 id="sid1195021413140175530" class="section">8.1 Requirements</h2>
        <div>
          <h3 id="sid1195021413140175561" class="section">8.1.1 Overview</h3>
          <p class="body">
            mbeddr ships with a language for capturing, documenting and maintaining requirements. To use them, use the <code class="code">com.mbeddr.reqtrace</code> devkit in your model. In this documentation we refer to a number of requirements modules, in particular <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/1433966787984154171/" class="cref">FlightJudgementRules</a>, <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/8119642625901794439/" class="cref">ArchitecturalComponents</a> and <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/6898387700925052063/" class="cref">UseCases</a>.
          </p>
        </div>
        <div>
          <h3 id="sid1195021413140757038" class="section">8.1.2 Requirements Basics</h3>
          <p class="body">
            Requirements are contained in requirements modules. An example is <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/1433966787984154171/" class="cref">FlightJudgementRules</a>. Like C implementation modules, requirements modules can import other modules. The (exported) contents of the imported modules then become visible in the current module.
          </p>
          <p class="body">
            Each requirement is decribed with a number of characteristics; an example is shown in <a href="#sid1195021413140797749" class="imgRef">Fig. 8.1.2-A</a>. Each requirement has a unique ID (<code class="code">InitialNoPoints</code>), a summary (<code class="code">Initially you have no points.</code>), a requirements kind (<code class="code">/functional</code>), a number of tags (none here), a detailed textual description (only one line given here), plus optional additional data (here we show a workpackage). The number (1 in the example) is automatically determined by the tree structure of the requirements. In order to reference a requirement, the unique ID is used, not the number. We discuss some of these things below.
          </p>
          <div class="imagecontainer border" id="sid1195021413140797749">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_exampleRequirement.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.1.2-A</b><a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/3340584831013385653/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            <b>Hierarchy</b>&nbsp;&nbsp;Requirements are stored in a hierarchy. Each requirement can have children, as can be seen from <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/1433966787984154174/" class="cref">InFlightPoints</a>. The semantics of hierarchical nesting are not rigorously defined, but usually assumed to represent refinement (i.e., additional details).
          </p>
          <p class="body">
            <b>Kind</b>&nbsp;&nbsp;Each requirement has a kind. The kind represents the nature of the requirement, and existing kinds include <code class="code">functional</code>, <code class="code">non-functional</code> and <code class="code">technical</code>. Language extension can be used to define arbitrary additional kinds. In addition to being a label (to sort or query requirements), the kind can also be used to enforce the presence of certain additional requirements data nodes (discussed next).
          </p>
          <p class="body">
            <b>Additional Data</b>&nbsp;&nbsp;In addition to the description, a requirement can have data objects. As usual, these are extensible and can represent any additional structure. Examples include the (demo) business rules in <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/552710421071397247/" class="cref">PointForATrackpoint</a>, tables as in <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/2992054467179682925/" class="cref">priceDep</a> or architectural components as shown in <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/8119642625901800301/" class="cref">Driver</a>. The requirements kind described above can include constraints that enforce certain kinds of data (e.g., a <code class="code">timing</code> requirement may require a <code class="code">timing spec</code> data object).
          </p>
          <p class="body">
            <b>Cross References</b>&nbsp;&nbsp;An important aspect of requirements are their relationships: a requirement can establish relations to other requirements. The requirement shown in <a href="#sid1195021413140970734" class="imgRef">Fig. 8.1.2-B</a> shows both kinds of cross references. First, cross references can be added to the prose description using the <code class="code">@req</code> word (press <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> anywhere in the prose block to insert such special words). The other alternative is to use special data objects (such as <code class="code">requires also</code> and <code class="code">conflicts with</code>. The former approach is a generic relationship, the latter ones are qualified. Of course, additional relationships can be created using language extension. 
          </p>
          <div class="imagecontainer border" id="sid1195021413140970734">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_depExample.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.1.2-B</b><a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/1711211267079724584/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            <b>Tags</b>&nbsp;&nbsp;Tags are similar the data objects, but they are &quot;syntactically smaller&quot;. Existing tags include the requirements status (you can set it to <code class="code">draft</code>, <code class="code">accepted</code>, etc.), the estimated effort for implementing the requirement as well as a general string tag represented by the <code class="code">@</code> sign.
          </p>
          <p class="greyBox">
            The requirements language is intended to be used by (among others) non-programmers. They may not be familiar with pressing <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> to enter new program elements. Hence, there is a special projection mode <code class="code">Editor Helper Buttons</code> that projects buttons into a requirements module to add child requirements, data or change the nesting hierarchy (see <span class="sectRef">Section <a href="#sid2101724341004008376">Projection Modes</a></span> on how to swich Projection Modes).
          </p>
        </div>
        <div>
          <h3 id="sid1195021413141367739" class="section">8.1.3 Visualizations and Tree Views</h3>
          <p class="body">
            The requirements visualization show the upstream and downstream dependencies of a particular requirement. An example is shown in <a href="#sid1195021413141343962" class="imgRef">Fig. 8.1.3-A</a>. In addition, several tree views are available that show the requirements hierarchy, the dependencies and also the up- and downstream dependencies of the requirements module (shown in <a href="#sid1195021413141415802" class="imgRef">Fig. 8.1.3-B</a>).
          </p>
          <div class="imagecontainer border" id="sid1195021413141343962">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuideprocessSupportreqvisAndTreedepVis.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.1.3-A: </b>A visualization of the dependencies of a requirement.
              </p>
            </div>
          </div>
          <div class="imagecontainer" id="sid1195021413141415802">
            <div class="image">
              <img src="images/processSupport/reqtree.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.1.3-B: </b>The tree view that shows the dependencies of a requirements module.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid2805811593275579771" class="section">8.2 Tracing</h2>
        <p class="body">
          A trace is a pointer from some implementation artifact to one or more requirements <sup id="sid2805811593275579771_footnote_1_origin" title="Strictly speaking, it can also point to other traceable elements; mbeddr is extensible in this way. But by default, only requirements are supported as trace targets." class="footnodeOrigin"><a href="#sid2805811593275579771_footnote_1_text">1</a></sup>. To use traces, make sure you use the <code class="code">com.mbeddr.reqtrace</code> devkit in your models.
        </p>
        <p class="body">
          For an example of a trace, see the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464295358354/" class="cref">StateMachines</a> module. It has traces attached to a number of C constants and to various parts of the state machine (make sure you select a projection mode that actually shows the traces); an example is also shown in <a href="#sid85256576553522975" class="imgRef">Fig. 8.2-A</a>. Make sure you select a projection mode that lets you actually see the traces (see below).
        </p>
        <p class="body">
          <b>Trace Kind</b>&nbsp;&nbsp;Each trace has a trace kind associated with it. Trace kinds characterize the nature of the trace relationship. While the set of trace kinds is extensible, mbeddr ships with three default trace kinds: <code class="code">implements</code>, <code class="code">exemplifies</code> and <code class="code">tests</code>. Note that a trace kind can restrict the kinds of requirements it can trace to, and it can also restrict to which nodes the trace can be attached. While the default trace kinds have no such constraints, it is useful in general to enforce specific semantics through those constraints. 
        </p>
        <p class="body">
          <b>Projection Modes</b>&nbsp;&nbsp;There are three different modes how traces can be shown (and they can be switched like all other projection modes, see <span class="sectRef">Section <a href="#sid2101724341004008376">Projection Modes</a></span>):
        </p>
        <ul>
          <li>
            <code class="code">Detailed Traces</code>: The trace kind and the trace target(s) are shown on the right side of the traced node (see <a href="#sid85256576553522975" class="imgRef">Fig. 8.2-A</a>).
          </li>
          <li>
            <code class="code">Compact Traces</code>: Only a small <code class="code">[T]</code> is shown on the right side of the traced node (see <a href="#sid85256576552176368" class="imgRef">Fig. 8.2-B</a>). A tooltip shows the first of the traces elements and the trace kind. The kind and targets can be changed in the inspector of the <code class="code">[T]</code> node. 
          </li>
          <li>
            <code class="code">No Traces</code>: the traces are not shown (even though, of course, they are still in the code)
          </li>
        </ul>
        <div class="imagecontainer" id="sid85256576553522975">
          <div class="image">
            <img src="images/processSupport/detailedTraces.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              8.2-A: </b>The detailed trace mode in mbeddr.
            </p>
          </div>
        </div>
        <div class="imagecontainer" id="sid85256576552176368">
          <div class="image">
            <img src="images/processSupport/littleTTraces.png" />
          </div>
          <div class="imagecaption">
            <p class="caption">
              <b>Figure
              8.2-B: </b>The compace trace mode in mbeddr.
            </p>
          </div>
        </div>
        <p class="body">
          To get a better feel for the projection modes we suggest you play around with them in the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464295358354/" class="cref">StateMachines</a> module which contains traces to requirements.
        </p>
        <div>
          <h3 id="sid2805811593282828678" class="section">8.2.1 Attaching and Removing Traces</h3>
          <p class="body">
            To attach a trace to any given requirement, the requirements module, that contains the target requirement, must be imported to the client module (using the regular module imports). You can then use the <span class="keyPress"><span><span class="key">Attach Trace</span></span></span> annotation to attach a trace to any node. By default, the <code class="code">implements</code> trace kind will be used and you can then use regular code completion to select a target requirement. Note that if you use the <code class="code">Compact Trace</code> projection mode, you will have to use the inspector to change the kind or the target requirement(s).
          </p>
          <p class="body">
            To remove a trace, you can simply use the <span class="keyPress"><span><span class="key">Backspace</span></span></span> key when the trace itself is selected.
          </p>
        </div>
        <div>
          <h3 id="sid2805811593282828696" class="section">8.2.2 Reverse Tracing</h3>
          <p class="body">
            Traces always go <em class="emph">towards</em> a requirement. However, often you want to see which artifacts trace <em class="emph">to</em> which requirement, i.e., you want to reverse the direction. You can do this by using the customized <span class="menuClick"><span><span class="menuItem">Find Usages Settings...</span></span></span> context menu. If you select <code class="code">Traces</code> in the dialog (see <a href="#sid4424988308480506112" class="imgRef">Fig. 8.2.2-A</a>). In the result, you will get a separate section with only the traces to the respective requirement. <a href="#sid4424988308481611390" class="imgRef">Fig. 8.2.2-B</a> shows an example result. <span class="sectRef">Section <a href="#sid4424988308481613119">Find Usages</a></span> explains the find usages facility in general.
          </p>
          <div class="imagecontainer" id="sid4424988308480506112">
            <div class="image">
              <img src="images/processSupport/findUsagesDialog.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.2.2-A: </b>Selecting the Traces as the target for the Find Usages.
              </p>
            </div>
          </div>
          <div class="imagecontainer" id="sid4424988308481611390">
            <div class="image">
              <img src="images/processSupport/findUsagesResult.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.2.2-B: </b>Finding the traces to a requirement via Find Usages.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid2805811593282828781" class="section">8.2.3 Trace Report Assessment</h3>
          <p class="body">
            The find usages facility discussed in the previous section provides an interactive means to find out which code locations trace to a requirement. But sometimes you want to get an overview. For this purpose, you can use the <code class="code">traces</code> assessment. Assessments are reports that query the model and list the results; they are explained in more detail in <span class="sectRef">Section <a href="#sid3231021218602645814">Assessments</a></span>. 
          </p>
          <p class="body">
            An example <code class="code">traces</code> assessment can be found in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2426041105270455844/" class="cref">Traces</a>. In the query, you have to select the requirements module for whose requirements you want to run the assessment. The results then show each requirement and the code locations from which it is traced.
          </p>
        </div>
        <p class="footnoteText" id="sid2805811593275579771_footnote_1_text">
          <a href="#sid2805811593275579771_footnote_1_origin">1:</a> 
           
          Strictly speaking, it can also point to other <em class="emph">traceable</em> elements; mbeddr is extensible in this way. But by default, only requirements are supported as trace targets.
        </p>
      </div>
      <div>
        <h2 id="sid3231021218602645814" class="section">8.3 Assessments</h2>
        <p class="body">An assessment is essentially a report over a model. It performs a query and then reports the results. The queries are of course customizable; there are dozens of different assessments and new ones can be developed using language engineering. Also the structure of the result data items is of course different for each assessment. Check out the following assessments to get an impression:</p>
        <ul>
          <li>
            <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/3815661793603772411/" class="cref">Visualizations</a> reports a simple list of all program elements that have a visualization associated with them. The visualization can be rendered directly from the assessment result item (using <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">V</span></span></span> or the context menu. This assessment always uses the current model as the scope for the report; it has no further configuration options.
          </li>
          <li>
            <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/2426041105270455844/" class="cref">Traces</a> shows a trace report. The query can be parametrized with the requirements module for which the query should be run. The result shows various properties of the result, you can use <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Click</span></span></span> to navigate to the result nodes themselves. This assessment also uses grouping.
          </li>
          <li>
            <a href="http://localhost:8080/select/tutorial/r:79ed4c17-66fc-4c5a-bff7-46990b4e0c5d/8765685756424594106/" class="cref">EffortsOfWorkPackages</a> shows an assessment that can be parametrized in various ways; the results use custom cells to show a progress bar.
          </li>
        </ul>
        <p class="body">Since assessment and their state is persisted, they can be used to assess, or audit, models over time. As we discuss below, it is easy to track changes to the result set over time.</p>
        <p class="body">
          <b>Setting up an Assessment</b>&nbsp;&nbsp;Assessments live in an <code class="code">Assessments</code> root. Once such a root is created, any number of assessments can be added. Each assessment has a name and a query. The query is a separate node that performs the query itself; it also may have parameters that can be set by the users. Queries are the primary extension point, new queries can be developed via language extension.
        </p>
        <p class="body">
          <b>Updating and the Color Code</b>&nbsp;&nbsp;Once a query is defined, you can use <span class="menuClick"><span><span class="menuItem">Update</span></span></span> to execute it (either via an intention or via the context menu). Updating the assessment reruns the query. However, the old results are not replaced by the new ones. Instead, the system performs a kind of diff:
        </p>
        <ul>
          <li>Results that are no longer in the new result set are deleted</li>
          <li>Results that are in the new set but have not been in the old one are called new; they get an orange bar in front.</li>
          <li>Results that are in the new as well as in the old result set are marked as grey.</li>
        </ul>
        <p class="body">By using this color coding scheme, users can always see which result items have been added during the latest update. This is very useful for continuing audits of models because it is immediately obvious which result items may require attention (see next paragraph).</p>
        <p class="body">
          <b>Checkboxing and Errors</b>&nbsp;&nbsp;A particularly interesting use case for assessments is the detection and tracking of smells, style guide violations or other things that <em class="emph">may</em> have to be fixed or changed. The assessment can be used to find and report them. The user then goes through all of the result items and decides for each of them what to do:
        </p>
        <ul>
          <li>The user may fix the offending code; upon update of the assessment, the corresponding result items goes away</li>
          <li>Alternatively, the user may decide that a particular smell is acually ok in this case; so the result item must be marked as &quot;it&apos;s ok, don&apos;t bother me again&quot;.</li>
        </ul>
        <p class="body">
          To support the latter case, the <code class="code">must be ok</code> option can be set on an assessment. Then every result item gets its own checkbox. Checking this checkbox means that &quot;this result item is ok&quot;, i.e., it should not be marked as an error (the colored vertical bar becomes blue in this case). It is also possible to hide all those items where the checkbox is checked in the result set by selecting the <code class="code">hide ok ones</code> option. Finally, an assessment that is marked as <code class="code">must be ok</code> results in a regular type system error if it has one or more result items that are not marked as ok.
        </p>
      </div>
      <div>
        <h2 id="sid3231021218602638869" class="section">8.4 Documentation Language</h2>
        <div>
          <h3 id="sid5479545238865063690" class="section">8.4.1 Basic Ideas</h3>
          <p class="body">Writing documentation for code is annoying, since you always have to copy code snippets into the document (as text or as a screenshot), make sure they are formatted nicely, and - most importantly - keep them up to date as the code changes. The mbeddr documentation language avoids this problem: it treats documentation just like code in MPS, the documentation language is just another language written in MPS. Consequently it is trivial to refer to code, make sure that the reference is refactored along with the code itself (in particular in case of renames) and, by using a few tricks, you can even &quot;virtually embed&quot; code into the documents.  </p>
          <p class="body">
            The user guide you are reading right now is written with this language. Consequently, a good way to learn mbeddr&apos;s documentation language is to switch off Presentation Mode (via the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Modes</span></span></span> menu) and take a look how the user guide is built. We&apos;ll explain some basics in this chapter but otherwise recommend you to just look at the <a href="http://localhost:8080/select/tutorial/r:7f372397-146b-40d5-9f20-607974c4fed4/324047639341435712/" class="cref">user guide</a>.
          </p>
          <p class="body">
            In addition, you can also check out this video: <a href="http://www.youtube.com/watch?v=-kMrvreg6n0" class="url">http://www.youtube.com/watch?v=-kMrvreg6n0</a>
            
          </p>
        </div>
        <div>
          <h3 id="sid5479545238865064144" class="section">8.4.2 Target Platforms</h3>
          <p class="body">We support several target plaforms for the documentation language:</p>
          <ul>
            <li>
              <strong class="bold">Presentation Mode:</strong> Most importantly, we support the Presentation Mode where the document is rendered in MPS with a nice, readable projection and all images, listings or code snippets shown inline.
            </li>
            <li>
              <strong class="bold">LaTeX:</strong> A generator creates LaTeX sources from documentation language Documents. While this works well in principle, there are several layouting problems with image sizes. After the sources have been generated they have to be processed by Latex manually (e.g., by invoking <code class="code">xelatex</code> on them). A more detailed documentation is still <span><strong class="todo">[ToDo: 
              
              ]</strong></span>.
            </li>
            <li>
              <strong class="bold">HTML:</strong> Similar to LaTeX, we can also generate HTML sources. We use this to generate the online version of this user guide.
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid5479545238865064852" class="section">8.4.3 Core Concepts</h3>
          <p class="body">In this section we describe the most important abstractions used in the documentation language. Together with the user guide as an extensive example, you should be able to find your way around the language. </p>
          <p class="body">
            <b>Structure</b>&nbsp;&nbsp;Here are the most important structural concepts:
          </p>
          <ul>
            <li>
              <strong class="bold">Documents:</strong> Documents are the main roots in which documentation language content lives. As usual in mbeddr, Documents can express dependencies on other Documents.
            </li>
            <li>
              <strong class="bold">Sections:</strong> A document contains sections. Sections have a name (used for referencing them) as well as a title. Sections can be nested. They are also automatically assigned a number (even though this does not work correctly in Presentation Mode). A reference to a section is created via the <code class="code">@sect</code> word.
            </li>
            <li>
              <strong class="bold">Chapter:</strong> There is also a kind of &quot;special section&quot;, the Chapter. It is simlar in all respects to sections except that it <em class="emph">is</em> a chapter, so it can be treated specially in transformations. 
            </li>
            <li>
              <strong class="bold">Paragraphs:</strong> Inside sections there are all kinds of paragraphs. 
            </li>
          </ul>
        </div>
        <p class="body">
          <b>Paragraphs</b>&nbsp;&nbsp;The paragraph is an abstract concept of which many subconcepts exist. They hold the meat of the document:
        </p>
        <ul>
          <li>
            <strong class="bold">image:</strong> This represents an embedded image. You specify a path prefix (see Configuration and Resources below), and then you can use code completion to select an image file under that path that should be shown in the editor.
          </li>
          <li>
            <strong class="bold">embed as text</strong> This embeds arbitrary MPS nodes into the document. When rendered to HTML or LaTeX, the embedded code will be &quot;copied to text&quot;, so this really only makes sense for notations that have a meaningful textual representation (program code, essentially).
          </li>
          <li>
            <strong class="bold">embed as image:</strong> Similar to the previous one, but the MPS nodes are rendered as an image (screenshot) when serialized to LaTeX or HTML.
          </li>
          <li>
            <strong class="bold">visualization:</strong> References a program node that has a visualization. When rendered out, the visualization is created in real time and embedded.
          </li>
        </ul>
        <p class="body">
          <b>Words</b>&nbsp;&nbsp;Inside text paragraphs, you can use various different special words. Those that start with a backslash are used for formatting. Those that start with an <code class="code">@</code> are references, the ones starting with an <code class="code">\</code> are formatting options. They can be entered by pressing <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Space</span></span></span> inside text blocks. The default text for references can be overridden in the inspector view.
        </p>
        <ul>
          <li>
            There are the usual formatting options for <code class="code">\bold</code>, <code class="code">\emph</code>, <code class="code">\math</code>, <code class="code">\key</code>, <code class="code">\menu</code> and <code class="code">\code</code>. These can also be entered by selecting existing text and then pressing <span class="keyPress"><span><span class="key">Ctrl</span>+</span><span><span class="key">Alt</span>+</span><span><span class="key">T</span></span></span> to bring up the wrapper intentions menu.
          </li>
          <li>
            There are refernces to other sections (<code class="code">@sect</code>), to figures, images or code embedded as images (via <code class="code">@fig</code>). 
          </li>
          <li>
            You can point to other resources in the file system using <code class="code">@attachment</code>
            
          </li>
          <li>
            You can reference MPS nodes via <code class="code">@node</code>
            
          </li>
          <li>
            You can reference MPS modules via <code class="code">@language</code>, <code class="code">@solution</code>, <code class="code">@generator</code> or <code class="code">@devkit</code>.
          </li>
          <li>
            You can embed URLs using <code class="code">\url</code>
            
          </li>
          <li>
            Footnotes are added via <code class="code">\footnote</code>
            
          </li>
          <li>
            Todos can be left in the text via <code class="code">\todo</code>
            
          </li>
        </ul>
        <p class="body">
          <b>Configuation and Resources</b>&nbsp;&nbsp;Every document must refer to a Configuration node. It is mostly used in the context of LaTeX or HTML rendering. However, it also defines the default path where the visualizations store their temporary images. Most importantly, it defines the path prefixes where images (and other attachments) are searched. The path is <em class="emph">always</em> relative to the current solutions root directory. When defining image paragraphs or attachments, you use one of the paths defined in the Config as the path prefix and select an image &quot;below&quot; this path prefix. This is supported with code completion.
        </p>
        <p class="body">
          <b>Building</b>&nbsp;&nbsp;For consuming documents inside MPS using the presentation mode, no build is necessary. However, in case of generating LaTeX or HTML, a <code class="code">DocumentExport</code> node is needed to configure the generation process. <span><strong class="todo">[ToDo: 
          
          ]</strong></span>
          
        </p>
      </div>
      <div>
        <h2 id="sid4424988308481661440" class="section">8.5 Code Review</h2>
        <div>
          <h3 id="sid85256576547059006" class="section">8.5.1 Overview</h3>
          <p class="body">Code reviews are an important ingredient of many development processes. The idea is that in addition to writing the code, the code is also reviewed by another person as a means of quality assurance and joint learning. To this end, it must be tracked which parts of the code are ready for review, which parts have been reviewed (and by whom), and which parts have changed since the review (and hence need to be re-reviewed). In mbeddr, we support this process with the following approach:</p>
          <ul>
            <li>In principle, all program nodes can be reviewed separately. For pragmatic reasons, we currently resrict reviews to root nodes, as well as the first level of children (i.e, module contents such as functions, components, or interfaces in C implementation modules). In a future version there will be preferences that define the granularity of review specifically for a project.</li>
            <li>The review information is stored in the program node itself, so it is persisted along with the code itself. It survives branching etc.</li>
            <li>Intentions are used to change the review states.</li>
          </ul>
        </div>
        <div>
          <h3 id="sid85256576547949366" class="section">8.5.2 Projection Modes</h3>
          <p class="body">
            The code review data is shown with the review state annotation and a custom background color. Sometimes, however, you don&apos;t want to see this stuff in the code. Hence there are two projection modes: the review state and the background colors are only shown if you check the <code class="code">Review State</code> option in the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Mode</span></span></span> menu. Make sure you enable the display of the review state so you can follow the next subsections. 
          </p>
        </div>
        <div>
          <h3 id="sid85256576547059000" class="section">8.5.3 Review States</h3>
          <p class="body">mbeddr supports several states as part of the review process:</p>
          <ul>
            <li>
              <code class="code">new:</code> The code has just been written. No review-related information is stored in the code. For example, the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/1731059994647919766/" class="cref">FlightJudger</a> component is in this state.
            </li>
            <li>
              <code class="code">ready:</code> When the developer thinks the code is finished, it can be marked as <code class="code">ready</code>. The code gets a yellow background, and an annotation that states that the code is <code class="code">ready</code>. See <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/7451725615401930837/" class="cref">Judge2</a> for an example.
            </li>
            <li>
              <code class="code">reviewed:</code> Once a reviewer has reviewed the code, it is marked as <code class="code">reviewed</code>. The code gets a green background. Check out this node <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294662008/" class="cref">instancesJudging</a> for an example.
            </li>
            <li>
              <code class="code">raw:</code> After the code has been marked as <code class="code">ready</code> or <code class="code">reviewed</code>, it may be modified again. At this point, of course, the review is invalid. The code now becomes <code class="code">raw</code> (red background). This test case is an example: <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5160057464294655278/" class="cref">testJudging</a>
              
            </li>
          </ul>
          <p class="body">
            When a piece of code is marked as <code class="code">ready</code> or <code class="code">reviewed</code>, we create a hash of the code structure. This hash is stored in the code review annotation, inside the code. By recalculating the hash and comparing it to the one stored in the code, we can detect whether the code has been changed. However, because of the performance implications, we don&apos;t calculate this hash automatically. Instead, you have to use the <span class="menuClick"><span><span class="menuItem">Reevaluate Review</span></span></span> intention on the reviewed node. Alternatively you can also reevaluate all review states from one single location; this is discusseb below in <span class="sectRef">Section <a href="#sid85256576547059029">Assessments</a></span>.
          </p>
        </div>
        <div>
          <h3 id="sid85256576547059029" class="section">8.5.4 Assessments</h3>
          <p class="body">
            There is an assessment (see <span class="sectRef">Section <a href="#sid3231021218602645814">Assessments</a></span> for details about assessments) to show the global state of the code review. <a href="#sid85256576550624296" class="imgRef">Fig. 8.5.4-A</a> shows an example. 
          </p>
          <div class="imagecontainer border" id="sid85256576550624296">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_ReviewOfComponentsStuff.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.5.4-A</b><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/8490595898230656658/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            The query that shows the code review state is called <code class="code">code review summary</code>. In the query you can set the scope to either a single chunk, a single model, or a model includings its imports. The results show the state of the review for the various reviewable nodes (incl. the color code); the second column is clickable, so you can directly jump to the mentioned section of code.
          </p>
          <p class="body">Updating the assessment also re-evaluates all the hashes of the reviewed sections of code. So the assessment, in addition to showing an overview, is also the central place from which to reevaluate all review states.</p>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051957186872" class="section">8.6 Product Line Variability</h2>
        <p class="body">
          mbeddr supports two kinds of variability: runtime and static. <em class="emph">Runtime variability</em> makes the decision about which variant to execute as the program runs. The binary contains the code for all options. Since the code must be aware of the variability, the underlying language must know about variability. <em class="emph">Static variability</em> makes the decision before program execution. In particular, the MPS generators remove all the program code that is not part of a particular variant. The binary is tailored, and the mechanism is generic -- the target language does not have to be aware of the variability. We discuss both approaches in this chapter.
        </p>
        <p class="body">A discussion of the trade-offs between static and runtime variability is beyond the scope of this user guide: it is not a tutorial on product line engineering in general, but only a tutorial on how to do it with mbeddr.</p>
        <div>
          <h3 id="sid5479545238858014169" class="section">8.6.1 Specifying Variability</h3>
          <p class="body">
            Both approaches have in common that in mbeddr, you first describe the available variability on an abstract level that is unrelated to the implementation artifacts that realize the variability. We use feature models for this aspect. A feature model describes the available variability (aka the configuration space) in a software system. Let us start by creating a feature model that describes variability for processing flights. To do so, add the <code class="code">com.mbeddr.cc.variability</code> devkit to your model and add a <code class="code">VariabilitySupport</code> node into your program. <code class="code">VariabilitySupport</code> nodes contain feature models as well as configurations. An example can be found in <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062389703/" class="cref">FlightVariability</a>.
          </p>
          <p class="body">
            <b>Feature Models</b>&nbsp;&nbsp;Feature models map a configuration space. An example feature model is shown in <a href="#sid5479545238858017740" class="imgRef">Fig. 8.6.1-A</a>. A feature is simply a named entity. Features can have children (subfeatures). A feature specifies a constraint over the subfeatures that determine how they can be selected. The following four tree constraints exist:
          </p>
          <ul>
            <li>
              <code class="code">! (mandatory)</code>: this means that all child features are mandatory. In a valid configuration, all of them must be selected.
            </li>
            <li>
              <code class="code">? (optional)</code>: this means that in any valid configuration of this feature model, any combination of the child features can be selected. In other words, all children are optional.
            </li>
            <li>
              <code class="code">xor (exclusive)</code>: this means that exactly one subfeature must be selected in a valid configuration
            </li>
            <li>
              <code class="code">or (n-of-m)</code>: this means that one or more (but not zero) of the subfeatures must be selected in a valid configuration.
            </li>
          </ul>
          <div class="imagecontainer border" id="sid5479545238858017740">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_featureModel.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.6.1-A</b><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062476995/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            In addition, a feature model can also define derived features. These are essentially just macros, i.e., expressions over the existing feature tree. The features <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238859293969/" class="cref">everything</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238858672906/" class="cref">empty</a> are examples.
          </p>
          <p class="body">
            Features can also have attributes. For and example see <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062512675/" class="cref">maxSpeed</a> below. These are (more or less primitively) typed attribute declarations. In a valid configuration, all attributes of all selected features must have a value. 
          </p>
          <p class="body">
            <b>Configurations</b>&nbsp;&nbsp;Once a feature model is defined, you can specify <em class="emph">configurations</em> or <em class="emph">variants</em>. A configuration has a name and selects any valid (in terms of the constraints discussed above) subset of the features defined in the referenced feature model. The example below has three configurations: <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477136/" class="cref">cfgDoNothing</a>, <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062505657/" class="cref">cfgNullifyOnly</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477139/" class="cref">cfgNullifyMaxAt200</a>. Note how <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477139/" class="cref">cfgNullifyMaxAt200</a> specifies a value of 200 for the attribute associated with the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062505651/" class="cref">maxCustom</a> feature. An example configuration is also shown in <a href="#sid85256576553537121" class="imgRef">Fig. 8.6.1-B</a>.
          </p>
          <p class="greyBox">Note that, in order for the stuff described below to work (static and runtime variability), you need to make sure that the feature models, on which the variability relies, are actually imported into the respective implementation modules.</p>
          <div class="imagecontainer border" id="sid85256576553537121">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_cfgNullifyMaxAt200.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                8.6.1-B</b><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477139/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid536680812410069782" class="section">8.6.2 Runtime Variability</h3>
          <p class="body">
            As mentioned above, runtime variability means that we will evaluate a configuration <em class="emph">at runtime</em> and based on the evaluation, make decisions about program execution. Take a look at the following piece of code: 
          </p>
          <div class="codeblockContainer">
            <pre class="codeblock">Trackpoint processTrackpoint(fmconfig&lt;FlightProcessor&gt; cfg, Trackpoint tp) {<br/>
  Trackpoint result;                                                        <br/>
  variant&lt;cfg&gt; {                                                            <br/>
  case (nullify &amp;&amp; maxCustom) {                                             <br/>
  result = process_nullifyAlt(tp);                                          <br/>
  if (tp.speed &gt; maxCustom.maxSpeed) {                                      <br/>
  result.speed = maxCustom.maxSpeed;                                        <br/>
} if                                                                        <br/>
}                                                                           <br/>
  case (nullify &amp;&amp; max100) {                                                <br/>
  result = process_nullifyAlt(tp);                                          <br/>
  if (tp.speed &gt; 100 mps) {                                                 <br/>
  result.speed = 100 mps;                                                   <br/>
} if                                                                        <br/>
}                                                                           <br/>
  case (nullify) { result = process_nullifyAlt(tp); }                       <br/>
  default { result = process_doNothing(tp); }                               <br/>
}                                                                           <br/>
  return result;                                                            <br/>
} processTrackpoint (function)</pre><a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477046/" class="originalNode" title="open in MPS"></a>
          </div>
          <p class="body">
            <b>Variant-dependent behavior</b>&nbsp;&nbsp;This function takes two arguments, one of them is an <code class="code">fmconfig</code>. This data type holds a configuration for the specified feature model (<a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062389703/" class="cref">FlightVariability</a> in this case). Inside the function we use the <code class="code">variant</code> statement to branch the code based on the selected feature. The <code class="code">variant</code> statement works essentially like a <code class="code">switch</code> statement, but it &quot;switches over&quot; feature configurations. Note that the conditions in the <code class="code">case</code> parts only allow to access the features defined in by feature model mentioned in the embracing <code class="code">variant</code> statement.
          </p>
          <p class="body">
            Since <code class="code">variant</code> is a statement, it can only be used in statement context -- so it cannot be used to vary arbitrary behavior as expressed, for example, with state machines. Of course, additional similar language constructs could be built for other DSLs.
          </p>
          <p class="body">
            Note also that we can access the values of attributes associated with features. In the code above we access the <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062512675/" class="cref">maxSpeed</a> attribute and use it as a normal expression. Note that only attributes of selected features can be used! Otherwise, no value may be specified.
          </p>
          <p class="body">
            <b>Storing Configurations in Programs</b>&nbsp;&nbsp;In order to be able to change program behavior based on feature configurations at runtime, the configuration has to be stored in the program itself. The test case <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5441227754062477000/" class="cref">testRuntimeVar</a> exemplifies this. Note how we declare a <code class="code">fmconfig</code> variable for a given feature model and then use the <code class="code">store config</code> statement to store a specific configuration into the variable. We then call the abovementioned function where we then use the <code class="code">variant</code> statement to exploit the data.
          </p>
        </div>
        <div>
          <h3 id="sid536680812410436781" class="section">8.6.3 Static Variability</h3>
          <p class="body">Static variability refers to modifying the code statically (before it is executed) based on configuration models. In mbeddr this means that various transformations handle the variability. In the following paragraphs we describe the various ingredients to static variability in mbeddr. </p>
          <p class="body">
            <b>Presence Conditions</b>&nbsp;&nbsp;A presence condition is a Boolean expression over features attached to any program element. During transformation, the program element is deleted if, based on the selected configuration, the Boolean expression evaluates to false. Presence conditions are essentially a kind of &quot;structured #ifdef&quot;. In the two functions <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/869116753978119556/" class="cref">process_trackpoint</a> and <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/869116753978119615/" class="cref">testPresenceConditions</a>, presence conditions are attached to several statements.
          </p>
          <p class="body">The program elements to which presence conditions are attached are color-coded. The color depends on the expression. This means that all program elements that are annotated with the same presence condition get the same color, making it easy to spot disparate parts of programs that rely on the same variant configuration.</p>
          <p class="body">
            Presence conditions are attached to program nodes with the <span class="menuClick"><span><span class="menuItem">Toggle Presence Condition</span></span></span> intention.
          </p>
          <p class="body">
            <b>Projection Modes</b>&nbsp;&nbsp;Variability-aware code can be projected in various ways (switchable via the <span class="menuClick"><span><span class="menuItem">Code</span>&rarr;</span><span><span class="menuItem">Projection Mode</span></span></span> menu). The <code class="code">Detailed Product Line</code> shows the presence conditions in-line in the code (above the annotated node). The <code class="code">Compact Product Line</code> just shows small markers in the code. Hovering over the marker shows the presence condition in a tool-tip. The third mode shows the program as it would look for a given variant (as if the transformation would be executed directly in the editor). For this to work, the system has to know which variant should be rendered. To do this, a so-called <code class="code">Variant Selection</code> annotation must be annotated to the respective root node (it must be on the root node!) using an intention. This annotation allows the selection of a feature model and a particular configuration. Once one is specified, the <code class="code">Selected Variant</code> projection mode can be selected.
          </p>
          <p class="body">
            To better understand these modes, please go to <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/869116753978119546/" class="cref">StaticVariability</a> and experiment for yourself.
          </p>
          <p class="body">
            <b>Conditional Replacements</b>&nbsp;&nbsp;Presence conditions are useful for blocks, or statements, or other structural parts of programs. However, sometimes you only want to change the value of expressions. Exchanging the complete statement (e.g., in case of a variable declaration) has the problem of changing the identities of the variables, which leads to all kinds of downstream problems. It is hence much better to change the value of a variable by exchanging an expression. <code class="code">Conditional Replacements</code> and <code class="code">Conditional Switches</code> can be used for this. You can also use <code class="code">Conditional Alternatives</code>, as discussed below.
          </p>
          <p class="body">
            Take a look at <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238862935057/" class="cref">testConditionalReplacement</a>. In the case of <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238862942824/" class="cref">v1</a> we exchange the value <code class="code">10</code> with <code class="code">0</code> if the <code class="code">nullify</code> feature is selected using a conditional replacement. A conditional replacement replaces an expression with <em class="emph">one</em> other expression, based on a feature condition. It&apos;s a bit like an <code class="code">if</code> statement. However, sometimes an expression must be replaced with various different ones based on a set of feature models. A conditional switch can be used for this; it is more like a <code class="code">switch</code> statement. Take a look at <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238862972644/" class="cref">v2</a> for an example. Both conditional replacements and conditional switches are attached with intentions.
          </p>
          <p class="body">
            <b>Conditional Alternatives</b>&nbsp;&nbsp;Presence conditions are good to exchange code blocks or statements. Conditional replacements and switches are good to replace expressions. What&apos;s missing is a way to replace things that have a name and that can be referenced. The problem is that all references to something break if it is removed via a presence condition. To solve this problem, mbeddr has a third option, the so-called conditional alternative. 
          </p>
          <p class="body">
            Take a look at <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238863686307/" class="cref">alternatives</a>. We declare a function <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238863634459/" class="cref">add</a> which we call from the test case <a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/5479545238863123797/" class="cref">testConditionalAlternative</a>. Now let&apos;s imagine we wanted to replace this function with another one based on a presence condition. If we did that, we&apos;d also have to use presence conditions on all call sites of the function. This is annoying. Conditional alternatives solve this problem in the following way:
          </p>
          <ul>
            <li>
              You mark the original function as <code class="code">conditional original</code>
              
            </li>
            <li>
              You then write one or more alternative functions. Each is marked as a <code class="code">conditional alternative</code>: it points to the original, it has a presence condition that determines when it should be used, and its name must start with the name of the original plus an underscore.
            </li>
            <li>When the transformation runs, the original is replaced with the a suitable alternative, and all references are updated automatically.</li>
          </ul>
          <p class="body">Note that this does not just work for functions but for anything that has a name and can be referenced.</p>
          <p class="body">
            <b>Building Variable Systems</b>&nbsp;&nbsp;In order to be able to build variant-aware software, one has to specify the configurations for all involved feature models. To do this, you have to add a <code class="code">variability mappings</code> configuration item to the build configuration (please see <span><strong class="todo">[ToDo: 
            
            ]</strong></span> for a general discussion on mbeddr&apos;s build system). In this item you can list all relevant feature models plus their configuration. Check out this build configuration as an example: <br/>
<a href="http://localhost:8080/select/tutorial/r:bd5ec23c-c294-47cc-a078-675c03abdb69/9141254329931944280/" class="cref">BuildConfiguration (m.t.m.defaultExtensions)</a>. Note that you will get errors in the build configuration and sometimes during generation itself, if no configuration is specified for a feature model used in the system.
          </p>
          <p class="body">
            As explained in <span><strong class="todo">[ToDo: 
            
            ]</strong></span>, each model can only have one build configuration. Relative to building variability-aware software, this results in two alternative setups:
          </p>
          <ul>
            <li>
              You can either have one model that contains your variable code (i.e., programs with presence conditions and the like) as well as a build configuration. By changing the <code class="code">variability mappings</code> in the build configuration, you can build different variants of the software. However, since they are all in the same model, you can only build <em class="emph">one variant at a time</em>! 
            </li>
            <li>
              The alternative is to have one model with your variability-aware code (let&apos;s call it <code class="code">S</code>), and then an additional model for each variant you want to build (models <code class="code">V_1</code> through <code class="code">V_n</code>). The additional models <code class="code">V_i</code> import the model <code class="code">S</code> and each contain a build configuration with a suitable variability mapping. This way, each of these models builds a separate variant. They exist in parallel, so you can automate the build for all the variants at the same time.
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div>
      <h1 id="sid1481709176728354858" class="section">9 Analyses</h1>
      <div>
        <h2 id="sid3861573051957203922" class="section">9.1 Introduction to Analyses</h2>
        <p class="body">Besides increasing the programmers productivity, domain specific languages allow the definition of advanced, user friendly and domain specific analyses. One special kind of analyses is formal verification, which uses mathematical precise methods for checking properties of mbeddr code. In mbeddr we have integrated different formal verification techniques aiming to be used on a continuous basis in everyday work of practicing engineers. As of today, we have implemented two different kinds of analyses:</p>
        <ul>
          <li>
            Formal verification of variability: mbeddr features advanced support for the definition of product lines using feature models, configuration models and annotation of artifacts with advanced presence conditions. We analyze the consistency of feature models, of configuration models and of the annotated artifacts. To do this we use the SAT4J SAT-solver <a href="http://www.sat4j.org/" class="url">http://www.sat4j.org/</a>.
          </li>
          <li>
            Formal verification of mbeddr-C programs: once programs are written in mbeddr, we enable developers to use advanced formal verification techniques to prove absence of bugs, or, when the analyses are incomplete, to search for cumbersome bugs. Our focus is on user-friendliness of the verification: all analyses are targeted to practicing embedded engineers. For verification we use the CBMC C-level model checker. <a href="http://www.cprover.org/cbmc/" class="url">http://www.cprover.org/cbmc/</a>.
          </li>
        </ul>
      </div>
      <div>
        <h2 id="sid3861573051957204841" class="section">9.2 Analyzing variability</h2>
        <p class="body">
          mbeddr allows the definition of product lines with the help of feature models, configuration models and attaching advanced presence conditions to the produced artifacts (e.g. programs code, requirements). Defining and using product lines in mbeddr is described in Section <span class="sectRef">Section <a href="#sid3861573051957186872">Product Line Variability</a></span>.
        </p>
        <p class="body">Based on the above content, mbeddr provides the following analyses:</p>
        <ul>
          <li>
            <em class="emph">FM-Analyzer</em> checks whether a feature model can be instantiated (i.e. whether there exists configuration models that conform to the feature model). Examples of inconsistencies are mandatory features that conflict with each other, or features that require other features but their parents cannot be parts of the same configuration model.
          </li>
          <li>
            <em class="emph">CM-Analyzer</em> checks whether a configuration model is consistent with the feature model that it configures. Examples of inconsistencies are when not all mandatory features are selected or when conflicting features are selected.
          </li>
          <li>
            <em class="emph">Modules-Analyzer</em> checks whether a mbeddr-C program whose parts are annotated with presence conditions is consistent. Examples of inconsistencies are when a function declaration is annotated with a presence condition  and there exist calls to this function that are not annotated with a presence condition - in this case the function is called when the function itself is not included in the generated code and thereby generator or compile errors will be caused.
          </li>
        </ul>
        <p class="body">Variability analyses are enabled both fine-granular on feature models and configuration models as well as on models and solutions that use variability support. </p>
        <div>
          <h3 id="sid9020927825193691735" class="section">9.2.1 FM-Analyzer</h3>
          <p class="body">In the figure below we present an example of a feature model defined in mbeddr.</p>
          <div class="imagecontainer border" id="sid9020927825193691739">
            <div class="imageWithBorder">
              <img src="images/analyses/fm_example.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.1-A: </b>A feature model contains features and relations among them.
              </p>
            </div>
          </div>
          <p class="body">The FM-Analyzer can be started by right-clicking on the feature model name and selecting the corresponding menu entry. </p>
          <div class="imagecontainer border" id="sid9020927825193691749">
            <div class="imageWithBorder">
              <img src="images/analyses/fm_analyzer_start.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.1-B: </b>One-click starting of the FM-Analyzer.
              </p>
            </div>
          </div>
          <p class="body">FM-Analyzer will open a window with the result of the analysis. In the case when the analysis fails, FM-Analyzer provides an explanation about the cause of failure. </p>
          <div class="imagecontainer border" id="sid9020927825193691758">
            <div class="imageWithBorder">
              <img src="images/analyses/fm_analyzer_results.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.1-C: </b>Results provided by the FM-Analyzer. The failure is caused by the fact that the feature &apos;NoDebug&apos; cannot be selected in any configuration since it conflicts with the &apos;Optimization&apos; feature which is mandatory. 
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid9020927825193691765" class="section">9.2.2 CM-Analyzer</h3>
          <p class="body">In the figure below we present an example of a configuration model defined in mbeddr. Each configuration model contains a subset of features from the feature model it configures.</p>
          <div class="imagecontainer border" id="sid9020927825193691769">
            <div class="imageWithBorder">
              <img src="images/analyses/cm_example.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.2-A: </b>A configuration model contains a sub-set of features.
              </p>
            </div>
          </div>
          <p class="body">The CM-Analyzer can be started by right-clicking on the feature model name and selecting the corresponding menu entry. </p>
          <div class="imagecontainer border" id="sid9020927825193691779">
            <div class="imageWithBorder">
              <img src="images/analyses/cm_analyzer_start.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.2-B: </b>One-click starting of the CM-Analyzer.
              </p>
            </div>
          </div>
          <p class="body">CM-Analyzer will open a window with the result of the analysis. In the case when the analysis fails, CM-Analyzer provides an explanation about the cause of failure. </p>
          <div class="imagecontainer border" id="sid9020927825193691788">
            <div class="imageWithBorder">
              <img src="images/analyses/cm_analyzer_results.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.2-C: </b>Results provided by the CM-Analyzer. The failure is caused by the fact that the feature &apos;Communication&apos; cannot have both sub-features &apos;CAN&apos; and &apos;FlexRay&apos; at the same time.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid9020927825193705480" class="section">9.2.3 Modules-Analyzer</h3>
          <p class="body">In the figure below we present an example of an implementation module in mbeddr which has attached presence conditions to several entities. </p>
          <div class="imagecontainer border" id="sid9020927825193705484">
            <div class="imageWithBorder">
              <img src="images/analyses/module_example.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.3-A: </b>An implementation module with annotated presence conditions.
              </p>
            </div>
          </div>
          <p class="body">The Modules-Analyzer can be started by right-clicking on the implementation module name and selecting the corresponding menu entry. It checks whether the implementation module is consistent with respect to the feature model. Example of inconsistencies are cases when for a function (or variable) declaration we have a presence condition, however, for the calls (or references) to this function (or variable) we do not have any presence condition. In this case, if the code generation is performed, we can get a compile error.  </p>
          <div class="imagecontainer border" id="sid9020927825193705494">
            <div class="imageWithBorder">
              <img src="images/analyses/module_analyzer_start.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.3-B: </b>One-click starting of the Module-Analyzer.
              </p>
            </div>
          </div>
          <p class="body">Module-Analyzer will open a window with the results of the analysis. In the case when the analysis fails, Mo-Analyzer provides an explanation about the cause of failure by giving a possible configuration (selecting concrete features) that would cause the failure. </p>
          <div class="imagecontainer border" id="sid9020927825193705503">
            <div class="imageWithBorder">
              <img src="images/analyses/module_analyzer_results.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.3-C: </b>Results provided by the Module-Analyzer. The failure is caused by the fact that the function &apos;log_debug_info&apos; has presence condition &apos;MinimumDebug&apos; and the caller of this function does not have annotated any presence condition.
              </p>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid5724023611138131897" class="section">9.2.4 Modules and Solutions Variability Analyzer</h3>
          <p class="body">
            Whenever a model contains a root node of type <code class="code">VariabilitySupport</code>, by right-clicking on this model we can check the consistency of variability definition. Whenever a model contains an <code class="code">ImplementationModule</code> which is referencing a feature model, by right-clicking on this model we can check the consistency of variability use.
          </p>
          <div class="imagecontainer border" id="sid5724023611138376251">
            <div class="imageWithBorder">
              <img src="images/analyses/variability_verification_for_models.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.4-A: </b>Direct start of &apos;variability definition&apos; and &apos;variability use&apos; checks for models.
              </p>
            </div>
          </div>
          <p class="body">When a solution contains models that define feature models, then we can check the variability consistency (both definition and use) for the entire solution.</p>
          <div class="imagecontainer border" id="sid5724023611138382780">
            <div class="imageWithBorder">
              <img src="images/analyses/variability_verification_for_solutions.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.2.4-B: </b>One-click start of both variability definition and variability use checks for solutions.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <h2 id="sid3861573051957205464" class="section">9.3 Formal Verification with CBMC</h2>
        <p class="body">
          To perform formal verification, we have integrated the CBMC <a href="http://www.cprover.org/cbmc/" class="url">http://www.cprover.org/cbmc/</a> C-level model-checker which is free under a BSD-4-clause license. Below we reproduce the &apos;advertising requirements&apos; of the  CBMC license:<br/>
<br/>
&quot;This product includes software developed by Daniel Kroening, ETH Zurich and Edmund Clarke, Computer Science Department, Carnegie Mellon University.&quot;<br/>
<br/>
The focus in mbeddr is on hunting bugs at the unit level in a continuous and user-friendly manner. In general, we  <strong class="bold">do not</strong> aim to prove correctness of a system but rather help users to find bugs. Each run of an analysis can provide one of the results: SUCCESS (colored GREEN) - meaning that no bug could be found; FAIL (colored RED) - meaning that a bug could be found, or DON&apos;T KNOW (colored orange) meaning that no bug could be found but the verification is incomplete. When a bug is found, most of the times we have a trace through the system (counterexample) that leads to that failure.<br/>
<br/>
We distinguish between the following kinds of analyses:
        </p>
        <ul>
          <li>
            <em class="emph">Robustness verification at C-level:</em> allows checking of robustness properties like: absence of null pointer dereferencing, absence of div-by-zero, absence of overflows, absence of arrays-out-of-bounds accesses, etc. A more in-depth presentation of robustness checks is given in <span class="sectRef">Section <a href="#sid9020927825193818808">Robustness Checks at C-level</a></span>.
          </li>
          <li>
            <em class="emph">Robustness verification of C-extensions:</em> allows automatic checking of the robustness of several mbeddr-extensions (similar to C-code robustness checks, we can check the robustness of extensions). For example, given a state-machine, a robustness check for it ensures that all states of the state machine can be reached and all transitions can be fired. More details are provided in <span class="sectRef">Section <a href="#sid9020927825193819314">Robustness Checks of mbeddr-Extensions</a></span>.
          </li>
          <li>
            <em class="emph">Functional verification:</em> mbeddr users can define themselves the business-domain specific properties to be checked on a given program; such properties originate usually from functional requirements. Such properties can be given in code either as assertions or attached to higher level constructs like components interfaces. More details are provided in <span class="sectRef">Section <a href="#sid9020927825193819488">Functional Verification</a></span>.
          </li>
        </ul>
        <div>
          <h3 id="sid9020927825193817139" class="section">9.3.1 Verification primer</h3>
          <p class="body">
            <b>Before you start</b>&nbsp;&nbsp;The verification tool that we are using is run on the generated C code (not on the mbeddr models themselves). Thereby, it assumes that from your models you can generate valid C code <sup id="sid9020927825193817139_footnote_1_origin" title="If advanced environments specification is used, the generated C code might contain also CBMC specific macros, so it does not need to compile." class="footnodeOrigin"><a href="#sid9020927825193817139_footnote_1_text">1</a></sup> (otherwise, CBMC will complain and no verification will be performed).
          </p>
          <p class="body">Before starting each verification we should ask ourselves the following questions:</p>
          <ul>
            <li>
              <em class="emph">Q1) What will be checked?</em> The first step is to be aware about what properties will be checked and what properties will not be checked :-) Also, be sure to understand what sub-system will be verified.<br/>
For example, when performing robustness analyses of C-code (e.g. searching for div-by-zero) from a function as entry point, only those division operations will be checked for div-by-zero that can be reached from that entry point (see below). 
            </li>
            <li>
              <em class="emph">Q2) What is the verification entry-point?</em> Each run of CBMC must be given the entry point in the program from which it should perform the verification. When nothing is specified, the entry point is the function <code class="code">main</code>. Code not reachable from the entry point will not be checked at all!
            </li>
            <li>
              <em class="emph">Q3) What are the environment conditions?</em> Each sub-system (e.g. function, component) on which a verification is performed, is embedded in a bigger system from where it gets the data. Usually, the data types used in the code are much more permissive than the actual values that a parameter can take (e.g. for a function that computes a distance that a car can travel in a certain time period given a parameter <code class="code">currentSpeed</code> with <code class="code">int32</code> as type, only a small sub-interval of <code class="code">int32</code> is relevant since cars cannot travel very fast or have high negative speeds).
            </li>
            <li>
              <em class="emph">Q4) What are the parameters given to CBMC?</em> CBMC takes a big number of parameters that directly affect the results of the verification. The most important parameter is related to the loops unwinding <sup id="sid9020927825193817139_footnote_2_origin" title="loops unwinding is also known as loops unrolling" class="footnodeOrigin"><a href="#sid9020927825193817139_footnote_2_text">2</a></sup> - CBMC performs a stepwise symbolic execution of the code and needs to know how many times loops should be unwound.
            </li>
          </ul>
          <div>
            <h4 id="sid3946864811253508142" class="section">9.3.1.1 Behind the Courtain</h4>
            <p class="body">mbeddr allows the definition of higher-level, domain specific properties. Our approach to check them is to generate C-level labels (or asserts) for each of them and to check the reachability of these labels (or violation of asserts). In some cases, if a label is reachable then the property is violated (e.g. for decision tables); in other cases labels that are not rechable represent property violations (e.g. for state-machines states reachability verification, if a label corresponding to a state is not reachable, then that state is not reachable).  Encoding of high-level properties as labels (or assertions) and lifting the verification results is done automatically and transparent for the user.</p>
            <p class="body">In order not to clutter the production code with unnecessary lines, the labels used for the verification are generated only when a model &apos;rebuild&apos; which is started by an analysis action is performed - please make sure that the code you analyze gets rebuilt before the analysis starts.</p>
            <div class="imagecontainer border" id="sid5724023611140947022">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_process_at_a_glance.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.1.1-A: </b>An intuitive overview about how we integrate CBMC in mbeddr: users write high-level functional properties, they are translated into low-level C checks, CBMC is run and then the produced result is lifted back at the domain level.
                </p>
              </div>
            </div>
          </div>
          <p class="footnoteText" id="sid9020927825193817139_footnote_1_text">
            <a href="#sid9020927825193817139_footnote_1_origin">1:</a> 
             
            If advanced environments specification is used, the generated C code might contain also CBMC specific macros, so it does not need to compile.
          </p>
          <p class="footnoteText" id="sid9020927825193817139_footnote_2_text">
            <a href="#sid9020927825193817139_footnote_2_origin">2:</a> 
             
            loops unwinding is also known as loops unrolling
          </p>
        </div>
        <div>
          <h3 id="sid9020927825194462692" class="section">9.3.2 Basic Configuration</h3>
          <p class="body">Before starting mbeddr verification, one needs to perform the following steps:</p>
          <ul>
            <li>
              <em class="emph">Step 1: Add the corresponding verification devkit.</em> Analyses are provided through a series of devkits that need to be enabled for the model where the analysis is run. Without these devkits enabled, either some analyses are not possible at all or the interpretation of the program trace will not be lifted at the DSL level.
            </li>
            <li>
              <em class="emph">Step 2: Make sure that C-code is generated from the model you check.</em> The verification is performed directly on the generated C code. Thereby, if no valid C code is generated from your models, then no verification will be done. Do not forget to add all implementation modules to the build configuration.
            </li>
          </ul>
          <p class="body">
            Global settings for CBMC-based analyses can be changed via <span class="menuClick"><span><span class="menuItem">&quot;File</span>&rarr;</span><span><span class="menuItem">Settings&quot;</span></span></span> menu and then selecting <span class="menuClick"><span><span class="menuItem">CProver preference</span></span></span> tab as shown below. 
          </p>
          <div class="imagecontainer border" id="sid3799250884624557170">
            <div class="imageWithBorder">
              <img src="images/analyses/verification_cprover_global_settings.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.2-A: </b>CBMC global settings.
              </p>
            </div>
          </div>
          <p class="body">The meaning of these settings is briefly described below:</p>
          <ul>
            <li>
              <em class="emph">Number of parallel threads</em> defines the maximum number of instances of CBMC that will be started simultaneously.
            </li>
            <li>
              <em class="emph">Timeout</em> represents the time budget allocated for an analysis. After the timeout expires, the CBMC process will be killed and the analysis will be stopped. In the case when a high-level analysis starts several instances of CBMC (e.g. in case of robustness analyses, we will start one instance of CBMC for each atomic robustness check), then users can define timeout for atomic analyses - denoted as <em class="emph">partial timeout</em>.
            </li>
            <li>
              Use of <em class="emph">VCC/GCC</em> under Windows. If VCC is used then mbeddr should be started from the Visual Studio console. If GCC is used, then &apos;gcc&apos; should be in path (see <span class="sectRef">Section <a href="#sid2564556814935137124">Verification Tools</a></span>).
            </li>
            <li>
              <em class="emph">Rebuild models</em> before analysis instructs mbeddr to perform a full &quot;MPS rebuild&quot; of the analyzed model before each analysis (otherwise only an &quot;MPS make&quot; will be run; in MPS, &apos;just make&apos; is not always functioning properly).
            </li>
            <li>
              <em class="emph">Slice formula</em> instructs CBMC to perform program slicing. The analyses will run faster, however, in the case when the analysis fails, the returned counterexample might not contain all intermediate steps.
            </li>
            <li>
              <em class="emph">Unwinding depth</em> instructs CBMC how many times it should unwind loops. If generate unwinding assertions is selected, then CBMC will explicitly check that each loop was unwound enough. For more details about the loops unwinding in CBMC, please look here: <a href="http://www.cprover.org/cprover-manual/cbmc-loops.shtml" class="url">http://www.cprover.org/cprover-manual/cbmc-loops.shtml</a> 
            </li>
            <li>
              <em class="emph">Partial loops</em> instructs CBMC to continue the analysis even if unwinding is not enough. Enabling partial loops, increases the number of bugs that can be found, however, it might introduce false positives (properties reported as SUCCESS even if they should FAIL) and false negatives (properties reported as FAILS even if they should be SUCCESS; in these cases, provided counterexamples are not feasible). Unfeasible counterexamples can be returned also in the case when the property FAILS indeed.
            </li>
            <li>
              <em class="emph">Use refinement</em> instructs CBMC to use refinement procedure. If checked, this setting speeds-up some analyses. However, it should be used with case since it is still marked as &apos;experimental&apos; in CBMC 4.9.
            </li>
          </ul>
        </div>
        <div>
          <h3 id="sid9020927825193818808" class="section">9.3.3 Robustness Checks at C-level</h3>
          <p class="body">
            For checking robustness of C programs, we need to add the <code class="code">com.mbeddr.analyses.core</code> devkit as shown in the following figure. C programs are called to be &apos;robust&apos; if no run-time errors (e.g. division by zero, null pointers dereferencing) can occur. To search for these errors, CBMC will check each place in the generated C code where the error can occur (e.g. each division operation, each dereferencing of pointers). The properties to be checked in this case are automatically generated by CBMC and mean for example that all divisions have divisors that are not zero.
          </p>
          <div class="imagecontainer border" id="sid9020927825194463212">
            <div class="imageWithBorder">
              <img src="images/analyses/verification_core_devkit.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.3-A: </b>Adding the <code class="code">com.mbeddr.analyses.core</code> devkit to your model will enable robustness checks.
              </p>
            </div>
          </div>
          <p class="body">
            To start the robustness checks for a given function <sup id="sid9020927825193818808_footnote_1_origin" title="All analyses re performed on the code from the function set as entry point and transitively for the functions that are called from it" class="footnodeOrigin"><a href="#sid9020927825193818808_footnote_1_text">1</a></sup> you can either open a pop-up menu on the function or define an robustness analysis configuration <sup id="sid9020927825193818808_footnote_2_origin" title="Most analyses can be either run with one click (in that case the global settings (see  ) will be used and the entry point in the analysis is 'main' or can be run via checking 'analysis configurations'.  An analysis configuration enables the specification of entry points (e.g. verification environments) and fine granular definition of CBMC parameters." class="footnodeOrigin"><a href="#sid9020927825193818808_footnote_2_text">2</a></sup>.  
          </p>
          <div class="imagecontainer border" id="sid9020927825194723764">
            <div class="imageWithBorder">
              <img src="images/analyses/verification_robustness_direct_start.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.3-B: </b>One click start of robustness checks.
              </p>
            </div>
          </div>
          <div class="imagecontainer border" id="sid9020927825194723951">
            <div class="imageWithBorder">
              <img src="images/analyses/verification_config_robustness_item_creation.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.3-C: </b>Creation of a new &apos;robustness analysis configuration item&apos;.
              </p>
            </div>
          </div>
          <div class="imagecontainer border" id="sid4315280228448010745">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_verification_config_robustness_item_example.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.3-D: </b>For each configuration item the users can fine-tune which robustness properties will be checked and the entry point in the verification.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/9020927825194463394/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <div class="imagecontainer border" id="sid9020927825194725559">
            <div class="imageWithBorder">
              <img src="images/analyses/verification_config_robustness_item_start_verification.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.3-E: </b>To verify an analysis configuration item, one needs just to right-click and select the menu.
              </p>
            </div>
          </div>
          <p class="body">
            When the analysis is started from the pop-up menu, all robustness properties will be checked. Below we summarize the robustness properties (details about these propertie can be found on the web-page of CBMC <a href="http://www.cprover.org/cprover-manual/properties.shtml" class="url">http://www.cprover.org/cprover-manual/properties.shtml</a>) and in its user guide:
          </p>
          <ul>
            <li>
              <em class="emph">array bounds</em> check that each array access is within bounds (aka. buffer overflow).
            </li>
            <li>
              <em class="emph">div-by-zero</em> check that for each division the divisor is not zero.
            </li>
            <li>
              <em class="emph">not-a-number</em> check whether the floating-point computations can result in NaN.
            </li>
            <li>
              <em class="emph">pointer</em> check that pointers are valid whenever they are accessed (no NULL-pointer dereference and no access to invalid pointers such as dead objects).
            </li>
            <li>
              <em class="emph">overflows/underflows</em> check that no signed/unsigned/float over- or underflow can occur.
            </li>
            <li>
              <em class="emph">memory leak</em> check that all memory allocated within the run code is also deallocated before exit.
            </li>
          </ul>
          <p class="footnoteText" id="sid9020927825193818808_footnote_1_text">
            <a href="#sid9020927825193818808_footnote_1_origin">1:</a> 
             
            All analyses re performed on the code from the function set as entry point and transitively for the functions that are called from it
          </p>
          <p class="footnoteText" id="sid9020927825193818808_footnote_2_text">
            <a href="#sid9020927825193818808_footnote_2_origin">2:</a> 
             
            Most analyses can be either run with one click (in that case the global settings (see  <span class="sectRef">Section <a href="#sid9020927825194462692">Basic Configuration</a></span>) will be used and the entry point in the analysis is &apos;main&apos; or can be run via checking &apos;analysis configurations&apos;.  An analysis configuration enables the specification of entry points (e.g. verification environments) and fine granular definition of CBMC parameters.
          </p>
        </div>
        <div>
          <h3 id="sid9020927825193819314" class="section">9.3.4 Robustness Checks of mbeddr-Extensions</h3>
          <p class="body">Higher-level language constructs carry with them higher-level properties that can be checked. For example, when programming using decision tables, we might ask ourselves if the decision table is complete (have we covered all cases?) or if it is consistent (do we have cases where multiple cells could be active at the same time?). Another example are state-machines about which we might ask ourselves if all states are reachable (i.e. we do not have superfluous states) and if all transitions can be fired (i.e. no transition is completely shadowed by previous transitions).</p>
          <div>
            <h4 id="sid4315280228446701717" class="section">9.3.4.1 Checking Decision Tables</h4>
            <p class="body">Let&apos;s consider a decision table which implements a look-up table to compute a breaking distance given the current speed and the information whether the road is icy or not.</p>
            <div class="imagecontainer border" id="sid615565695606448433">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_computeBreakingDistance.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.1-A</b><a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/4006179876939558560/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">A decision table can be verified only if the &apos;checked&apos; annotation is enabled as shown below. This flag will instruct the C-code generator to generate labels for each of the properties to be checked.</p>
            <div class="imagecontainer border" id="sid4315280228446839962">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_dectab_toggle_check.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.1-B: </b>To verify a decision table one needs to make it &apos;checked&apos; by using an intention.
                </p>
              </div>
            </div>
            <p class="body">
              It is possible to start the verification with one click from the pop-up menu of the decision table node or through an analysis configuration as described in the case of robustness checks. The one-click start will use the <code class="code">main</code> method as entry point; in the case when analysis configurations are used then we can specify another entry point (usually a harness - see <span class="sectRef">Section <a href="#sid2496896684167180661">Defining the Environment for Verification</a></span>).
            </p>
            <div class="imagecontainer border" id="sid4315280228447133125">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_dectab_start_verification.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.1-C: </b>One-click starting of the decision table verification.
                </p>
              </div>
            </div>
            <div class="imagecontainer border" id="sid4315280228448010413">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_verification_dectab_configuration_item.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.1-D: </b>A configuration item for verifying a decision table.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/4315280228447720594/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">After the verification is finished, the results (i.e. have we missed cases?, do we have cases where two cells of the table are active at the same time?) are automatically shown. When a result fails then a trace through the system is given that shows an example of values that could cause the failure. </p>
            <div class="imagecontainer border" id="sid4315280228447133885">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_dectab_results.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.1-E: </b>A trace to the failure will be shown if the verification result is selected.
                </p>
              </div>
            </div>
          </div>
          <div>
            <h4 id="sid4315280228447176921" class="section">9.3.4.2 Checking State Machines</h4>
            <p class="body">
              The first step to check state-machines is to add the <code class="code">com.mbeddr.analyses.statemachines</code> devkit to the model containing the state machine. This devkit enables actions in context menus and the lifting of counterexamples such that they are aware of state-machines.<br/>
<br/>
Let&apos;s consider a state-machine that implements a simple counter. After the state-machine is started (with the start event), it counts up or down.
            </p>
            <div class="codeblockContainer">
              <pre class="codeblock">statemachine Counter initial = Init {                   <br/>
  in event countUp(int16 step) &lt;no binding&gt;             <br/>
  in event countDown(int16 step) &lt;no binding&gt;           <br/>
  in event start() &lt;no binding&gt;                         <br/>
  var int16 counterState = 0                            <br/>
                                                        <br/>
  state Init {                                          <br/>
  on start [ ] -&gt; Counting                              <br/>
} state Init                                            <br/>
  state Counting {                                      <br/>
  on countUp [ ] -&gt; Counting { counterState += step; }  <br/>
  on countUp [step &lt; 0] -&gt; Init                         <br/>
  on countDown [ ] -&gt; Counting { counterState += step; }<br/>
  on countDown [step &lt; 0] -&gt; Init                       <br/>
} state Counting                                        <br/>
}</pre><a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/4315280228447482279/" class="originalNode" title="open in MPS"></a>
            </div>
            <p class="body">
              A state-machine can be verified only if the &apos;checked&apos; annotation is enabled as shown below. The checked flag is enabled via an intention on the state-machine. This flag will instruct the C-code generator to generate labels for each of the properties to be checked (see <span class="sectRef">Section <a href="#sid3946864811253508142">Behind the Courtain</a></span>). 
            </p>
            <div class="codeblockContainer">
              <pre class="codeblock">checked</pre><a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/4315280228447482321/" class="originalNode" title="open in MPS"></a>
            </div>
            <p class="body">
              The verification can be started either with one click from the pop-up menu of the state-machine node or through an analysis configuration. The one-click start will use the <code class="code">main</code> method as entry point and global settings for CBMC; in the case when analysis configurations are used then we can specify another entry point and fine-tune the settings.
            </p>
            <div class="imagecontainer border" id="sid4315280228448025177">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_verification_statemachine_configuration_item.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.2-A: </b>A configuration item for verifying state-machines.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/4315280228447811862/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">After the verification is finished, the results are automatically shown - i.e. if a state cannot be reached or a transition cannot be fired then the result is marked with FAIL. Since the generated labels cannot be reached, we do not have any trace through the system. </p>
            <div class="imagecontainer border" id="sid4315280228448025188">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_statemachine_results.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.4.2-B: </b>Results of the state machine verification. Two transitions cannot be fired since they are shadowed by previous transitions.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid9020927825193819488" class="section">9.3.5 Functional Verification</h3>
          <p class="body">Many times we want to check properties in the code that are relevant to the business domain of our application and originate from requirements. In order to do so, we need to be able to write such properties in the code. In mbeddr one can use plain C-level assertions, extended assertions or can attach properties to higher level constructs like for example pre/post conditions to components.</p>
          <div>
            <h4 id="sid7590231220342167555" class="section">9.3.5.1 Assertions verification</h4>
            <p class="body">Writing assertions in C code is a &apos;classical&apos; method to check properties. In the code fragment below we present a simple assertion.</p>
            <div class="imagecontainer border" id="sid7590231220342181849">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_assertion_example.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.1-A: </b>We specify that the time should be positive.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/7590231220342174846/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">
              <b>Extended assertions</b>&nbsp;&nbsp;Many times using simple assertions to encode more complex properties that represent the evolution of the system in time (e.g. &apos;after Q then P&apos;, &apos;before Q must P&apos;) is cumbersome. As usual, mbeddr provides a set of first class language constructs that allow users to directly express such properties. By clicking on these constructs, you can find in the &apos;Inspector&apos; information about how the code will be generated - basically C-level assertions wrapped in small monitors. 
            </p>
            <div class="imagecontainer border" id="sid7347601989637382983">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_extended_assertions_example.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.1-B: </b>Examples of extended assertions.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/7347601989637427761/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">The assertions verification can be started either with one-click from the pop-up menu of the function, or by defining an analysis configuration item. Both ways are illustrated below.</p>
            <div class="imagecontainer border" id="sid7590231220342211940">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_assertions_direct_start.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.1-C: </b>One click check of all assertions that can be reached from one function.
                </p>
              </div>
            </div>
            <div class="imagecontainer border" id="sid7590231220342213922">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_assertions_analysis_config.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.1-D: </b>As any other analysis configuration items, assertion analysis configuration items allow mbeddr users to fine tune different verification parameters.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/7590231220342212120/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
          </div>
          <div>
            <h4 id="sid7590231220342214141" class="section">9.3.5.2 Components Verification</h4>
            <p class="body">
              In order to enable components verification, we should firstly add the <code class="code">com.mbeddr.analyses.components</code> devkit to the current model.<br/>
<br/>
mbeddr allows its users to define interfaces and components that implement them. To each of the runnables of an interface, we can attach pre/post conditions. Furthermore, the expected ordering of calls to functions of an interface can be defined using a protocol specification. Pre-/post-conditions and protocol together we call the contract of the interface.
            </p>
            <div class="imagecontainer border" id="sid7590231220342733648">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_speed_computer_interface.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-A: </b>Example of an interface with pre-/post-conditions and protocol attached to its functions.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/2161187783549496717/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">Interfaces can be implemented by components like in the code fragment shown below.</p>
            <div class="imagecontainer border" id="sid7590231220342733813">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_plauzibilized_speed_computer_component.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-B: </b>A component implements all methods of the interface. The contracts defined by all interfaces are automatically transferred to the component.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/2161187783549496738/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">Having specified the contract of an interface, we would like to verify if the clients of the components implementing this interface comply with the specified preconditions and call the interface functions in an appropriate order. Furthermore, we would like to check that the implementation of the methods fo the interface fulfills the specified post-conditions.</p>
            <div class="imagecontainer border" id="sid7590231220342734490">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_component_clients.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-C: </b>Example of a client of the component. <a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/2161187783549496759/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">To check the component, we firstly need to add the attribute &apos;checked&apos; via an intention (having this attribute enabled, we can generate labels for the cases where pre-/post-conditions are violated). <br/>
<br/>
The verification is started either by one-click from the components pop-up menu or via an analysis configuration item which allows to specify an arbitrary entry point. Both of these ways are illustrated below. </p>
            <div class="imagecontainer border" id="sid7590231220342749945">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_components_direct_start.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-D: </b>One click check of the contracts of all interfaces provided by this component.
                </p>
              </div>
            </div>
            <div class="imagecontainer border" id="sid7590231220344597381">
              <div class="imageWithBorder">
                <img src="images/vis/mbeddrUserGuide_components_configuration_item.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-E: </b>Example of a configuration item for components analyses.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/7590231220342750056/" class="originalNode" title="open in MPS"></a>
                </p>
              </div>
            </div>
            <p class="body">Once the verification finishes, a window with results will be automatically opened as illustrated below.</p>
            <div class="imagecontainer border" id="sid2496896684166576297">
              <div class="imageWithBorder">
                <img src="images/analyses/verification_components_results.png" />
              </div>
              <div class="imagecaption">
                <p class="caption">
                  <b>Figure
                  9.3.5.2-F: </b>The results of the verification of each pre-/post-condition and protocol are displayed in the results window.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div>
          <h3 id="sid2496896684167180661" class="section">9.3.6 Defining the Environment for Verification</h3>
          <p class="body">Most of the software modules we develop (e.g. functions, state machines, components) are included within bigger systems. Other systems, that are neighboring with our module that we verify are called the environment of the system. Most of the time, the data types of the inputs of the to-be-verified system are too permissive and in practice, the sub-system we are verifying should work under much tighter constraints.</p>
          <div class="imagecontainer border" id="sid2496896684167186858">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_system_under_verification.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.6-A: </b>Let&apos;s consider for example that our system under verification is a simple function that computes the speed of a car. This function takes two parameters: a distance and a time interval, both of type <code class="code">int16</code>. Of course that the time interval cannot be smaller than zero; let&apos;s assume that it is smaller than 10. We can also assume that the distance cannot be bigger than 1000 and must be positive as well. <a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/2496896684167185602/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            The constraints over variables and ranges can be modeled inside <code class="code">harness modules</code>. Below we show an example of such a module:
          </p>
          <div class="imagecontainer border" id="sid2496896684167199944">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_environment_definition.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.6-B: </b>The function <code class="code">speedComputer</code> is called from within the harness definition that contains nondeterministic assignments that are further constraint (via an intention on a <code class="code">nondet assign</code>) to belong to the desired intervals. In the first nondeterministic assignment we use an explicit construct to specify the interval, in the second assignment we use classical C inequalities. When we use the &apos;in range expression&apos; (as opposed to explicit inequalities), then the harness is generated in an optimal manner and this increases the running efficiency of CBMC.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/2496896684167187462/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
          <p class="body">
            Furthermore, the sequence in which different operations are called can be modeled as well using the harness. For doing this, we can use the <code class="code">nondeterministic_choice</code> construct that will choose nondeterministically one of the defined cases.<br/>

          </p>
          <div class="imagecontainer border" id="sid7347601989637725721">
            <div class="imageWithBorder">
              <img src="images/vis/mbeddrUserGuide_calls_sequence.png" />
            </div>
            <div class="imagecaption">
              <p class="caption">
                <b>Figure
                9.3.6-C: </b>We define traces with size 5 (using the for loop) and at each step either <code class="code">fun1</code> or <code class="code">fun2</code> are called that compute some value. We check that for 5 calls in either order to these functions, a specific property holds. In this manner we can for example model a sequence of external events, each event triggering a function where it is handled.<a href="http://localhost:8080/select/tutorial/r:9bae0493-3d57-4bb7-af86-c94f4734b531/7347601989637735054/" class="originalNode" title="open in MPS"></a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
	
	<!-- Start of Async HubSpot Analytics Code -->
	<script type="text/javascript">
	(function(d,s,i,r) {
	if (d.getElementById(i)){return;}
	var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
	n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/761475.js';
	e.parentNode.insertBefore(n, e);
	})(document,"script","hs-analytics",300000);
	</script>
	<!-- End of Async HubSpot Analytics Code -->
	
  </body>
</html>